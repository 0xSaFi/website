---
layout: obsolete
title: "BuildSystem/ReleaseProcess"
permalink: /old_site/BuildSystem/ReleaseProcess/
redirect_from:
  - /BuildSystem/ReleaseProcess/
---

<h1>BuildSystem/ReleaseProcess</h1>

<p>Description of the Mono release process
</p>
<table id="toc" class="toc"><tr><td><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Branching_and_Tagging_Policy"><span class="tocnumber">1</span> <span class="toctext">Branching and Tagging Policy</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Tagging"><span class="tocnumber">2</span> <span class="toctext">Tagging</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Rolling_Source_Tarballs"><span class="tocnumber">3</span> <span class="toctext">Rolling Source Tarballs</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#Builds"><span class="tocnumber">4</span> <span class="toctext">Builds</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="#Installers"><span class="tocnumber">5</span> <span class="toctext">Installers</span></a></li>
<li class="toclevel-1 tocsection-6"><a href="#Release_Notes"><span class="tocnumber">6</span> <span class="toctext">Release Notes</span></a></li>
<li class="toclevel-1 tocsection-7"><a href="#Publishing_Previews_and_final_release"><span class="tocnumber">7</span> <span class="toctext">Publishing Previews and final release</span></a></li>
<li class="toclevel-1 tocsection-8"><a href="#Update_mono-project.com_wiki"><span class="tocnumber">8</span> <span class="toctext">Update mono-project.com wiki</span></a></li>
<li class="toclevel-1 tocsection-9"><a href="#OBS_and_autobuild"><span class="tocnumber">9</span> <span class="toctext">OBS and autobuild</span></a></li>
</ul>
</td></tr></table>
<h2> <span class="mw-headline" id="Branching_and_Tagging_Policy">Branching and Tagging Policy</span></h2>
<p>Typically the same modules are released as a set:
</p>
<ul><li>gluezilla
</li><li>libgdiplus
</li><li>mcs
</li><li>mod_mono
</li><li>mono
</li><li>mono-basic
</li><li>mono-tools
</li><li>monodoc
</li><li>xsp
</li></ul>
<p>Other projects usually use their own schedule:
</p>
<ul><li>monodevelop
</li><li>moonlight
</li><li>gtk#
</li></ul>
<p>Mono versions for tags and branches in subversion don't use periods in the version numbers.  IE: branches/mono-1-9  and  tags/mono-1-9
</p><p>Some modules have their own branching and tagging standards, and those standards are listed in their respective def file (trunk/release/packaging/defs).
</p><p>The typical flow is to branch from trunk, solidify the branch, and then create a tag from that branch.  Dot releases are then based on that branch and are tagged from the branch.
</p><p>The Mono policy about re-tagging is that it is allow as long as the tarballs haven't been published as a final release.  This means that tarballs published in a preview may change.
</p><p>If you're building from trunk you'll usually branch or tag most of the modules because they've usually all changed.  (Use svn diff to be sure).
</p>
<h2> <span class="mw-headline" id="Tagging">Tagging</span></h2>
<p>If you're building from a branch, there's a helper script to see changes:
</p>
<pre>release/packaging/mono_branch_diff
</pre>
<p>Before you actually create the tag, the version needs to be updated in the source.  This is usually done in 'configure.in'.  (For hints on how to update a specific module, you can check the module's release/packaging/def file for update_version_file, otherwise configure.in is updated)
</p><p>Make sure this version update happens in trunk or on the branch;  NEVER commit to a tag.
</p><p>After you've committed the version update change, you're ready to create the tags.  Example:
</p>
<pre>svn mkdir $MSVN/tags/mono-1-9-2
svn cp $MSVN/branches/mono-1-9/mono $MSVN/tags/mono-1-9-2
svn cp $MSVN/branches/mono-1-9/mcs $MSVN/tags/mono-1-9-2
</pre>
<h2> <span class="mw-headline" id="Rolling_Source_Tarballs">Rolling Source Tarballs</span></h2>
<p>After subversion tags have been created, monobuild is used to create a tarball.
</p><p>This is done with ./mktarball in trunk/release/packaging.  (You can run that command with no args to get a usage).  A typical example would be:
</p>
<pre>./mktarball mono 1.9
</pre>
<p>That will place the tarball in release/packaging/sources/mono
</p>
<h2> <span class="mw-headline" id="Builds">Builds</span></h2>
<p>To do the actual build you run ./build.  IE:
</p>
<pre>./build sles-9-i586 mono 1.9
</pre>
<p>To build mono 1.9 on all the platforms you can run:
</p>
<pre>./build-all mono 1.9
</pre>
<p>That will simultaneously build mono on all the distros/platforms.
</p><p>If several modules need to be built, you'll need to run ./build-all for each of those modules in their build dependency order.  The order can be deduced from MONO_DEPS in each of the module's .def file.
</p><p>The best way to monitor the builds is through the webview.
</p><p>Note: aside about build mono from a branch:  If the .spec files have diverged between trunk and the mono branch, you'll need to temporarily copy packaging/rpm_defs/mono-branch/mono-core.spec to packaging/rpm_defs/mono .  After the builds and before you enable the monobuild scheduler again, don't forget to revert this change.
</p>
<h2> <span class="mw-headline" id="Installers">Installers</span></h2>
<p>The installers use the .rpm and .zip outputs of the builds created by ./build.
</p><p>Here's how to run each of the installers:
</p>
<pre>cd release/linux-installer
./buildlinux-installer 1.9.1
</pre>
<pre>cd release/windows-installer
./buildwindows-installer 1.9.1
</pre>
<pre>cd release/macosx
./buildpackage universal
</pre>
<p>Each of the installer scripts take an optional 'release' argument as the last parameter.  It signifies the build revision for a particular release.
</p>
<h2> <span class="mw-headline" id="Release_Notes">Release Notes</span></h2>
<p>Release notes are in subversion:
</p>
<pre>trunk/release/announce
</pre>
<p>Those changes are typically done by Miguel, who gathers important changes from the team via email, as well as reviews ChangeLogs from the svn diff.
</p><p>Once the file is ready, there's a Makefile in announce that needs to be updated to publish the latest release notes.
</p>
<h2> <span class="mw-headline" id="Publishing_Previews_and_final_release">Publishing Previews and final release</span></h2>
<p>Once a build is done QA tests the build.  In case something is found, we publish a 'preview' instead of a final release.  This will give us a chance to retag and rebuild before shipping the final version.
</p><p>To publish the preview, first update release/packaging/bundles/PRE-RELEASE.  Update 'archive_version' as well as 'bundle_short_desc'.  Then run from release/packaging:
</p>
<pre>./upload-preview
</pre>
<p>Some variables in this script may be edited to also upload the preview to c100 for faster internal downloads.
</p><p>After QA gives the go-ahead, you publish to ftp.novell.com.  Again, first update packaging/bundles/RELEASE to have the correct mono release version.  Then run:
</p>
<pre>./upload-prod --generate RELEASE
</pre>
<p>This will generate the webpages and download repositories.  Then you can run:
</p>
<pre>./upload-prod RELEASE
</pre>
<p>This does a dry-run rsync.  The purpose being able to see what packages are being copied to ftp.novell.com.  I only like to publish the final release builds and not the preview builds.  This helps save some space.  So if you have 3 preview releases, I'll look at the rsync command to find duplicate packages and installers and go remove them by hand.  I'll repeat this command a few times until I'm satisfied that I'm not using any more disk space than necessary.  When everything looks good, then run:
</p>
<pre>./upload-prod --publish RELEASE
</pre>
<p>That will do the actual copy.
</p>
<h2> <span class="mw-headline" id="Update_mono-project.com_wiki">Update mono-project.com wiki</span></h2>
<p>Add current release to the list of releases at <a href="{{site.baseurl}}/OldReleases" title="OldReleases">OldReleases</a>.  Update download page by editing:
</p>
<pre>release/website/download_page/release_data.js
</pre>
<p>You'll need to commit that file and then run 'svn up' in ~/release on go-mono.com.
</p>
<h2> <span class="mw-headline" id="OBS_and_autobuild">OBS and autobuild</span></h2>
<p>An account is required in order to submit sources to the openSUSE Build Service.  You must also have access to the 'Mono' namespace.  There is OBS documentation on en.opensuse.org.
</p><p>Usually it is best to disable publishing in OBS for the Mono project while builds are being done.  That way if you have to rebuild a few times multiple rpms don't get distributed.  Once everything is building fine, re-enable publishing.
</p><p>Autobuild submissions are done from macintyre.suse.de (although any autobuild machine will do).  But, for opensuse 11.1 the distro will be built out of OBS.
</p>
