---
layout: obsolete
title: "Parallel Mono Environments"
permalink: /old_site/Parallel_Mono_Environments/
redirect_from:
  - /Parallel_Mono_Environments/
  - /Parallel_Environments/
  - /Unstable_Mono_Environment/
---

<h1>Parallel Mono Environments</h1>

<p><i>This document details how to run multiple Mono environments on a single system where neither environment conflicts with another.</i>
</p><p>This assumes that you are familiar with the <a href="{{site.github.url}}/old_site/Compiling_Mono" title="Compiling Mono">compilation process for Mono</a>.
</p>
<table id="toc" class="toc"><tr><td><div id="toctitle"><h2>Table of contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#What.27s_the_Point.3F"><span class="tocnumber">1</span> <span class="toctext">What's the Point?</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Getting_Sources"><span class="tocnumber">2</span> <span class="toctext">Getting Sources</span></a>
<ul>
<li class="toclevel-2 tocsection-3"><a href="#Source_Tarballs"><span class="tocnumber">2.1</span> <span class="toctext">Source Tarballs</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#Source_from_Version_Control_.28Mono_Git.29"><span class="tocnumber">2.2</span> <span class="toctext">Source from Version Control (Mono Git)</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-5"><a href="#Setting_up_a_Build_Environment"><span class="tocnumber">3</span> <span class="toctext">Setting up a Build Environment</span></a></li>
<li class="toclevel-1 tocsection-6"><a href="#Building_Sources"><span class="tocnumber">4</span> <span class="toctext">Building Sources</span></a>
<ul>
<li class="toclevel-2 tocsection-7"><a href="#libgdiplus"><span class="tocnumber">4.1</span> <span class="toctext">libgdiplus</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="#mono"><span class="tocnumber">4.2</span> <span class="toctext">mono</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="#gtk-sharp"><span class="tocnumber">4.3</span> <span class="toctext">gtk-sharp</span></a></li>
<li class="toclevel-2 tocsection-10"><a href="#gtk-sharp-2"><span class="tocnumber">4.4</span> <span class="toctext">gtk-sharp-2</span></a></li>
<li class="toclevel-2 tocsection-11"><a href="#mono-tools"><span class="tocnumber">4.5</span> <span class="toctext">mono-tools</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-12"><a href="#Conclusion"><span class="tocnumber">5</span> <span class="toctext">Conclusion</span></a>
<ul>
<li class="toclevel-2 tocsection-13"><a href="#Tip:_Your_first_build"><span class="tocnumber">5.1</span> <span class="toctext">Tip: Your first build</span></a></li>
<li class="toclevel-2 tocsection-14"><a href="#Tip:_Rebuilding_Class_Library_Parts"><span class="tocnumber">5.2</span> <span class="toctext">Tip: Rebuilding Class Library Parts</span></a></li>
<li class="toclevel-2 tocsection-15"><a href="#Tip:_CONFIG_SITE"><span class="tocnumber">5.3</span> <span class="toctext">Tip: CONFIG_SITE</span></a></li>
<li class="toclevel-2 tocsection-16"><a href="#Tip:_MONO_GAC_PREFIX"><span class="tocnumber">5.4</span> <span class="toctext">Tip: MONO_GAC_PREFIX</span></a></li>
<li class="toclevel-2 tocsection-17"><a href="#BEWARE:_pkgconfig_fallback_behaviour"><span class="tocnumber">5.5</span> <span class="toctext">BEWARE: pkgconfig fallback behaviour</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-18"><a href="#Common_Problems"><span class="tocnumber">6</span> <span class="toctext">Common Problems</span></a></li>
</ul>
</td></tr></table>
<h2> <span class="mw-headline" id="What.27s_the_Point.3F"> What's the Point? </span></h2>
<p>It may be desirable to have two or more completely separate and independent Mono stacks running at the same time, for development purposes or even for running unstable applications without compromising existing installed stable versions.
</p><p>For example, under SUSE 10 Mono, Banshee, F-Spot, and Tomboy (to name a few) are all installed by default, are considered "stable," and are linked against "stable" Mono libraries, such as gtk-sharp-2.x. 
</p><p>It is possible to run the latest versions of these applications (for example, from Mono Git) with the latest version of Mono by installing all components into a separate prefix with different environment variables.
</p>
<h2> <span class="mw-headline" id="Getting_Sources"> Getting Sources </span></h2>
<p>This document assumes that a distribution-installed Mono environment already exists, and is installed in a prefix other than /opt/mono.
</p><p>The "parallel" environment this document details is installed from either source tarballs or from Mono Git repository.
</p>
<h3> <span class="mw-headline" id="Source_Tarballs"> Source Tarballs </span></h3>
<p>First, download the <a href="http://go-mono.com/sources-stable/" class="external text" rel="nofollow">Released Source Mono Tarballs</a>. This document is concerned only with <i>mono</i>, <i>libgdiplus</i>, <i>gtk-sharp-1.x</i>, <i>gtk-sharp-2.x</i>, and <i>mono-tools</i>.
</p>
<h3> <span class="mw-headline" id="Source_from_Version_Control_.28Mono_Git.29"> Source from Version Control (Mono Git) </span></h3>
<p>Modules in <a href="/index.php?title=Git&amp;action=edit&amp;redlink=1" class="new" title="Git (page does not exist)"> Mono Git</a> correspond to the source tarballs above. Respective modules are: <i>mono, libgdiplus,</i> and <i>gtk-sharp</i>. If you are using Git rather than released tarballs, you must run the ./autogen.sh script to generate the autotools build system before you will be able to run ./configure commands.
</p>
<h2> <span class="mw-headline" id="Setting_up_a_Build_Environment"> Setting up a Build Environment </span></h2>
<p>To prevent introducing elements from the existing Mono environment, a new environment must be set up. This section assumes GNOME is installed in <i>/opt/gnome</i>.
</p><p>Create a bash script named something like <i>~/mono-dev-env</i>. Its contents should be similar to the following:
</p>
<pre class="bash" style="font-family:monospace;"><span style="color: #666666; font-style: italic;">#!/bin/bash</span>
<span style="color: #007800;">MONO_PREFIX</span>=<span style="color: #000000; font-weight: bold;">/</span>opt<span style="color: #000000; font-weight: bold;">/</span>mono
<span style="color: #007800;">GNOME_PREFIX</span>=<span style="color: #000000; font-weight: bold;">/</span>opt<span style="color: #000000; font-weight: bold;">/</span>gnome
<span style="color: #7a0874; font-weight: bold;">export</span> <span style="color: #007800;">DYLD_FALLBACK_LIBRARY_PATH</span>=<span style="color: #007800;">$MONO_PREFIX</span><span style="color: #000000; font-weight: bold;">/</span>lib:<span style="color: #007800;">$DYLD_LIBRARY_FALLBACK_PATH</span>
<span style="color: #7a0874; font-weight: bold;">export</span> <span style="color: #007800;">LD_LIBRARY_PATH</span>=<span style="color: #007800;">$MONO_PREFIX</span><span style="color: #000000; font-weight: bold;">/</span>lib:<span style="color: #007800;">$LD_LIBRARY_PATH</span>
<span style="color: #7a0874; font-weight: bold;">export</span> <span style="color: #007800;">C_INCLUDE_PATH</span>=<span style="color: #007800;">$MONO_PREFIX</span><span style="color: #000000; font-weight: bold;">/</span>include:<span style="color: #007800;">$GNOME_PREFIX</span><span style="color: #000000; font-weight: bold;">/</span>include
<span style="color: #7a0874; font-weight: bold;">export</span> <span style="color: #007800;">ACLOCAL_PATH</span>=<span style="color: #007800;">$MONO_PREFIX</span><span style="color: #000000; font-weight: bold;">/</span>share<span style="color: #000000; font-weight: bold;">/</span><span style="color: #c20cb9; font-weight: bold;">aclocal</span>
<span style="color: #7a0874; font-weight: bold;">export</span> <span style="color: #007800;">PKG_CONFIG_PATH</span>=<span style="color: #007800;">$MONO_PREFIX</span><span style="color: #000000; font-weight: bold;">/</span>lib<span style="color: #000000; font-weight: bold;">/</span>pkgconfig:<span style="color: #007800;">$GNOME_PREFIX</span><span style="color: #000000; font-weight: bold;">/</span>lib<span style="color: #000000; font-weight: bold;">/</span>pkgconfig
<span style="color: #7a0874; font-weight: bold;">export</span> <span style="color: #007800;">PATH</span>=<span style="color: #007800;">$MONO_PREFIX</span><span style="color: #000000; font-weight: bold;">/</span>bin:<span style="color: #007800;">$PATH</span>
<span style="color: #007800;">PS1</span>=<span style="color: #ff0000;">&quot;[mono] \w @ &quot;</span></pre>
<p>Along with setting appropriate environment variables to only use sources from /opt/mono and /opt/gnome, it also sets the Bash prompt to something other than the default, so it is easy to detect when Bash is in this alternate environment.
</p><p>Finally, to enter this environment at any time, run the following from a Bash prompt:
</p>
<pre class="bash" style="font-family:monospace;"><span style="color: #7a0874; font-weight: bold;">source</span> ~<span style="color: #000000; font-weight: bold;">/</span>mono-dev-env</pre>
<p>Once in the environment, sources can be built and installed.
</p>
<h2> <span class="mw-headline" id="Building_Sources"> Building Sources </span></h2>
<p><i>This section details only building from released source tarballs. Building from cloned Mono Git sources is similar. These instructions are based on the Mono 1.1.9.1 release. Subsequent releases should have similar build procedures, but tarball file names will change.</i>
</p>
<h3> <span class="mw-headline" id="libgdiplus"> libgdiplus </span></h3>
<p>Ensure you have all development packages installed for TIFF, PNG, GIF, and JPEG libraries before configuring.
</p>
<pre class="bash" style="font-family:monospace;"><span style="color: #c20cb9; font-weight: bold;">tar</span> zxf libgdiplus-1.1.9.1.tar.gz
<span style="color: #7a0874; font-weight: bold;">cd</span> libgdiplus-1.1.9.1
.<span style="color: #000000; font-weight: bold;">/</span>configure <span style="color: #660033;">--prefix</span>=<span style="color: #000000; font-weight: bold;">/</span>opt<span style="color: #000000; font-weight: bold;">/</span>mono
<span style="color: #c20cb9; font-weight: bold;">make</span>
<span style="color: #c20cb9; font-weight: bold;">sudo</span> <span style="color: #c20cb9; font-weight: bold;">make</span> <span style="color: #c20cb9; font-weight: bold;">install</span></pre>
<h3> <span class="mw-headline" id="mono"> mono </span></h3>
<p><i>Under SUSE 10, compilation may fail. See the fix <a href="http://lists.ximian.com/pipermail/mono-list/2005-October/028833.html" class="external text" rel="nofollow">related to the VER_1</a> ld build error.</i>
</p>
<pre class="bash" style="font-family:monospace;"><span style="color: #c20cb9; font-weight: bold;">tar</span> zxf mono-1.1.9.1.tar.gz
<span style="color: #7a0874; font-weight: bold;">cd</span> mono-1.1.9.1
.<span style="color: #000000; font-weight: bold;">/</span>configure <span style="color: #660033;">--prefix</span>=<span style="color: #000000; font-weight: bold;">/</span>opt<span style="color: #000000; font-weight: bold;">/</span>mono
<span style="color: #c20cb9; font-weight: bold;">make</span>
<span style="color: #c20cb9; font-weight: bold;">sudo</span> <span style="color: #c20cb9; font-weight: bold;">make</span> <span style="color: #c20cb9; font-weight: bold;">install</span></pre>
<h3> <span class="mw-headline" id="gtk-sharp"> gtk-sharp </span></h3>
<pre class="bash" style="font-family:monospace;"><span style="color: #c20cb9; font-weight: bold;">tar</span> zxf gtk-sharp-1.0.10.tar.gz
<span style="color: #7a0874; font-weight: bold;">cd</span> gtk-sharp-1.0.10
.<span style="color: #000000; font-weight: bold;">/</span>configure <span style="color: #660033;">--prefix</span>=<span style="color: #000000; font-weight: bold;">/</span>opt<span style="color: #000000; font-weight: bold;">/</span>mono
<span style="color: #c20cb9; font-weight: bold;">make</span>
<span style="color: #c20cb9; font-weight: bold;">sudo</span> <span style="color: #c20cb9; font-weight: bold;">make</span> <span style="color: #c20cb9; font-weight: bold;">install</span></pre>
<p><i>Note: make may fail the first time here, for some unknown reason, running make a second time works.</i>
</p>
<h3> <span class="mw-headline" id="gtk-sharp-2"> gtk-sharp-2 </span></h3>
<pre class="bash" style="font-family:monospace;"><span style="color: #c20cb9; font-weight: bold;">tar</span> zxf gtk-sharp-2.3.91.tar.gz
<span style="color: #7a0874; font-weight: bold;">cd</span> gtk-sharp-2.3.91
.<span style="color: #000000; font-weight: bold;">/</span>configure <span style="color: #660033;">--prefix</span>=<span style="color: #000000; font-weight: bold;">/</span>opt<span style="color: #000000; font-weight: bold;">/</span>mono
<span style="color: #c20cb9; font-weight: bold;">make</span>
<span style="color: #c20cb9; font-weight: bold;">sudo</span> <span style="color: #c20cb9; font-weight: bold;">make</span> <span style="color: #c20cb9; font-weight: bold;">install</span></pre>
<p><i>Note: make may fail the first time here, for some unknown reason, running make a second time works.</i>
</p>
<h3> <span class="mw-headline" id="mono-tools"> mono-tools </span></h3>
<pre class="bash" style="font-family:monospace;"><span style="color: #c20cb9; font-weight: bold;">tar</span> zxvf mono-tools-1.1.9.tar.gz
<span style="color: #7a0874; font-weight: bold;">cd</span> mono-tools-1.1.9
.<span style="color: #000000; font-weight: bold;">/</span>configure <span style="color: #660033;">--prefix</span>=<span style="color: #000000; font-weight: bold;">/</span>opt<span style="color: #000000; font-weight: bold;">/</span>mono
<span style="color: #c20cb9; font-weight: bold;">make</span>
<span style="color: #c20cb9; font-weight: bold;">sudo</span> <span style="color: #c20cb9; font-weight: bold;">make</span> <span style="color: #c20cb9; font-weight: bold;">install</span></pre>
<h2> <span class="mw-headline" id="Conclusion"> Conclusion </span></h2>
<p>A fully independent Mono environment should now be available in /opt/mono.
</p>
<h3> <span class="mw-headline" id="Tip:_Your_first_build"> Tip: Your first build </span></h3>
<p>Your first build will take place from the "mono" directory, that will do an initial build.  Make sure that you "make install" after you are done, and you make sure that the new "mono" is in your path.
</p><p>You can do this by running "mono --version", and it should hopefully be a different version than what you have installed, or you can use the command "which mono", and it should point to the mono version in the prefix you have chosen.
</p>
<h3> <span class="mw-headline" id="Tip:_Rebuilding_Class_Library_Parts"> Tip: Rebuilding Class Library Parts </span></h3>
<p>It is not necessary to rebuild the entire Mono every time you make a change in a class library.   For example, if you just updated something in mcs/class/System.Web, do this:
</p>
<pre class="bash" style="font-family:monospace;"><span style="color: #7a0874; font-weight: bold;">cd</span> mcs<span style="color: #000000; font-weight: bold;">/</span>class<span style="color: #000000; font-weight: bold;">/</span>System.Web
<span style="color: #c20cb9; font-weight: bold;">make</span> <span style="color: #000000; font-weight: bold;">&amp;&amp;</span> <span style="color: #c20cb9; font-weight: bold;">make</span> <span style="color: #c20cb9; font-weight: bold;">install</span></pre>
<p>That will build and install only that directory.
</p><p>In addition, if you are developing code for the 4.0 API, you must instruct make to build and install 4.0 components, so that looks like this:
</p>
<pre class="bash" style="font-family:monospace;"><span style="color: #7a0874; font-weight: bold;">cd</span> mcs<span style="color: #000000; font-weight: bold;">/</span>class<span style="color: #000000; font-weight: bold;">/</span>System.Web
<span style="color: #c20cb9; font-weight: bold;">make</span> <span style="color: #007800;">PROFILE</span>=net_4_0 <span style="color: #000000; font-weight: bold;">&amp;&amp;</span> <span style="color: #c20cb9; font-weight: bold;">make</span> <span style="color: #c20cb9; font-weight: bold;">install</span> <span style="color: #007800;">PROFILE</span>=net_4_0</pre>
<h3> <span class="mw-headline" id="Tip:_CONFIG_SITE"> Tip: CONFIG_SITE </span></h3>
<p>Try adding this to the script:
</p><p>export CONFIG_SITE="$HOME/.config/automake/config.site"
</p><p>and in that file writing:
</p><p>test "$prefix" = NONE &amp;&amp; prefix=/opt/mono
</p><p>This will let you avoid typing --prefix all the time
</p>
<h3> <span class="mw-headline" id="Tip:_MONO_GAC_PREFIX"> Tip: MONO_GAC_PREFIX </span></h3>
<p>MONO_GAC_PREFIX is a colon-separated list of prefixes that should be searched for GAC directories.  It is particularly useful for using your OS-provided GAC within your parallel environment.
</p><p>For example, if I have Gtk# 1.0.x installed as part of my primary environment under /usr/lib/mono/gac/gtk-sharp and you want to build Gtk# 1.0 applications using your parallel environment under /opt/mono.  There are two ways to do this:
</p>
<ol><li> Build Gtk# 1.0.x yourself and install it with the prefix $MONO_PREFIX.
</li><li> export MONO_GAC_PREFIX=/usr.  This will allow your parallel environment to find the Gtk# 1.0 libraries provided by your distribution.
</li></ol>
<h3> <span class="mw-headline" id="BEWARE:_pkgconfig_fallback_behaviour"> BEWARE: pkgconfig fallback behaviour </span></h3>
<p>If you intend to leave your MONO_GAC_PREFIX empty to use a local GAC, beware about the fallback behaviour of pkgconfig when it doesn't find things in your local env: it will search in /usr/ and /usr/local/ in a hardcoded way.
</p><p>This may lead you to think that the configure scripts of your programs are buggy or lack some detection of libs because the build phase would be successful but you'll encounter errors at runtime.
</p>
<h2> <span class="mw-headline" id="Common_Problems"> Common Problems </span></h2>
<p>Sometimes, the wrapper shell scripts for system installed programs to not write out the full path to mono. For example, while in this new environment, you might execute /usr/bin/monodevelop. Sometimes, this results in the <b>new</b> mono being used. If this is the case, you should report a bug to the developer. Likewise, even if you specify a path like /opt/mono/bin/monodevelop, the old mono may be used.
</p>
