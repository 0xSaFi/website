---
layout: obsolete
title: "Accessibility: Moonlight Sandbox"
permalink: /old_site/Accessibility:_Moonlight_Sandbox/
redirect_from:
  - /Accessibility:_Moonlight_Sandbox/
---

<h1>Accessibility: Moonlight Sandbox</h1>

<table id="toc" class="toc"><tr><td><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Moonlight_Sandbox"><span class="tocnumber">1</span> <span class="toctext">Moonlight Sandbox</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#Tasks_for_Research_Week"><span class="tocnumber">1.1</span> <span class="toctext">Tasks for Research Week</span></a>
<ul>
<li class="toclevel-3 tocsection-3"><a href="#Provider"><span class="tocnumber">1.1.1</span> <span class="toctext">Provider</span></a>
<ul>
<li class="toclevel-4 tocsection-4"><a href="#Deliverables"><span class="tocnumber">1.1.1.1</span> <span class="toctext">Deliverables</span></a></li>
<li class="toclevel-4 tocsection-5"><a href="#Research"><span class="tocnumber">1.1.1.2</span> <span class="toctext">Research</span></a></li>
<li class="toclevel-4 tocsection-6"><a href="#Links"><span class="tocnumber">1.1.1.3</span> <span class="toctext">Links</span></a></li>
</ul>
</li>
<li class="toclevel-3 tocsection-7"><a href="#Bridge"><span class="tocnumber">1.1.2</span> <span class="toctext">Bridge</span></a>
<ul>
<li class="toclevel-4 tocsection-8"><a href="#Deliverables_2"><span class="tocnumber">1.1.2.1</span> <span class="toctext">Deliverables</span></a></li>
</ul>
</li>
<li class="toclevel-3 tocsection-9"><a href="#Plugin_integration"><span class="tocnumber">1.1.3</span> <span class="toctext">Plugin integration</span></a>
<ul>
<li class="toclevel-4 tocsection-10"><a href="#Deliverables_3"><span class="tocnumber">1.1.3.1</span> <span class="toctext">Deliverables</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-2 tocsection-11"><a href="#Requirements_for_Moonlight_development"><span class="tocnumber">1.2</span> <span class="toctext">Requirements for Moonlight development</span></a></li>
<li class="toclevel-2 tocsection-12"><a href="#Running_the_Moonlight_2.0_unit_test_suite"><span class="tocnumber">1.3</span> <span class="toctext">Running the Moonlight 2.0 unit test suite</span></a></li>
</ul>
</li>
</ul>
</td></tr></table>
<h1> <span class="mw-headline" id="Moonlight_Sandbox"> Moonlight Sandbox </span></h1>
<p>This is a space to collect ideas about the Moonlight work for Phase 2.
</p>
<h2> <span class="mw-headline" id="Tasks_for_Research_Week"> Tasks for Research Week </span></h2>
<p>We'll attack research week from three fronts:
</p>
<h3> <span class="mw-headline" id="Provider"> Provider </span></h3>
<ul><li> Investigate the API that existing Microsoft Silverlight 2 providers use
<ul><li> Specifically, what standard System.Windows.Automation API needs to be implemented?  What about System.Automation.Peers?
</li></ul>
</li><li> Determine what level of effort will be required to implement that API, or alternatively to adapt providers to use our existing API
</li><li> What kind of integration will be necessary with the moon repo?  Does moon need to depend on our uia2atk repository?  If so, how will that work?
</li><li> How much effort is required to complete the UIA providers for RuntimeControls?
</li></ul>
<h4> <span class="mw-headline" id="Deliverables"> Deliverables </span></h4>
<ul><li> A summary of your findings sent to the team via email.  Additionally, an hour estimate for completing the Runtime Controls, and for any necessary API modifications.
</li></ul>
<h4> <span class="mw-headline" id="Research"> Research </span></h4>
<ul><li> Silverlight 2 is a subset of WPF and supports building complex user interfaces, so basically you can define flexible composite Controls, for example, a ListBox containing Grids, and those Grids containing StackPanels and those StackPanels containing Buttons, and so on.
</li><li> Accessibility in SL2 is defined using AutomationPeers, there is an AutomationPeer for each control, for example ButtonAutomationPeer is used by ButtonControl.
</li><li> Accessibility in SL2 is initialized automatically by Silverlight 2 by calling an overridden method: SWAP.AutomationPeer.OnCreateAutomationPeer, this method returns and instance that should not be destroyed until the associated control is disposed, same approach as in MonoUIAutomationWinforms.
</li><li> AutomationPeer is not equal to IRawElementProviderSimple, however there's a method to cast from IRawElementProviderSimple: <i>AutomationPeer.PeerFromProvider</i>
</li><li> There's a factory FrameworkElementAutomationPeer to create peers: <i>CreatePeerForElement(UIElement)</i>, similar to ProviderFactory.GetProvider and <i>SWAP.XXXXXPeer.FromElement(UIElement)</i>, similar to ProviderFactory.FindProvider.
</li><li> Navigation is different, IRawElementProviderFragment doesn't exist, so there is no explicit sibling navigation, 2 methods replace IRawElementProviderFragment.Navigate: AutomationPeer.GetParent and AutomationPeer.GetChildren.
</li><li> Patterns and properties implementation is similar, however due to attached properties in Silverlight we need to implement a new class: SWA.AutomationProperties (see table below) to support DependencyObject.GetValue/DependencyObject.SetValue.
</li><li> There are some AutomationPeer classes already implemented (found in the Sample Source Code for Silverlight 2 Runtime and SDK Controls) however the core (primitives and simple controls) are not implemented in this source code.
</li></ul>
<table border="1">
<tr>
<th colspan="3"> API difference
</th></tr>
<tr>
<td> <b>.NET 3.5</b>
</td>
<td> <b>Silverlight 2</b>
</td></tr>
<tr>
<td colspan="3"> Namespace <i>System.Windows.Automation</i>
</td></tr>
<tr>
<td> -TextPattern
</td>
<td> +TextPattern
</td></tr>
<tr>
<td> ---
</td>
<td> +AutomationProperties
</td></tr>
<tr>
<td> UIAutomationTypes.dll
</td>
<td> System.Windows.dll
</td></tr>
<tr>
<td colspan="3"> Namespace <i>System.Windows.Automation.Peers</i>
</td></tr>
<tr>
<td> Doesn't not exist
</td>
<td> Must be implemented (Similar to MonoUIAutomationWinforms)
</td></tr>
<tr>
<td> ---
</td>
<td> System.Windows.dll
</td></tr>
<tr>
<td colspan="3"> Namespace <i>System.Windows.Automation.Provider</i>
</td></tr>
<tr>
<td> ---
</td>
<td> Subset of .NET 3.5
</td></tr>
<tr>
<td> UIAutomationProvider.dll
</td>
<td> System.Windows.dll
</td></tr>
<tr>
<td colspan="3"> <i>Automation Events</i>
</td></tr>
<tr>
<td> Using SWAProvider.AutomationInteropProvider.RaiseXXXXEvent methods
</td>
<td> Using SWAPeers.AutomationPeer.RaiseXXXXEvents methods
</td></tr></table>
<h4> <span class="mw-headline" id="Links"> Links </span></h4>
<ul><li> <a href="http://www.code-magazine.com/Article.aspx?quickid=0810062" class="external text" rel="nofollow">Creating Accessibility-aware Silverlight 2 Content</a>
</li><li> <a href="http://www.microsoft.com/Downloads/details.aspx?familyid=BCE7684A-507B-4FC6-BC99-6933CD690CAB&amp;displaylang=en" class="external text" rel="nofollow">Microsoft® Silverlight™ 2 Software Development Kit Documentation</a>
</li><li> <a href="http://www.microsoft.com/downloads/details.aspx?FamilyID=EB83ED4C-AC85-4DE9-8395-285628EE2254&amp;displaylang=en" class="external text" rel="nofollow">Sample Source Code for Silverlight 2 Runtime and SDK Controls</a>
</li></ul>
<h3> <span class="mw-headline" id="Bridge"> Bridge </span></h3>
<ul><li> How should the bridge be loaded and integrate with the providers?
</li><li> Where should the bridge reside so that it can be used by moon?
</li><li> How do SL2 controls map to Atk.Roles?  Will any additional bridge work be required to support the SL2 controls?
</li></ul>
<h4> <span class="mw-headline" id="Deliverables_2"> Deliverables </span></h4>
<ul><li> Email report with a plan for loading and integrating the bridge with the providers.
</li><li> A list of SL2 controls and which Atk.Role they map to.
</li><li> A high-level breakdown and ballpark hour estimate for any bridge customization required for the SL2 controls.
</li></ul>
<h3> <span class="mw-headline" id="Plugin_integration"> Plugin integration </span></h3>
<ul><li> How can a FF plugin inject an Atk.Object into the DOM tree?
</li><li> How will the Bridge be distributed so that it can be used by the plugin?
</li></ul>
<h4> <span class="mw-headline" id="Deliverables_3"> Deliverables </span></h4>
<ul><li> Email to the team containing an hour estimate for integration, and a proposal for how it should be integrated and distributed.
</li></ul>
<p><br />
</p>
<h2> <span class="mw-headline" id="Requirements_for_Moonlight_development"> Requirements for Moonlight development </span></h2>
<ul><li> mozilla-nspr-devel
</li><li> mozilla-nss-devel
</li><li> mozilla-xulrunner190-devel
</li><li> ImageMagick-devel
</li><li> libMagick++-devel
</li><li> fetchmsttfonts, to avoid failures when running moon-unit (still using OpenSUSE 11? follow <a href="http://www.benkevan.com/blog/installing-microsoft-fonts-on-opensuse-110/" class="external text" rel="nofollow">this</a>)
</li></ul>
<h2> <span class="mw-headline" id="Running_the_Moonlight_2.0_unit_test_suite"> Running the Moonlight 2.0 unit test suite </span></h2>
<ul><li> cd moon/test/
</li><li> make install-test-plugin
</li><li> make install-test
</li></ul>
<ul><li> cd moon/test/2.0/moon-unit
</li><li> make test
</li></ul>

