---
layout: obsolete
title: "MonoMac/Documentation/API Design"
permalink: /old_site/MonoMac/Documentation/API_Design/
redirect_from:
  - /MonoMac/Documentation/API_Design/
---

<h1>MonoMac/Documentation/API Design</h1>

<table id="toc" class="toc"><tr><td><div id="toctitle"><h2>Table of contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#API_Design"><span class="tocnumber">1</span> <span class="toctext">API Design</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#Overview"><span class="tocnumber">1.1</span> <span class="toctext">Overview</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="#Design_Principles"><span class="tocnumber">1.2</span> <span class="toctext">Design Principles</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#Unbound_Types_.26_Members"><span class="tocnumber">1.3</span> <span class="toctext">Unbound Types &amp; Members</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#Major_Namespaces"><span class="tocnumber">1.4</span> <span class="toctext">Major Namespaces</span></a>
<ul>
<li class="toclevel-3 tocsection-6"><a href="#MonoMac.ObjCRuntime"><span class="tocnumber">1.4.1</span> <span class="toctext">MonoMac.ObjCRuntime</span></a></li>
<li class="toclevel-3 tocsection-7"><a href="#MonoMac.Foundation"><span class="tocnumber">1.4.2</span> <span class="toctext">MonoMac.Foundation</span></a>
<ul>
<li class="toclevel-4 tocsection-8"><a href="#NSObject"><span class="tocnumber">1.4.2.1</span> <span class="toctext">NSObject</span></a></li>
<li class="toclevel-4 tocsection-9"><a href="#PreserveAttribute"><span class="tocnumber">1.4.2.2</span> <span class="toctext">PreserveAttribute</span></a></li>
</ul>
</li>
<li class="toclevel-3 tocsection-10"><a href="#MonoMac.AppKit"><span class="tocnumber">1.4.3</span> <span class="toctext">MonoMac.AppKit</span></a></li>
<li class="toclevel-3 tocsection-11"><a href="#OpenGL"><span class="tocnumber">1.4.4</span> <span class="toctext">OpenGL</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-12"><a href="#Binding_Design"><span class="tocnumber">1.5</span> <span class="toctext">Binding Design</span></a>
<ul>
<li class="toclevel-3 tocsection-13"><a href="#Types"><span class="tocnumber">1.5.1</span> <span class="toctext">Types</span></a></li>
<li class="toclevel-3 tocsection-14"><a href="#Inheritance"><span class="tocnumber">1.5.2</span> <span class="toctext">Inheritance</span></a></li>
<li class="toclevel-3 tocsection-15"><a href="#Types_and_Interface_Builder"><span class="tocnumber">1.5.3</span> <span class="toctext">Types and Interface Builder</span></a></li>
<li class="toclevel-3 tocsection-16"><a href="#Delegates"><span class="tocnumber">1.5.4</span> <span class="toctext">Delegates</span></a>
<ul>
<li class="toclevel-4 tocsection-17"><a href="#Via_Events"><span class="tocnumber">1.5.4.1</span> <span class="toctext">Via Events</span></a></li>
<li class="toclevel-4 tocsection-18"><a href="#Via_Properties"><span class="tocnumber">1.5.4.2</span> <span class="toctext">Via Properties</span></a></li>
<li class="toclevel-4 tocsection-19"><a href="#Strongly_typed_via_a_Delegate_property"><span class="tocnumber">1.5.4.3</span> <span class="toctext">Strongly typed via a Delegate property</span></a></li>
<li class="toclevel-4 tocsection-20"><a href="#Loosely_typed_via_the_WeakDelegate_property"><span class="tocnumber">1.5.4.4</span> <span class="toctext">Loosely typed via the WeakDelegate property</span></a></li>
<li class="toclevel-4 tocsection-21"><a href="#Mapping_of_the_Objective-C_delegate_pattern_to_C.23"><span class="tocnumber">1.5.4.5</span> <span class="toctext">Mapping of the Objective-C delegate pattern to C#</span></a></li>
</ul>
</li>
<li class="toclevel-3 tocsection-22"><a href="#Responding_to_Events"><span class="tocnumber">1.5.5</span> <span class="toctext">Responding to Events</span></a></li>
<li class="toclevel-3 tocsection-23"><a href="#Models"><span class="tocnumber">1.5.6</span> <span class="toctext">Models</span></a></li>
<li class="toclevel-3 tocsection-24"><a href="#Interface_Builder_Outlets_and_C.23"><span class="tocnumber">1.5.7</span> <span class="toctext">Interface Builder Outlets and C#</span></a></li>
<li class="toclevel-3 tocsection-25"><a href="#Selectors"><span class="tocnumber">1.5.8</span> <span class="toctext">Selectors</span></a></li>
<li class="toclevel-3 tocsection-26"><a href="#NSObject_Constructrors"><span class="tocnumber">1.5.9</span> <span class="toctext">NSObject Constructrors</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-27"><a href="#Memory_Management"><span class="tocnumber">1.6</span> <span class="toctext">Memory Management</span></a>
<ul>
<li class="toclevel-3 tocsection-28"><a href="#NSObject_and_IDisposable"><span class="tocnumber">1.6.1</span> <span class="toctext">NSObject and IDisposable</span></a></li>
<li class="toclevel-3 tocsection-29"><a href="#When_to_call_Dispose"><span class="tocnumber">1.6.2</span> <span class="toctext">When to call Dispose</span></a></li>
<li class="toclevel-3 tocsection-30"><a href="#When_to_Keep_References_to_Objects"><span class="tocnumber">1.6.3</span> <span class="toctext">When to Keep References to Objects</span></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</td></tr></table>
<h1> <span class="mw-headline" id="API_Design">API Design</span></h1>
<h2> <span class="mw-headline" id="Overview">Overview</span></h2>
<p>In addition to the core Base Class Libraries that are part of Mono, <a href="{{site.github.url}}/old_site/MonoMac" title="MonoMac">MonoMac</a> ships with bindings for various APIs to allow developers to create native Mac OS X applications with Mono.
</p><p>At the core of MonoMac there is an interop engine that bridges the C# world with the Objective-C world as well as bindings for the OSX C-based APIs like CoreGraphics and <a href="#OpenGL">OpenGL</a>.
</p><p>The low-level runtime to communicate with Objective-C code is in the <a href="#MonoMac.ObjCRuntime">MonoMac.ObjCRuntime</a>. On top of this foundation bindings for <a href="#MonoMac.Foundation">Foundation</a>, CoreFoundation and <a href="#MonoMac.AppKit">AppKit</a> are provided.
</p>
<h2> <span class="mw-headline" id="Design_Principles">Design Principles</span></h2>
<p>These are some of our design principles for the MonoMac binding:
</p>
<ul><li> Follow the Framework Design Guidelines
</li><li> Allow developers to subclass Objective-C classes
<ul><li> Subclass should work with C# standard constructs
<ul><li> Derive from an existing class
</li><li> Call base constructor to chain
</li><li> Overriding methods should be done with C#'s override system
</li></ul>
</li><li> Do not expose developers to Objective-C selectors.
</li></ul>
</li><li> Provide a mechanism to call arbitrary Objective-C libraries
</li><li> Make common Objective-C tasks easy, and hard Objective-C tasks possible
</li><li> Expose Objective-C properties as C# properties
</li><li> Expose a strongly typed API:
<ul><li> Increase type-safety
</li><li> Minimize runtime errors
</li><li> Get IDE intellisense on return types
</li><li> Allows for IDE popup documentation
</li><li> Encourage in-IDE exploration of the APIs:
</li></ul>
</li><li> Native C# types:
<ul><li> [MonoMac/Documentation/API_Design/NSString|NSString becomes string]]
</li><li> Turn int and uint parameters that should have been enums as C# enumerations and C# enumerations with [Flags] attributes.
</li><li> Instead of type-neutral NSArray objects expose arrays as strongly typed arrays.
<ul><li> Example: instead of <i>NSArray *getViews</i>, we expose the strongly typed: <i>NSView [] Views { get; set; }</i> which gives MonoDevelop a nicer code completion experience.
</li></ul>
</li></ul>
</li><li> Events and notifications, give users a choice between:
<ul><li> Support the Objective-C delegate pattern:
<ul><li> Strongly typed version is the default&lt;/li&gt;
</li><li> Weakly typed version for advance use cases.&lt;/li&gt;
</li></ul>
</li><li> C# event system
</li></ul>
</li><li> Expose C# delegates (lambdas, anonymous methods and System.Delegate) to Objective-C APIs as <i>blocks</i>.
</li></ul>
<h2> <span class="mw-headline" id="Unbound_Types_.26_Members">Unbound Types &amp; Members</span></h2>
<p>At this point in time, not all Cocoa  types and members have been bound for use by managed code. Some frameworks consist solely of C code, and thus can be bound via <a href="{{site.github.url}}/old_site/Interop_with_Native_Libraries">P/Invoke</a>. Other frameworks are Objective-C code, and thus require <a href="{{site.github.url}}/old_site/MonoMac/Documentation/Binding_New_Objective-C_Types" title="MonoMac/Documentation/Binding New Objective-C Types">manual selector invocation</a>.
</p>
<h2> <span class="mw-headline" id="Major_Namespaces">Major Namespaces</span></h2>
<h3> <span class="mw-headline" id="MonoMac.ObjCRuntime">MonoMac.ObjCRuntime</span></h3>
<p>The <a href="http://docs.go-mono.com/MonoMac.ObjCRuntime" class="external text" rel="nofollow">MonoMac.ObjCRuntime</a> namespace allows developers to bridge the worlds between C# and Objective-C.
</p>
<h3> <span class="mw-headline" id="MonoMac.Foundation">MonoMac.Foundation</span></h3>
<p>The <a href="http://docs.go-mono.com/MonoMac.Foundation" class="external text" rel="nofollow">MonoMac.Foundation</a> namespace provides the basic data types designed to interoperate with the Objective-C Foundation framework that is part of Mac OS X and is the base for object oriented programming in Objective-C.
</p><p>MonoMac mirrors in C# the hierarchy of classes from Objective-C. For example, the Objective-C base class <a href="http://developer.apple.com/library/mac/#documentation/Cocoa/Reference/Foundation/Classes/NSObject_Class/Reference/Reference.html#//apple_ref/doc/uid/TP40003706" class="external text" rel="nofollow">NSObject</a> is usable from C# via <a href="http://docs.go-mono.com/MonoMac.Foundation.NSObject" class="external text" rel="nofollow">MonoMac.Foundation.NSObject</a>.
</p><p>Although this namespace provides bindings for the underlying Objective-C Foundation types, in a few cases we have mapped the underlying types to .NET types. For example:
</p>
<ol><li> Instead of dealing with <a href="http://developer.apple.com/library/mac/#documentation/Cocoa/Reference/Foundation/Classes/NSString_Class/Reference/NSString.html#//apple_ref/doc/uid/TP40003744" class="external text" rel="nofollow">NSString</a> and <a href="http://developer.apple.com/library/mac/#documentation/Cocoa/Reference/Foundation/Classes/NSArray_Class/NSArray.html#//apple_ref/doc/uid/TP40003620" class="external text" rel="nofollow">NSArray</a> the runtime instead exposes these as C# <a href="http://www.go-mono.com/docs/index.aspx?link=T:System.String" class="external text" rel="nofollow">string</a> and strongly typed <a href="http://www.go-mono.com/docs/index.aspx?link=T:System.Array" class="external text" rel="nofollow">" array</a>s throughout the API.
</li><li> Various helper APIs are exposed here to allow developers to bind third party Objective-C APIs, other OS X APIs or APIs that are not currently bound by MonoMac.
</li></ol>
<p>For more details on binding APIs see the <a href="{{site.github.url}}/old_site/MonoMac/Documentation/Binding_New_Objective-C_Types" title="MonoMac/Documentation/Binding New Objective-C Types">MonoMac Binding Generator</a>  section.
</p>
<h4> <span class="mw-headline" id="NSObject">NSObject</span></h4>
<p>The <a href="http://docs.go-mono.com/MonoMac.Foundation.NSObject" class="external text" rel="nofollow">NSObject</a> type is the foundation for all the Objective-C bindings. MonoMac types mirror two classes of types from the OS X Cocoa APIs: the C types (typically referred to as CoreFoundation types) and the Objective-C types (these all derive from the NSObject class).
</p><p>For each type that mirrors an unmanaged type, it is possible to obtain the native object through the <a href="http://docs.go-mono.com/MonoMac.Foundation.NSObject.Handle" class="external text" rel="nofollow">Handle</a>
</p><p>While Mono will provide garbage collection for all of your objects, we made the <i>MonoMac.Foundation.NSObject'</i> implement the <a href="http://docs.go-mono.com/System.IDisposable" class="external text" rel="nofollow">System.IDisposable</a> interface. This means that you can explicitly release the resources of any given NSObject without having to wait for the Garbage Collector to kick-in. This is important when you are using heavy NSObjects, for example, NSImages that might hold pointers to large blocks of data.
</p><p>If your type needs to perform deterministic finalization, override the <a href="http://docs.go-mono.com/MonoMac.Foundation.NSObject.Dispose%20(bool)" class="external free" rel="nofollow">http://docs.go-mono.com/MonoMac.Foundation.NSObject.Dispose%20(bool)</a> NSObject.Dispose(bool) method]. The parameter to Dispose is <i>bool disposing</i>, and if set to <i>true</i> it means that your Dispose method is being called because the user explicitly called <i>Dispose()</i> on the object. If the value is false, this means that your Dispose(bool disposing) method is being called from the finalizer on the finalizer thread.
</p>
<h4> <span class="mw-headline" id="PreserveAttribute">PreserveAttribute</span></h4>
<p>PreserveAttribute is a custom attribute that is used to tell btouch, the MonoMac deployment tool, to preserve a type, or a member of a type, during the phase the application is processed to reduce its size.
</p><p>Every member that is not statically linked by the application is subject to be remove. This attribute is hence used to mark members that are not statically referenced, but that are still needed by your application.
</p><p>For instance, if you instantiate types dynamically, you may want to preserve the default constructor of your types. If you use XML serialization, you may want to preserve the properties of your types.
</p><p>You can apply this attribute on every member of a type, or on the type itself. If you want to preserve the whole type, you can use the syntax [Preserve (AllMembers = true)] on the type.
</p>
<h3> <span class="mw-headline" id="MonoMac.AppKit">MonoMac.AppKit</span></h3>
<p>The <a href="http://docs.go-mono.com/MonoMac.AppKit" class="external text" rel="nofollow">MonoMac.AppKit</a> namespace contains a one to one mapping to all of the UI components that make up Cocoa in the form of C# classes. The API has been modified to follow the conventions used in the C# language.
</p><p>C# delegates are provided for common operations. See the <a href="#Delegates">delegates</a> section for more information.
</p>
<h3> <span class="mw-headline" id="OpenGL">OpenGL</span></h3>
<p>For OpenGL we use the <a href="http://docs.go-mono.com/MonoMac.OpenGL" class="external text" rel="nofollow">MonoMac.OpenGL</a> namespace,  an object-oriented binding to OpenGL based on <a href="http://opentk.org" class="external text" rel="nofollow">OpenTK</a> that has been modified to use CoreGraphics data types and structures as well as only exposing the functionality that is available on Mac OS X.
</p>
<h2> <span class="mw-headline" id="Binding_Design">Binding Design</span></h2>
<p>MonoMac is not merely a binding to the underlying Objective-C platform. It extends the .NET type system and dispatch system to better blend C# and Objective-C.
</p><p>Just like P/Invoke is a useful tool to invoke native libraries on Windows and Linux, or how IJW support can be used for COM interop on Windows, MonoMac extends the runtime to support binding C# objects to Objective-C objects.
</p><p>The discussion in the next few sections is not necessary for users that are creating MonoMac applications, but will help developers understand how things are done and will assist them when creating more complicated applications.
</p>
<h3> <span class="mw-headline" id="Types">Types</span></h3>
<p>Where it made sense, we exposed C# types instead of low-level MonoMac.Foundation types to the C# universe. This means that <a href="{{site.github.url}}/old_site/MonoMac/Documentation/API_Design/NSString" title="MonoMac/Documentation/API Design/NSString">the API uses the C# "string" type instead of NSString</a> and it uses strongly typed C# arrays instead of exposing NSArray.
</p><p>Additionally, instead of exposing CGRect, CGPoint and CGSize from the CoreGraphics API, we replaced those with the System.Drawing implementations RectF, PointF and SizeF as they would help developers preserve existing OpenGL code that uses OpenTK.
</p>
<h3> <span class="mw-headline" id="Inheritance">Inheritance</span></h3>
<p>The MonoMac API design allows developers to extend native Objective-C types in the same way that they would extend a C# type, using the "override" keyword on a derived class as well as chaining up to the base implementation using the "base" C# keyword.
</p><p>This design allows developers to avoid dealing with Objective-C selectors as part of their development process as the entire Objective-C system is wrapped already by the MonoMac libraries.
</p>
<h3> <span class="mw-headline" id="Types_and_Interface_Builder">Types and Interface Builder</span></h3>
<p>When you create .NET classes that are instances of types created by Interface Builder, you need to provide a constructor that takes a single IntPtr parameter. This is required to bind the managed object instance with the unmanaged object. The code consists of a single line, like this:
</p>
<pre class="csharp" style="font-family:monospace;"><span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #0600FF; font-weight: bold;">partial</span> <span style="color: #6666cc; font-weight: bold;">class</span> <span style="color: #6666cc; font-weight: bold;">void</span> MyView <span style="color: #008000;">:</span> NSView <span style="color: #008000;">&#123;</span>
   <span style="color: #008080; font-style: italic;">// This is the constructor that you need to add.</span>
&#160;
   <span style="color: #0600FF; font-weight: bold;">public</span> MyView <span style="color: #008000;">&#40;</span>IntPtr handle<span style="color: #008000;">&#41;</span> <span style="color: #008000;">:</span> <span style="color: #0600FF; font-weight: bold;">base</span> <span style="color: #008000;">&#40;</span>handle<span style="color: #008000;">&#41;</span> <span style="color: #008000;">&#123;</span><span style="color: #008000;">&#125;</span>
&#160;
<span style="color: #008000;">&#125;</span></pre>
<h3> <span class="mw-headline" id="Delegates">Delegates</span></h3>
<p>Objective-C and C# have different meanings for the words delegate in each language.
</p><p>In the Objective-C world and in the documentation that you will find online about Cocoa, a delegate is typically an instance of a class that will respond to a set of methods. This is very similar to a C# interface with the difference that the methods are not always mandatory.
</p><p>These delegates play an important role in UIKit and other Cocoa APIs. They are used for various things:
</p>
<ul><li> To provide notifications to your code (Similar to event delivery in C# or Gtk+)
</li><li> To implement models for data visualization controls.
</li><li> To drive the behavior of a control.
</li></ul>
<p>The programming pattern was designed to minimize the creation of derived classes to alter behavior for a control. This solution is similar in spirit to what other GUI toolkits have done over the years: Gtk's signals, Qt slots, Winforms events, WPF/Silverlight events and so on. To avoid having hundreds of interfaces (one for each action) or requiring developers to implement too many methods they do not need, Objective-C supports optional method definitions. This is different than C# interfaces that require all methods to be implemented.
</p><p>In Objective-C classes, you will see that classes that use this programming pattern expose a property, usually called <i>delegate</i> which is required to implement the mandatory parts of the interface and zero or more of the optional parts.
</p><p>In MonoMac we offer four mutually exclusive mechanisms to bind to these delegates:
</p>
<ul><li> <a href="#Via_Events">Via events</a>.
</li><li> <a href="#Via_Properties">Via properties</a>.
</li><li> <a href="#Strongly_typed_via_a_Delegate_property">Strongly typed via a <i>Delegate</i> property</a>.
</li><li> [[#Loosely_typed_via_the_WeakDelegate_property|Loosely typed via a <i>WeakDelegate</i> property.
</li></ul>
<p>For example, consider the <a href="http://developer.apple.com/library/mac/#documentation/Cocoa/Reference/WebKit/Classes/WebView_Class/Reference/Reference.html#//apple_ref/doc/uid/TP40003822" class="external text" rel="nofollow">WebView</a> class. This dispatches to a <a href="http://developer.apple.com/library/mac/#documentation/Cocoa/Reference/WebKit/Protocols/WebFrameLoadDelegate_Protocol/Reference/Reference.html#//apple_ref/doc/uid/TP40003828" class="external text" rel="nofollow">WebFrameLoadDelegate</a> instance which is assigned to the <a href="http://developer.apple.com/library/mac/#documentation/Cocoa/Reference/WebKit/Classes/WebView_Class/Reference/Reference.html#//apple_ref/doc/uid/TP40003822" class="external text" rel="nofollow">frameLoadDelegate</a> property.
</p>
<h4> <span class="mw-headline" id="Via_Events">Via Events</span></h4>
<p>For many types, MonoMac will automatically create an appropriate delegate which will forward the e.g. <i>WebFrameLoadDelegate</i> calls onto C# events. For <i>WebView</i>:
</p>
<ul><li> The <a href="http://developer.apple.com/library/mac/#documentation/Cocoa/Reference/WebKit/Protocols/WebFrameLoadDelegate_Protocol/Reference/Reference.html#//apple_ref/doc/uid/TP40003828" class="external text" rel="nofollow">webView:didStartProvisionalLoadForFrame:</a> method is mapped to the <a href="http://docs.go-mono.com/MonoMac.WebKit.WebView.StartedProvisionalLoad" class="external text" rel="nofollow">WebView.StartedProvisionalLoad</a> event.
</li><li> The <a href="http://developer.apple.com/library/mac/#documentation/Cocoa/Reference/WebKit/Protocols/WebFrameLoadDelegate_Protocol/Reference/Reference.html#//apple_ref/doc/uid/TP40003828" class="external text" rel="nofollow">webView:didFinishLoadForFrame:</a> method is mapped to the <a href="http://docs.go-mono.com/MonoMac.WebKit.WebView.FinishedLoad" class="external text" rel="nofollow">WebView.FinishedLoad</a> event.
</li><li> The <a href="http://developer.apple.com/library/mac/#documentation/Cocoa/Reference/WebKit/Protocols/WebFrameLoadDelegate_Protocol/Reference/Reference.html#//apple_ref/doc/uid/TP40003828" class="external text" rel="nofollow">webView:didFailLoadWithError:forFrame:</a> method is mapped to the <a href="http://docs.go-mono.com/MonoMac.WebKit.WebView.FailedLoadWithError" class="external text" rel="nofollow">WebView.FailedLoadWithError</a> event.
</li></ul>
<p>For example, this simple program times the time it takes to load a web view:
</p>
<pre class="csharp" style="font-family:monospace;">DateTime startTime, endTime<span style="color: #008000;">;</span>
<span style="color: #0600FF; font-weight: bold;">var</span> web <span style="color: #008000;">=</span> <a href="http://www.google.com/search?q=new+msdn.microsoft.com"><span style="color: #008000;">new</span></a> WebView <span style="color: #008000;">&#40;</span><a href="http://www.google.com/search?q=new+msdn.microsoft.com"><span style="color: #008000;">new</span></a> RectangleF <span style="color: #008000;">&#40;</span><span style="color: #FF0000;">0</span>, <span style="color: #FF0000;">0</span>, <span style="color: #FF0000;">200</span>, <span style="color: #FF0000;">200</span><span style="color: #008000;">&#41;</span>, <span style="color: #666666;">&quot;frameName&quot;</span>, <span style="color: #666666;">&quot;groupName&quot;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
web<span style="color: #008000;">.</span><span style="color: #0000FF;">StartedProvisionalLoad</span>  <span style="color: #008000;">+=</span> <span style="color: #008000;">&#40;</span>o, e<span style="color: #008000;">&#41;</span> <span style="color: #008000;">=&amp;</span>gt<span style="color: #008000;">;</span> startTime <span style="color: #008000;">=</span> DateTime<span style="color: #008000;">.</span><span style="color: #0000FF;">Now</span><span style="color: #008000;">;</span>
web<span style="color: #008000;">.</span><span style="color: #0000FF;">FinishedLoad</span>            <span style="color: #008000;">+=</span> <span style="color: #008000;">&#40;</span>o, e<span style="color: #008000;">&#41;</span> <span style="color: #008000;">=&amp;</span>gt<span style="color: #008000;">;</span> end <span style="color: #008000;">=</span> DateTime<span style="color: #008000;">.</span><span style="color: #0000FF;">Now</span><span style="color: #008000;">;</span></pre>
<h4> <span class="mw-headline" id="Via_Properties">Via Properties</span></h4>
<p>Events are useful when there might be more than one subscriber to the event. We also limit events to cases where there is no return value from the code.
</p><p>For cases where the code is expected to return a value, we opted instead for properties. This means that only one method can be set at a given time in an object. 
</p><p>For example, you can use this mechanism to dismiss the keyboard on the screen on the handler for a NSTextField:
</p>
<pre class="csharp" style="font-family:monospace;"><span style="color: #6666cc; font-weight: bold;">void</span> SetupTextField <span style="color: #008000;">&#40;</span>NSTextField tf<span style="color: #008000;">&#41;</span>
<span style="color: #008000;">&#123;</span>
    tf<span style="color: #008000;">.</span><span style="color: #0000FF;">TextShouldEndEditing</span> <span style="color: #008000;">=</span> <span style="color: #008000;">&#40;</span>control, fieldEditor<span style="color: #008000;">&#41;</span> <span style="color: #008000;">=&amp;</span>gt<span style="color: #008000;">;</span> <span style="color: #008000;">&#123;</span>
        tf<span style="color: #008000;">.</span><span style="color: #0000FF;">ResignFirstResponder</span> <span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
        <span style="color: #0600FF; font-weight: bold;">return</span> <span style="color: #0600FF; font-weight: bold;">true</span><span style="color: #008000;">;</span>
    <span style="color: #008000;">&#125;</span><span style="color: #008000;">;</span>
<span style="color: #008000;">&#125;</span></pre>
<p>The NSTextField's TextShouldEndEditing property in this case takes as an argument a delegate that returns a bool value and determines whether the TextField should do something with the Return button being pressed.
</p>
<h4> <span class="mw-headline" id="Strongly_typed_via_a_Delegate_property">Strongly typed via a Delegate property</span></h4>
<p>If you would prefer not to use events, you can provide your own <a href="http://docs.go-mono.com/MonoMac.WebKit.WebFrameLoadDelegate" class="external text" rel="nofollow">WebFrameLoadDelegate</a> subclass and assign it to the <a href="http://docs.go-mono.com/MonoMac.WebKit.WebView.FrameLoadDelegate" class="external text" rel="nofollow">WebView.FrameLoadDelegate</a> property. Once <i>WebView.FrameLoadDelegate</i> has been assigned, the <i>WebView</i> event dispatch mechanism will no longer function, and the WebFrameLoadDelegate methods will be invoked when the corresponding events occur.
</p><p>For example, this simple type records the time it takes to load a web view:
</p>
<pre class="csharp" style="font-family:monospace;"><span style="color: #6666cc; font-weight: bold;">class</span> Notifier <span style="color: #008000;">:</span> WebFrameLoadDelegate <span style="color: #008000;">&#123;</span>
    DateTime startTime, endTime<span style="color: #008000;">;</span>
&#160;
    <span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #0600FF; font-weight: bold;">override</span> <span style="color: #6666cc; font-weight: bold;">void</span> StartedProvisionalLoad <span style="color: #008000;">&#40;</span>WebView sender, WebFrame forFrame<span style="color: #008000;">&#41;</span>
    <span style="color: #008000;">&#123;</span>
        startTime <span style="color: #008000;">=</span> DateTime<span style="color: #008000;">.</span><span style="color: #0000FF;">Now</span><span style="color: #008000;">;</span>
    <span style="color: #008000;">&#125;</span>
&#160;
    <span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #0600FF; font-weight: bold;">override</span> <span style="color: #6666cc; font-weight: bold;">void</span> FinishedLoad <span style="color: #008000;">&#40;</span>WebView sender, WebFrame forFrame<span style="color: #008000;">&#41;</span>
    <span style="color: #008000;">&#123;</span>
        endTime <span style="color: #008000;">=</span> DateTime<span style="color: #008000;">.</span><span style="color: #0000FF;">Now</span><span style="color: #008000;">;</span>
    <span style="color: #008000;">&#125;</span>
<span style="color: #008000;">&#125;</span></pre>
<p>The above is used in code like this:
</p>
<pre class="csharp" style="font-family:monospace;"><span style="color: #0600FF; font-weight: bold;">var</span> web <span style="color: #008000;">=</span> <a href="http://www.google.com/search?q=new+msdn.microsoft.com"><span style="color: #008000;">new</span></a> WebView <span style="color: #008000;">&#40;</span><a href="http://www.google.com/search?q=new+msdn.microsoft.com"><span style="color: #008000;">new</span></a> RectangleF <span style="color: #008000;">&#40;</span><span style="color: #FF0000;">0</span>, <span style="color: #FF0000;">0</span>, <span style="color: #FF0000;">200</span>, <span style="color: #FF0000;">200</span><span style="color: #008000;">&#41;</span>, <span style="color: #666666;">&quot;frameName&quot;</span>, <span style="color: #666666;">&quot;groupName&quot;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
web<span style="color: #008000;">.</span><span style="color: #0000FF;">frameLoadDelegate</span> <span style="color: #008000;">=</span> <a href="http://www.google.com/search?q=new+msdn.microsoft.com"><span style="color: #008000;">new</span></a> Notifier <span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span></pre>
<p>The above will create a <i>WebView</i> and it will instruct it to send messages to an instance of <i>Notifier</i>, a class that we created to respond to messages.
</p><p>This pattern is also used to control behavior for certain controls. <i>TODO: Example.</i>
</p><p>The pattern is also used to provide the data on demand for a few controls. For example the <a href="http://docs.go-mono.com/MonoMac.AppKit.NSTableView" class="external text" rel="nofollow">NSTableView</a> control is a powerful table rendering control and both the look and the contents are driven by an instace of a <a href="http://docs.go-mono.com/MonoMac.AppKit.NSTableViewDataSource" class="external text" rel="nofollow">NSTableViewDataSource</a> set in the <a href="http://docs.go-mono.com/MonoMac.AppKit.NSTableView.DataSource" class="external text" rel="nofollow">NSTableView.DataSource</a> property.
</p>
<h4> <span class="mw-headline" id="Loosely_typed_via_the_WeakDelegate_property">Loosely typed via the WeakDelegate property</span></h4>
<p>In addition to the strongly typed property, there is also a weak typed delegate that allows the developer to bind things differently if desired. Everywhere where a strongly typed <i>Delegate</i> property is exposed in MonoMac's binding a corresponding <i>WeakDelegate</i> property is also exposed.
</p><p>When using the <i>WeakDelegate</i> you are responsible for properly decorating your class using the <a href="http://docs.go-mono.com/MonoMac.Foundation.ExportAttribute" class="external text" rel="nofollow">ExportAttribute</a> attribute to specify the selector. For example:
</p>
<pre class="csharp" style="font-family:monospace;"><span style="color: #6666cc; font-weight: bold;">class</span> Notifier <span style="color: #008000;">:</span> NSObject <span style="color: #008000;">&#123;</span>
    DateTime startTime, endTime<span style="color: #008000;">;</span>
&#160;
		<span style="color: #008000;">&#91;</span>Export <span style="color: #008000;">&#40;</span><span style="color: #666666;">&quot;webView:didStartProvisionalLoadForFrame:&quot;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">&#93;</span>
		<span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">void</span> StartedProvisionalLoad <span style="color: #008000;">&#40;</span>WebView sender, WebFrame forFrame<span style="color: #008000;">&#41;</span>
    <span style="color: #008000;">&#123;</span>
        startTime <span style="color: #008000;">=</span> DateTime<span style="color: #008000;">.</span><span style="color: #0000FF;">Now</span><span style="color: #008000;">;</span>
    <span style="color: #008000;">&#125;</span>
&#160;
		<span style="color: #008000;">&#91;</span>Export <span style="color: #008000;">&#40;</span><span style="color: #666666;">&quot;webView:didFinishLoadForFrame:&quot;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">&#93;</span>
		<span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">void</span> FinishedLoad <span style="color: #008000;">&#40;</span>WebView sender, WebFrame forFrame<span style="color: #008000;">&#41;</span>
		<span style="color: #008000;">&#123;</span>
        endTime <span style="color: #008000;">=</span> DateTime<span style="color: #008000;">.</span><span style="color: #0000FF;">Now</span><span style="color: #008000;">;</span>
		<span style="color: #008000;">&#125;</span>
<span style="color: #008000;">&#125;</span>
&#160;
<span style="color: #008080; font-style: italic;">// ...</span>
<span style="color: #0600FF; font-weight: bold;">var</span> web <span style="color: #008000;">=</span> <a href="http://www.google.com/search?q=new+msdn.microsoft.com"><span style="color: #008000;">new</span></a> WebView <span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
web<span style="color: #008000;">.</span><span style="color: #0000FF;">WeakDelegate</span> <span style="color: #008000;">=</span> <a href="http://www.google.com/search?q=new+msdn.microsoft.com"><span style="color: #008000;">new</span></a> Notifier <span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span></pre>
<p>Note that once the <i>WeakDelegate</i> property has been assigned, the <i>Delegate</i> property will not be used. Additionally, if you implement the method in an inherited base class that you wish to [Export] you must make it a public method. 
</p>
<h4> <span class="mw-headline" id="Mapping_of_the_Objective-C_delegate_pattern_to_C.23">Mapping of the Objective-C delegate pattern to C#</span></h4>
<p>When you see Objective-C samples that look like this:
</p>
<pre>
foo.delegate = [[SomethingDelegate alloc] init];
</pre>
<p>This instructs the language to create and construct an instance of the class <i>SomethingDelegate</i> and assign the value to the delegate property on the foo variable. This mechanism is supported by MonoMac and C# the syntax is:
</p>
<pre class="csharp" style="font-family:monospace;">foo<span style="color: #008000;">.</span><span style="color: #6666cc; font-weight: bold;">Delegate</span> <span style="color: #008000;">=</span> <a href="http://www.google.com/search?q=new+msdn.microsoft.com"><span style="color: #008000;">new</span></a> SomethingDelegate <span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span></pre>
<p>In MonoMac we have provided strongly-typed classes that map to the Objective-C delegate classes. To use them, you will be subclassing and overriding the methods defined by MonoMac's implementation. For more information on how they work, see the section <a href="#Models">Models</a> below.
</p><p><br />
</p>
<h3> <span class="mw-headline" id="Responding_to_Events">Responding to Events</span></h3>
<p>In Objective-C code sometimes event handlers for multiple controls and provides for information for multiple controls will be hosted in the same class. This is possible because classes respond to messages, and as long as a class responds to that message it is possible to link objects together.
</p><p>As previously detailed, MonoMac supports both the Objective-C delegate pattern, when you can create a new class that implements the delegate and override the desired methods as well as the C# event-based programming model.
</p><p>It is also possible to support Objective-C's pattern where responders for multiple different operations are all hosted in the same instance of a class. To do this though, you will have to use low-level features of the MonoMac binding.
</p><p>For example, if you wanted your class to respond both to the <i>NSTextFieldDelegate.control:textShouldEndEditing:</i> message as well as the <i>NSWebViewDelegate.webView:didStartProvisionalLoadForFrame:</i> message in the same instance of a class you would have to use the [Export] attribute declaration. It would look like this:
</p><p>		[Export ("webView:didStartProvisionalLoadForFrame:")]
</p>
<pre class="csharp" style="font-family:monospace;"><span style="color: #6666cc; font-weight: bold;">class</span> MyCallbacks <span style="color: #008000;">:</span> NSObject <span style="color: #008000;">&#123;</span>
&#160;
		<span style="color: #008000;">&#91;</span>Export <span style="color: #008000;">&#40;</span><span style="color: #666666;">&quot;control:textShouldEndEditing:&quot;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">&#93;</span>
    <span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">bool</span> ShouldEndEditing <span style="color: #008000;">&#40;</span>NSControl control, NSText textShouldEndEditing<span style="color: #008000;">&#41;</span>
    <span style="color: #008000;">&#123;</span>
        <span style="color: #0600FF; font-weight: bold;">return</span> <span style="color: #0600FF; font-weight: bold;">true</span><span style="color: #008000;">;</span>
    <span style="color: #008000;">&#125;</span>
&#160;
		<span style="color: #008000;">&#91;</span>Export <span style="color: #008000;">&#40;</span><span style="color: #666666;">&quot;webView:didStartProvisionalLoadForFrame:&quot;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">&#93;</span>
		<span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">void</span> StartedProvisionalLoad <span style="color: #008000;">&#40;</span>WebView sender, WebFrame forFrame<span style="color: #008000;">&#41;</span>
    <span style="color: #008000;">&#123;</span>
        <span style="color: #008080; font-style: italic;">// loading started...</span>
    <span style="color: #008000;">&#125;</span>
<span style="color: #008000;">&#125;</span></pre>
<p>The C# names for the methods are not important, all that matters are the strings passed to the [Export] attribute.
</p><p>When using this style of programming you are responsible for making sure that the C# parameters match the actual types that the runtime engine will pass.
</p>
<h3> <span class="mw-headline" id="Models">Models</span></h3>
<p>In AppKit storage facilities or responders are implemented using helper classes, these are usually referred in the Objective-C code as delegates and they are implemented as protocols.
</p><p>Objective-C protocols are like interfaces, but they support optional methods, that is, not all of the methods need to be implemented for the protocol to work.
</p><p>There are two ways of implementing a model, you can either implement it manually or use the existing strongly typed definitions.
</p><p>The manual mechanism is necessary when you try to implement a class that has not been bound by MonoMac. It is very easy to do, all you have to do is:
</p>
<ul><li> Flag your class for registration with the runtime&lt;/li&gt;
</li><li> Apply the [Export] attribute with the actual selector name on each method you want to override&lt;/li&gt;
</li><li> Instantiate the class, and pass it.&lt;/li&gt;
</li></ul>
<p>For example, the following implement only one of the optional methods in the UIApplicationDelegate protocol definition:
</p>
<pre class="csharp" style="font-family:monospace;"><span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">class</span> MyAppController <span style="color: #008000;">:</span> NSObject <span style="color: #008000;">&#123;</span>
    <span style="color: #008000;">&#91;</span>Export <span style="color: #008000;">&#40;</span><span style="color: #666666;">&quot;applicationDidFinishLaunching:&quot;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">&#93;</span>
    <span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">void</span> DidFinishLaunching <span style="color: #008000;">&#40;</span>NSNotification notification<span style="color: #008000;">&#41;</span>
    <span style="color: #008000;">&#123;</span>
        SetupWindow <span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
    <span style="color: #008000;">&#125;</span>
<span style="color: #008000;">&#125;</span></pre>
<p>The Objective-C selector name ("applicationDidFinishLaunching:") is declared with the Export attribute and the class is registered with the [Register] attribute.
</p><p>MonoMac provides already strongly typed declarations ready to use that do not require manual binding. To support this programming model, the MonoMac runtime supports the [Model] attribute on a class declaration. This informs the runtime that it should not wire up all the methods in the class, unless the method is explicitly implemented.
</p><p>This means that in MonoMac.AppKitKit the classes that represent a protocol with optional methods are written like this:
</p>
<pre class="csharp" style="font-family:monospace;"><span style="color: #008000;">&#91;</span>Model<span style="color: #008000;">&#93;</span>
<span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">class</span> SomeViewModel <span style="color: #008000;">:</span> NSObject <span style="color: #008000;">&#123;</span>
    <span style="color: #008000;">&#91;</span>Export <span style="color: #008000;">&#40;</span><span style="color: #666666;">&quot;someMethod:&quot;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">&#93;</span>
    <span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #0600FF; font-weight: bold;">virtual</span> <span style="color: #6666cc; font-weight: bold;">int</span> SomeMethod <span style="color: #008000;">&#40;</span>TheView view<span style="color: #008000;">&#41;</span> <span style="color: #008000;">&#123;</span>
       <span style="color: #0600FF; font-weight: bold;">throw</span> <a href="http://www.google.com/search?q=new+msdn.microsoft.com"><span style="color: #008000;">new</span></a> ModelNotImplementedException <span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
    <span style="color: #008000;">&#125;</span>
    <span style="color: #008000;">...</span>
<span style="color: #008000;">&#125;</span></pre>
<p>When you want to implement a model that only implements some of the methods all you have to do is to override the methods that you are interested in, and ignore the other methods. The runtime will only hook up the overwritten methods, not the original methods to the Objective-C world.
</p><p>The equivalent to the previous manual sample is:
</p>
<pre class="csharp" style="font-family:monospace;"><span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">class</span> AppController <span style="color: #008000;">:</span> UIApplicationDelegate <span style="color: #008000;">&#123;</span>
    <span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #0600FF; font-weight: bold;">override</span> <span style="color: #6666cc; font-weight: bold;">void</span> DidFinishedLaunching <span style="color: #008000;">&#40;</span>NSNotification notification<span style="color: #008000;">&#41;</span>
    <span style="color: #008000;">&#123;</span>
        <span style="color: #008000;">...</span>
    <span style="color: #008000;">&#125;</span>
<span style="color: #008000;">&#125;</span></pre>
<p>The advantage is that there is no need to dig into the Objective-C header files to find the selector, the types of the arguments, the mapping to C# and that you get intellisense from MonoDevelop and strong types.
</p>
<h3> <span class="mw-headline" id="Interface_Builder_Outlets_and_C.23">Interface Builder Outlets and C#</span></h3>
<p>This is a low-level description of how Outlets integrate with C# and is provided for advanced users of MonoMac. When using MonoDevelop the mapping is done automatically behind the scenes using generated code on the flight for you.
</p><p>When you design your user interface with Interface Builder, you will only be designing the look of the application and will establish some default connections. If you want to programatically fetch information, alter the behavior of a control at runtime or modify the control at runtime, it is necessary to bind some of the controls to your managed code.
</p><p>This is done in a few steps:
</p>
<ol><li> Add the outlet declaration to your "File's owner".
</li><li> Connect your control to the "File's owner".
</li><li> Store the UI plus the connections into your XIB/NIB file.
</li><li> Load the NIB file at runtime.
</li><li> Access the outlet variable.
</li></ol>
<p>The steps (1) through (3) are covered in Apple's documentation for building interfaces with Interface Builder.
</p><p>When using MonoMac your application will need to create a class that derives from <a href="http://docs.go-mono.com/MonoMac.AppKit.NSViewController" class="external text" rel="nofollow">NSViewController</a> and implement it like this:
</p>
<pre class="csharp" style="font-family:monospace;"><span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">class</span> MyViewController <span style="color: #008000;">:</span> NSViewController <span style="color: #008000;">&#123;</span>
    <span style="color: #0600FF; font-weight: bold;">public</span> MyViewController <span style="color: #008000;">&#40;</span><span style="color: #6666cc; font-weight: bold;">string</span> nibName, NSBundle bundle<span style="color: #008000;">&#41;</span> <span style="color: #008000;">:</span> <span style="color: #0600FF; font-weight: bold;">base</span> <span style="color: #008000;">&#40;</span>nibName, bundle<span style="color: #008000;">&#41;</span>
    <span style="color: #008000;">&#123;</span>
        <span style="color: #008080; font-style: italic;">// You can have as many arguments as you want, but you need to call</span>
        <span style="color: #008080; font-style: italic;">// the base constructor with the provided nibName and bundle.</span>
    <span style="color: #008000;">&#125;</span>
<span style="color: #008000;">&#125;</span></pre>
<p>Then to load your ViewController from a NIB file, you do this:
</p>
<pre class="csharp" style="font-family:monospace;"><span style="color: #0600FF; font-weight: bold;">var</span> controller <span style="color: #008000;">=</span> <a href="http://www.google.com/search?q=new+msdn.microsoft.com"><span style="color: #008000;">new</span></a> MyViewController <span style="color: #008000;">&#40;</span><span style="color: #666666;">&quot;HelloWorld&quot;</span>, NSBundle<span style="color: #008000;">.</span><span style="color: #0000FF;">MainBundle</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span></pre>
<p>This loads the user interface from the NIB. Now, to access the outlets, it is necessary to inform the runtime that we want to access them. To do this, the <code>UIViewController</code> subclass needs to declare the properties and annotate them with the [Connect] attribute. Like this:
</p>
<pre class="csharp" style="font-family:monospace;"><span style="color: #008000;">&#91;</span>Connect<span style="color: #008000;">&#93;</span>
NSTextField UserName <span style="color: #008000;">&#123;</span>
    <span style="color: #0600FF; font-weight: bold;">get</span> <span style="color: #008000;">&#123;</span>
        <span style="color: #0600FF; font-weight: bold;">return</span> <span style="color: #008000;">&#40;</span>UITextField<span style="color: #008000;">&#41;</span> GetNativeField <span style="color: #008000;">&#40;</span><span style="color: #666666;">&quot;UserName&quot;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
    <span style="color: #008000;">&#125;</span>
    <span style="color: #0600FF; font-weight: bold;">set</span> <span style="color: #008000;">&#123;</span>
        SetNativeField <span style="color: #008000;">&#40;</span><span style="color: #666666;">&quot;UserName&quot;</span>, <span style="color: #0600FF; font-weight: bold;">value</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
    <span style="color: #008000;">&#125;</span>
<span style="color: #008000;">&#125;</span></pre>
<p>The property implementation is the one that actually fetches and stores the value for the actual native type.
</p><p>You do not need to worry about this when using MonoDevelop and InterfaceBuilder. MonoDevelop automatically mirrors all the declared outlets with code in a partial class that is compiled as part of your project.
</p>
<h3> <span class="mw-headline" id="Selectors">Selectors</span></h3>
<p>A core concept of Objective-C programming are selectors. You will often come across APIs that require you to pass a selector, or expects your code to respond to a selector.
</p><p>Creating new selectors in C# is very easy, you just create a new instance of the <a href="http://docs.go-mono.com/MonoMac.ObjCRuntime.Selector" class="external text" rel="nofollow">MonoMac.ObjCRuntime.Selector</a> class and use the result in any place in the API that requires it. For example:
</p>
<pre class="csharp" style="font-family:monospace;"><span style="color: #0600FF; font-weight: bold;">var</span> selector_add <span style="color: #008000;">=</span> <a href="http://www.google.com/search?q=new+msdn.microsoft.com"><span style="color: #008000;">new</span></a> Selector <span style="color: #008000;">&#40;</span><span style="color: #666666;">&quot;add:plus:&quot;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span></pre>
<p>To make a C# method respond to a selector call, you need to inherit from the NSObject type and decorating your C# method with the selector name using the [Export] attribute, for example:
</p>
<pre class="csharp" style="font-family:monospace;"><span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">class</span> MyMath <span style="color: #008000;">:</span> NSObject <span style="color: #008000;">&#123;</span>
    <span style="color: #008000;">&#91;</span>Export <span style="color: #008000;">&#40;</span><span style="color: #666666;">&quot;add:plus:&quot;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">&#93;</span>
    <span style="color: #6666cc; font-weight: bold;">int</span> <span style="color: #0600FF; font-weight: bold;">Add</span> <span style="color: #008000;">&#40;</span><span style="color: #6666cc; font-weight: bold;">int</span> first, <span style="color: #6666cc; font-weight: bold;">int</span> second<span style="color: #008000;">&#41;</span>
    <span style="color: #008000;">&#123;</span>
         <span style="color: #0600FF; font-weight: bold;">return</span> first <span style="color: #008000;">+</span> second<span style="color: #008000;">;</span>
    <span style="color: #008000;">&#125;</span>
<span style="color: #008000;">&#125;</span></pre>
<p>Note that selector names <b>must</b> match exactly, including all intermediate and trailing colons (":") if present.
</p>
<h3> <span class="mw-headline" id="NSObject_Constructrors">NSObject Constructrors</span></h3>
<p>Most classes in MonoMac that derive from NSObject will expose constructors specific to the functionality of the object, but they will also expose various constructors that are not immediately obvious.
</p><p>The constructors are used as follows:
</p>
<dl><dt><b>public Foo (IntPtr handle)</b>
</dt><dd> This constructor is used to instantiate your class when the runtime needs to map your class to an unmanaged class. This happens when you load a XIB/NIB file. The Objective-C runtime will have at this point created an object in the unmanaged world and this constructor will be called to initialize the managed side.
</dd><dd> Typically all you need to do is call the base constructor with the handle parameter and in your body do any initialization that is necessary.
</dd><dt><b>public Foo ()</b>
</dt><dd> This is the default constructor for a class, and in MonoTouch provided classes this initializes the MonoTouch.Foundation.NSObject class and all of the classes in between and at the end chains this to Objective's C "init" method on the class.
</dd><dt><b>public Foo (NSObjectFlag x)</b>
</dt><dd> This constructor is used to initialize the instance, but prevent the code from calling the Objective-C "init" method at the end. You typically use this when you already have registered for initialization (when you use [Export] on your constructor) or when you have already done your initialization through another mean.
</dd><dt><b>public Foo (NSCoder coder)</b>
</dt><dd> This constructor is provided for the cases where the object is being initialized from an NSCoding instance. For more information see Apple's &lt;a href="<a href="http://developer.apple.com/mac/library/documentation/Cocoa/Conceptual/Archiving/index.html#//apple_ref/doc/uid/10000047i" class="external free" rel="nofollow">http://developer.apple.com/mac/library/documentation/Cocoa/Conceptual/Archiving/index.html#//apple_ref/doc/uid/10000047i</a>" title="<a href="http://developer.apple.com/mac/library/documentation/Cocoa/Conceptual/Archiving/index.html#//apple_ref/doc/uid/10000047i" class="external free" rel="nofollow">http://developer.apple.com/mac/library/documentation/Cocoa/Conceptual/Archiving/index.html#//apple_ref/doc/uid/10000047i</a>" class="external"&gt;Archives and Serialization Programming Guide&lt;/a&gt;.
</dd></dl>
<p>The MonoMac API design does not raise Objective-C exceptions as C# exceptions. The design enforces that no garbage be sent to the Objective-C world in the first place and that any exceptions that must be produced are produced by the binding itself before invalid data is ever passed to the Objective-C world.
</p>
<h2> <span class="mw-headline" id="Memory_Management">Memory Management</span></h2>
<p>MonoMac has a garbage collector that will take care of releasing resources for you when they are no longer in use. In addition to the garbage collector, all objects that derive from NSObject implement the System.IDisposable interface.
</p>
<h3> <span class="mw-headline" id="NSObject_and_IDisposable">NSObject and IDisposable</span></h3>
<p>Exposing the IDisposable interface is a convenient way of assisting developers in releasing objects that might encapsulate large blocks of memory (for example an UIImage might look like just an inocent pointer, but could be pointing to a 2 megabyte image) and also to other important and finite resources (like a video decoding buffer).
</p><p>NSObject implements the IDisposable interface and also the <a href="http://msdn.microsoft.com/en-us/library/fs2xkftw.aspx" class="external text" rel="nofollow">.NET Dispose pattern</a>. This allows developers that subclass NSObject to override the Dispose behavior and release their own resources on demand. For example, consider this view controller that keeps around a bunch of images:
</p>
<pre class="csharp" style="font-family:monospace;"><span style="color: #6666cc; font-weight: bold;">class</span> MenuViewController <span style="color: #008000;">:</span> UIViewController <span style="color: #008000;">&#123;</span>
    UIImage breakfast, lunch, dinner<span style="color: #008000;">;</span>
    <span style="color: #008000;">&#91;</span><span style="color: #008000;">...</span><span style="color: #008000;">&#93;</span>
    <span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #0600FF; font-weight: bold;">override</span> <span style="color: #6666cc; font-weight: bold;">void</span> Dispose <span style="color: #008000;">&#40;</span><span style="color: #6666cc; font-weight: bold;">bool</span> disposing<span style="color: #008000;">&#41;</span>
    <span style="color: #008000;">&#123;</span>
        <span style="color: #0600FF; font-weight: bold;">if</span> <span style="color: #008000;">&#40;</span>disposing<span style="color: #008000;">&#41;</span><span style="color: #008000;">&#123;</span>
             <span style="color: #0600FF; font-weight: bold;">if</span> <span style="color: #008000;">&#40;</span>breakfast <span style="color: #008000;">!=</span> <span style="color: #0600FF; font-weight: bold;">null</span><span style="color: #008000;">&#41;</span> breakfast<span style="color: #008000;">.</span><span style="color: #0000FF;">Dispose</span> <span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span> breakfast <span style="color: #008000;">=</span> <span style="color: #0600FF; font-weight: bold;">null</span><span style="color: #008000;">;</span>
             <span style="color: #0600FF; font-weight: bold;">if</span> <span style="color: #008000;">&#40;</span>lunch <span style="color: #008000;">!=</span> <span style="color: #0600FF; font-weight: bold;">null</span><span style="color: #008000;">&#41;</span> lunch<span style="color: #008000;">.</span><span style="color: #0000FF;">Dispose</span> <span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span> lunch <span style="color: #008000;">=</span> <span style="color: #0600FF; font-weight: bold;">null</span><span style="color: #008000;">;</span>
             <span style="color: #0600FF; font-weight: bold;">if</span> <span style="color: #008000;">&#40;</span>dinner <span style="color: #008000;">!=</span> <span style="color: #0600FF; font-weight: bold;">null</span><span style="color: #008000;">&#41;</span> dinner<span style="color: #008000;">.</span><span style="color: #0000FF;">Dispose</span> <span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span> dinner <span style="color: #008000;">=</span> <span style="color: #0600FF; font-weight: bold;">null</span><span style="color: #008000;">;</span>
        <span style="color: #008000;">&#125;</span>
        <span style="color: #0600FF; font-weight: bold;">base</span><span style="color: #008000;">.</span><span style="color: #0000FF;">Dispose</span> <span style="color: #008000;">&#40;</span>disposing<span style="color: #008000;">&#41;</span>
    <span style="color: #008000;">&#125;</span>
<span style="color: #008000;">&#125;</span></pre>
<p>When a managed object is disposed, it is no longer useful. You might still have a reference to the objects, but the object is for all intents and purposes invalid at this point. Some .NET APIs ensure this by throwing an ObjectDisposedException if you try to access any methods on a disposed object, for example:
</p>
<pre class="csharp" style="font-family:monospace;"><span style="color: #0600FF; font-weight: bold;">var</span> image <span style="color: #008000;">=</span> UIImage<span style="color: #008000;">.</span><span style="color: #0000FF;">FromFile</span> <span style="color: #008000;">&#40;</span><span style="color: #666666;">&quot;demo.png&quot;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
image<span style="color: #008000;">.</span><span style="color: #0000FF;">Dispose</span> <span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
image<span style="color: #008000;">.</span><span style="color: #0000FF;">XXX</span> <span style="color: #008000;">=</span> <span style="color: #0600FF; font-weight: bold;">false</span><span style="color: #008000;">;</span>  <span style="color: #008080; font-style: italic;">// this at this point is an invalid operation</span></pre>
<p>Even if you can still access the variable "image", it is really an invalid reference and no longer points to the Objective-C object that held the image.
</p><p>But disposing an object in C# does not mean that the object will necessarily be destroyed. All you do is release the reference that C# had to the object. It is possible that the Cocoa environment might have kept a reference around for its own use. For example, if you set a NSImageView's Image property to an image, and then you dispose the image, the underlying UIImageView took its own reference and will keep a reference to this object until it is done using it.
</p>
<h3> <span class="mw-headline" id="When_to_call_Dispose">When to call Dispose</span></h3>
<p>You should call Dispose when you need Mono to get rid of your object. A possible use case is when Mono has no knowledge that your NSObject is actually holding a reference to an important resource like memory, or an information pool. In those cases, you should call Dispose to immediately release the reference to the memory, instead of waiting for Mono to perform a garbage collection cycle.
</p><p>Internally, when Mono creates <a href="{{site.github.url}}/old_site/MonoMac/Documentation/API_Design/NSString" title="MonoMac/Documentation/API Design/NSString">NSString references from C# strings</a>, it will dispose them immediately to reduce the amount of work that the garbage collector has to do. The fewer objects around to deal with, the faster the GC will run.
</p>
<h3> <span class="mw-headline" id="When_to_Keep_References_to_Objects">When to Keep References to Objects</span></h3>
<p>One side-effect that automatic memory management has is that the GC will get rid of unused objects as long as there are no references to them. This sometimes can have surprising side effects, for example, if you create a local variable to hold your toplevel view controller, or your toplevel window, and then having those vanish behind your back.
</p><p>If you do not keep a reference in your static or instance variables to your objects, Mono will happily call the Dispose() method on them, and they will release the reference to the object. Since this might be the only outstanding reference, the Objective-C runtime will destroy the object for you.
</p>
