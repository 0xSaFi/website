---
layout: obsolete
title: "MonoTouch ManualSelectorInvocation"
permalink: /old_site/MonoTouch_ManualSelectorInvocation/
redirect_from:
  - /MonoTouch_ManualSelectorInvocation/
---

<h1>MonoTouch ManualSelectorInvocation</h1>

<table id="toc" class="toc"><tr><td><div id="toctitle"><h2>Table of contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Objective-C_Selectors"><span class="tocnumber">1</span> <span class="toctext">Objective-C Selectors</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#Example"><span class="tocnumber">1.1</span> <span class="toctext">Example</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="#Invoking_a_Selector"><span class="tocnumber">1.2</span> <span class="toctext">Invoking a Selector</span></a>
<ul>
<li class="toclevel-3 tocsection-4"><a href="#Selector_Targets"><span class="tocnumber">1.2.1</span> <span class="toctext">Selector Targets</span></a></li>
<li class="toclevel-3 tocsection-5"><a href="#Selector_Names"><span class="tocnumber">1.2.2</span> <span class="toctext">Selector Names</span></a></li>
<li class="toclevel-3 tocsection-6"><a href="#Calling_objc_msgSend.28.29"><span class="tocnumber">1.2.3</span> <span class="toctext">Calling objc_msgSend()</span></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</td></tr></table>
<h1> <span class="mw-headline" id="Objective-C_Selectors"> Objective-C Selectors </span></h1>
<p>The Objective-C language is based upon <b>selectors</b>.  A selector is a message that can be sent to an object or a <b>class</b>.  MonoTouch maps instance selectors to instance methods, and class selectors to static methods.
</p><p>Unlike normal C functions (and like C++ member functions), you cannot directly invoke a selector using <a href="{{site.github.url}}/old_site/Dllimport" title="Dllimport" class="mw-redirect">P/Invoke</a>. (Aside: in theory you could use P/Invoke for non-virtual C++ member functions, but you'd need to worry about per-compiler name mangling, which is a world of pain better ignored.)  Instead, selectors are sent to an Objective-C class or instance using the <a href="http://developer.apple.com/mac/library/documentation/Cocoa/Reference/ObjCRuntimeRef/Reference/reference.html#//apple_ref/c/func/objc_msgSend" class="external text" rel="nofollow">objc_msgSend function</a>.
</p><p>You may find <a href="http://developer.apple.com/iphone/library/documentation/cocoa/conceptual/ObjCRuntimeGuide/Articles/ocrtHowMessagingWorks.html" class="external text" rel="nofollow">this helpful guide on Objective-C messaging</a> useful.
</p>
<h2> <span class="mw-headline" id="Example"> Example </span></h2>
<p>Suppose you want to invoke the <a href="http://developer.apple.com/iphone/library/documentation/UIKit/Reference/NSString_UIKit_Additions/Reference/Reference.html#//apple_ref/occ/instm/NSString/sizeWithFont:forWidth:lineBreakMode:" class="external text" rel="nofollow">-[NSString sizeWithFont:forWidth:lineBreakMode:</a>] selector.  The declaration (from Apple's documentation) is:
</p>
<dl><dd> - (CGSize)sizeWithFont:(UIFont *)font forWidth:(CGFloat)width  lineBreakMode:(UILineBreakMode)lineBreakMode
</dd></dl>
<p>The return type, GSize, is a <a href="http://www.go-mono.com/docs/monodoc.ashx?link=T%3aSystem.Drawing.SizeF" class="external text" rel="nofollow">System.Drawing.SizeF</a> in managed code (which is a value type).
</p><p>The <i>font</i> parameter is a <a href="http://www.go-mono.com/docs/monodoc.ashx?link=T%3aMonoTouch.UIKit.UIFont" class="external text" rel="nofollow">UIFont</a> (and a type (indirectly) derived from <a href="http://www.go-mono.com/docs/monodoc.ashx?link=T%3aMonoTouch.Foundation.NSObject" class="external text" rel="nofollow">NSObject</a>), and is thus mapped to <a href="http://www.go-mono.com/docs/monodoc.ashx?link=T:System.IntPtr" class="external text" rel="nofollow">System.IntPtr</a>.
</p><p>The width parameter, a CGFloat, is mapped to <a href="http://www.go-mono.com/docs/monodoc.ashx?link=T%3aSystem.Single" class="external text" rel="nofollow">System.Single</a>.
</p><p>The lineBreakMode parameter, a UILineBreakMode, has already been bound in MonoTouch as the <a href="http://www.go-mono.com/docs/monodoc.ashx?link=T%3aMonoTouch.UIKit.UILineBreakMode" class="external text" rel="nofollow">UILineBreakMode</a> enumeration.
</p><p>Put it all together, and we want an objc_msgSend declaration that matches:
</p>
<pre class="csharp" style="font-family:monospace;">SizeF objc_msgSend<span style="color: #008000;">&#40;</span>IntPtr target, IntPtr selector, IntPtr font, <span style="color: #6666cc; font-weight: bold;">float</span> width, UILineBreakMode mode<span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span></pre>
<p>Checking the <a href="http://www.go-mono.com/docs/monodoc.ashx?link=T%3aMonoTouch.ObjCRuntime.Messaging%2f*" class="external text" rel="nofollow">MonoTouch.ObjCRuntime.Messaging</a> members, we don't see a match for this prototype.  Consequently, we will need to declare it ourself:
</p>
<pre class="csharp" style="font-family:monospace;"><span style="color: #008000;">&#91;</span>DllImport <span style="color: #008000;">&#40;</span>MonoTouch<span style="color: #008000;">.</span><span style="color: #0000FF;">Constants</span><span style="color: #008000;">.</span><span style="color: #0000FF;">ObjectiveCLibrary</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">&#93;</span>
<span style="color: #0600FF; font-weight: bold;">static</span> <span style="color: #0600FF; font-weight: bold;">extern</span> SizeF cgsize_objc_msgSend_IntPtr_float_int <span style="color: #008000;">&#40;</span>
    IntPtr target, IntPtr selector,
    IntPtr font,
    <span style="color: #6666cc; font-weight: bold;">float</span> width,
    UILineBreakMode mode<span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span></pre>
<p>Once declared, we can invoke it once we have the appropriate parameters:
</p>
<pre class="csharp" style="font-family:monospace;">NSString      target <span style="color: #008000;">=</span> <span style="color: #008000;">...</span>
<span style="color: #0000FF;">Selector</span>    selector <span style="color: #008000;">=</span> <a href="http://www.google.com/search?q=new+msdn.microsoft.com"><span style="color: #008000;">new</span></a> Selector <span style="color: #008000;">&#40;</span><span style="color: #666666;">&quot;sizeWithFont:forWidth:lineBreakMode:&quot;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
UIFont          font <span style="color: #008000;">=</span> <span style="color: #008000;">...</span>
<span style="color: #6666cc; font-weight: bold;">float</span>          width <span style="color: #008000;">=</span> <span style="color: #008000;">...</span>
<span style="color: #0000FF;">UILineBreakMode</span> mode <span style="color: #008000;">=</span> <span style="color: #008000;">...</span>
&#160;
<span style="color: #0000FF;">SizeF</span> size <span style="color: #008000;">=</span> cgsize_objc_msgSend_IntPtr_float_int<span style="color: #008000;">&#40;</span>
    target<span style="color: #008000;">.</span><span style="color: #0000FF;">Handle</span>, selector<span style="color: #008000;">.</span><span style="color: #0000FF;">Handle</span>,
    font <span style="color: #008000;">==</span> <span style="color: #0600FF; font-weight: bold;">null</span> <span style="color: #008000;">?</span> IntPtr<span style="color: #008000;">.</span><span style="color: #0000FF;">Zero</span> <span style="color: #008000;">:</span> font<span style="color: #008000;">.</span><span style="color: #0000FF;">Handle</span>,
    width,
    mode<span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span></pre>
<h2> <span class="mw-headline" id="Invoking_a_Selector"> Invoking a Selector </span></h2>
<p>Invoking a selector has three steps:
</p>
<ol><li> Get the selector target.
</li><li> Get the selector name.
</li><li> Call objc_msgSend() with the appropriate arguments.
</li></ol>
<h3> <span class="mw-headline" id="Selector_Targets"> Selector Targets </span></h3>
<p>A selector target is either an object instance or an Objective-C class.  If the target is an instance and came from a bound MonoTouch type, use the <a href="http://www.go-mono.com/docs/monodoc.ashx?link=P%3aMonoTouch.ObjCRuntime.INativeObject.Handle" class="external text" rel="nofollow">MonoTouch.ObjCRuntime.INativeObject.Handle</a> property.
</p><p>If the target is a class, use <a href="http://www.go-mono.com/docs/monodoc.ashx?link=T%3aMonoTouch.ObjCRuntime.Class" class="external text" rel="nofollow">MonoTouch.ObjCRuntime.Class</a> to get a reference to the class instance, then use the <a href="http://www.go-mono.com/docs/monodoc.ashx?link=P%3aMonoTouch.ObjCRuntime.Class.Handle" class="external text" rel="nofollow">Class.Handle</a> property.
</p>
<h3> <span class="mw-headline" id="Selector_Names"> Selector Names </span></h3>
<p>Selector names are listed within Apple's documentation.  For example, the <a href="http://developer.apple.com/iphone/library/documentation/UIKit/Reference/NSString_UIKit_Additions/Reference/Reference.html" class="external free" rel="nofollow">http://developer.apple.com/iphone/library/documentation/UIKit/Reference/NSString_UIKit_Additions/Reference/Reference.html</a> UIKit NSString extension methods] include <a href="http://developer.apple.com/iphone/library/documentation/UIKit/Reference/NSString_UIKit_Additions/Reference/Reference.html#//apple_ref/occ/instm/NSString/sizeWithFont:" class="external text" rel="nofollow">sizeWithFont:</a> and <a href="http://developer.apple.com/iphone/library/documentation/UIKit/Reference/NSString_UIKit_Additions/Reference/Reference.html#//apple_ref/occ/instm/NSString/sizeWithFont:forWidth:lineBreakMode:" class="external text" rel="nofollow">sizeWithFont:forWidth:lineBreakMode:</a>. The embedded and trailing colons are important, and are part of the selector name.
</p><p>Once you have a selector name, you can create a <a href="http://www.go-mono.com/docs/monodoc.ashx?link=T%3aMonoTouch.ObjCRuntime.Selector" class="external text" rel="nofollow">MonoTouch.ObjCRuntime.Selector</a> instance for it.
</p>
<h3> <span class="mw-headline" id="Calling_objc_msgSend.28.29"> Calling objc_msgSend() </span></h3>
<p>When invoking objc_msgSend(), you must pass the selector target (an instance or class handle), the selector, and any arguments required by the selector.  To do so, you use a normal P/Invoke declaration for objc_msgSend().  The instance and selector arguments must be System.IntPtr, and all remaining arguments must match the type the selector expects.
</p><p>Objective-C types (e.g. NSString, NSDictionary, UIView, anything that has NSObject as an eventual base type) are passed as System.IntPtr.
</p><p>A set of pre-made objc_msgSend() declarations can be found in <a href="http://www.go-mono.com/docs/monodoc.ashx?link=T%3aMonoTouch.ObjCRuntime.Messaging%2f*" class="external text" rel="nofollow">MonoTouch.ObjCRuntime.Messaging</a>.
</p>
