---
layout: obsolete
title: "DTrace"
permalink: /old_site/DTrace/
redirect_from:
  - /DTrace/
---

<h1>DTrace</h1>

<table id="toc" class="toc"><tr><td><div id="toctitle"><h2>Table of contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Using_DTrace_with_Mono"><span class="tocnumber">1</span> <span class="toctext">Using DTrace with Mono</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#The_mono_provider"><span class="tocnumber">2</span> <span class="toctext">The mono provider</span></a>
<ul>
<li class="toclevel-2 tocsection-3"><a href="#ves-init-begin.2C_ves-init-end"><span class="tocnumber">2.1</span> <span class="toctext">ves-init-begin, ves-init-end</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#method-compile-begin.2C_method-compile-end"><span class="tocnumber">2.2</span> <span class="toctext">method-compile-begin, method-compile-end</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#gc-begin.2C_gc-end"><span class="tocnumber">2.3</span> <span class="toctext">gc-begin, gc-end</span></a></li>
</ul>
</li>
</ul>
</td></tr></table>
<h2> <span class="mw-headline" id="Using_DTrace_with_Mono">Using DTrace with Mono</span></h2>
<p>Mono 2.0 includes DTrace probes when configured with <code>--enable-dtrace</code>. This currently works on Solaris 10, OpenSolaris and Mac OS X v10.5.
</p><p>The idea behind DTrace is that production copies of software are traceable in case problems arise, without needing to compile a debug version first. Both the kernel and many daemons or applications allow tracing in a scripted, event-oriented way.
</p><p>You can use DTrace from the dtrace command line tool, graphically from OpenSolaris' Chime or Apple's Instruments and from various scripting languages.
</p><p>To check if DTrace is enabled in your copy of Mono, run the following command:
</p>
<pre class="bash" style="font-family:monospace;"> $ dtrace <span style="color: #660033;">-P</span> mono<span style="color: #ff0000;">'$target'</span> <span style="color: #660033;">-l</span> <span style="color: #660033;">-c</span> mono</pre>
<p>This will list all probes of the "mono" provider in the executable "mono" or display an error when no probes were found.
</p><p>Note that using the dtrace command may require additional priviledges.
On Mac OS X use <code>sudo</code>.
On OpenSolaris use <code>pfexec</code> or adjust the user's priviledges (/etc/user_attr)
to include <code>dtrace_user</code> and <code>dtrace_proc</code>, e.g., (as root) <code>usermod -K defaultpriv=basic,dtrace_user,dtrace_proc youruser</code>.
</p>
<h2> <span class="mw-headline" id="The_mono_provider">The mono provider</span></h2>
<h3> <span class="mw-headline" id="ves-init-begin.2C_ves-init-end">ves-init-begin, ves-init-end</span></h3>
<p>Begin and end of runtime initialization.
</p><p>With this pair of probes you can either profile the runtime initialization or use them to constrain your analysis to initialization or post-initialization.
</p><p>This example script outputs the time elapsed during runtime initialization:
</p>
<pre>mono$target:::ves-init-begin
{
    self-&gt;start = timestamp;
}

mono$target:::ves-init-end
{
    printf("%d\n", timestamp - self-&gt;start);
    self-&gt;start = 0;
}
</pre>
<p>Run it as:
</p>
<pre class="bash" style="font-family:monospace;">   <span style="color: #007800;">$dtrace</span> <span style="color: #660033;">-s</span> thescript.d <span style="color: #660033;">-q</span> <span style="color: #660033;">-c</span> <span style="color: #ff0000;">&quot;mono YourApp.exe&quot;</span></pre>
<p>This should print the number of nanoseconds elapsed between the two probes.
</p>
<h3> <span class="mw-headline" id="method-compile-begin.2C_method-compile-end">method-compile-begin, method-compile-end</span></h3>
<p>Begin and end of method compilation.
</p><p>The probe arguments are class name, method name and signature,
and in case of method-compile-end success or failure of compilation.
</p>
<h3> <span class="mw-headline" id="gc-begin.2C_gc-end">gc-begin, gc-end</span></h3>
<p>Begin and end of Garbage Collection.
</p><p>SGen, Mono's <a href="{{site.github.url}}/old_site/Generational_GC" title="Generational GC">Generational GC</a> supports many more probes, described, along with examples, on the <a href="{{site.github.url}}/old_site/SGen_DTrace" title="SGen DTrace">SGen DTrace</a> page.
</p>
