---
layout: obsolete
title: "GitFAQ/fixup-tags.sh"
permalink: /old_site/GitFAQ/fixup-tags.sh/
---

<h1>GitFAQ/fixup-tags.sh</h1>

<p><b>You don't need to run this on the mono/, moon/, and monodevelop/ trees.  It's already been run on those trees.  You'll just need to refresh your tags.</b>
</p><p>The following shell script will generate the list of tags which share the same name as a remote branch, and offer an alternative name.  The output is actually a shell script that you can edit and run to actually perform the changes.
</p>
<pre class="bash" style="font-family:monospace;"><span style="color: #7a0874; font-weight: bold;">cd</span> <span style="color: #000000; font-weight: bold;">/</span>path<span style="color: #000000; font-weight: bold;">/</span>to<span style="color: #000000; font-weight: bold;">/</span>checkout
<span style="color: #c20cb9; font-weight: bold;">bash</span> ~<span style="color: #000000; font-weight: bold;">/</span>bin<span style="color: #000000; font-weight: bold;">/</span>fixup-tags.sh <span style="color: #000000; font-weight: bold;">&gt;</span> fixer-upper
&#160;
<span style="color: #666666; font-style: italic;"># edit the set of tag renames</span>
<span style="color: #c20cb9; font-weight: bold;">vi</span> fixer-upper
&#160;
<span style="color: #666666; font-style: italic;"># dry run that lists the set of git commands executed</span>
<span style="color: #c20cb9; font-weight: bold;">sh</span> fixer-upper
&#160;
<span style="color: #666666; font-style: italic;"># once you're satisfied, you can say</span>
<span style="color: #007800;">RUN_GIT</span>=<span style="color: #c20cb9; font-weight: bold;">git</span> <span style="color: #c20cb9; font-weight: bold;">sh</span> fixer-upper</pre>
<p>And here's the script <code>fixup-tags.sh</code>:
</p>
<pre class="bash" style="font-family:monospace;"><span style="color: #666666; font-style: italic;">#! /bin/bash</span>
&#160;
<span style="color: #c20cb9; font-weight: bold;">cat</span> <span style="color: #000000; font-weight: bold;">&lt;&lt;</span>\EOF
<span style="color: #666666; font-style: italic;">#! /bin/bash</span>
&#160;
<span style="color: #000000; font-weight: bold;">set</span> <span style="color: #660033;">-e</span>
&#160;
: <span style="color: #800000;">${RUN_GIT:=echo git}</span>
&#160;
<span style="color: #007800;">new_tags</span>=
<span style="color: #007800;">old_tags</span>=
rename_tag<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
<span style="color: #7a0874; font-weight: bold;">&#123;</span>
    <span style="color: #007800;">$RUN_GIT</span> tag <span style="color: #007800;">$2</span> refs<span style="color: #000000; font-weight: bold;">/</span>tags<span style="color: #000000; font-weight: bold;">/</span><span style="color: #007800;">$1</span> <span style="color: #000000; font-weight: bold;">&amp;&amp;</span> <span style="color: #7a0874; font-weight: bold;">&#123;</span>
	<span style="color: #007800;">old_tags</span>=<span style="color: #ff0000;">&quot;<span style="color: #007800;">$old_tags</span> refs/tags/$1&quot;</span>
	<span style="color: #007800;">new_tags</span>=<span style="color: #ff0000;">&quot;<span style="color: #007800;">$new_tags</span> refs/tags/$2&quot;</span>
    <span style="color: #7a0874; font-weight: bold;">&#125;</span>
<span style="color: #7a0874; font-weight: bold;">&#125;</span>
EOF
&#160;
<span style="color: #c20cb9; font-weight: bold;">git for-each-ref</span> refs<span style="color: #000000; font-weight: bold;">/</span>remotes<span style="color: #000000; font-weight: bold;">/</span>origin<span style="color: #000000; font-weight: bold;">/</span> <span style="color: #000000; font-weight: bold;">|</span>
<span style="color: #000000; font-weight: bold;">while</span> <span style="color: #c20cb9; font-weight: bold;">read</span> sha <span style="color: #7a0874; font-weight: bold;">type</span> branch; <span style="color: #000000; font-weight: bold;">do</span> 
    <span style="color: #007800;">j</span>=<span style="color: #800000;">${branch##refs/remotes/origin/}</span>
    <span style="color: #c20cb9; font-weight: bold;">git rev-parse</span> <span style="color: #660033;">--verify</span> <span style="color: #ff0000;">&quot;refs/tags/<span style="color: #007800;">$j</span>&quot;</span> <span style="color: #000000; font-weight: bold;">&gt;</span> <span style="color: #000000; font-weight: bold;">/</span>dev<span style="color: #000000; font-weight: bold;">/</span>null <span style="color: #000000;">2</span><span style="color: #000000; font-weight: bold;">&gt;&amp;</span><span style="color: #000000;">1</span> <span style="color: #000000; font-weight: bold;">||</span> <span style="color: #7a0874; font-weight: bold;">continue</span>
&#160;
    <span style="color: #007800;">k</span>=$<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #7a0874; font-weight: bold;">echo</span> <span style="color: #007800;">$j</span> <span style="color: #000000; font-weight: bold;">|</span> <span style="color: #c20cb9; font-weight: bold;">tr</span> <span style="color: #ff0000;">'/'</span> <span style="color: #ff0000;">'-'</span> <span style="color: #000000; font-weight: bold;">|</span> <span style="color: #c20cb9; font-weight: bold;">sed</span> <span style="color: #660033;">-e</span> <span style="color: #ff0000;">'s,\([0-9]\)-,\1.,g'</span><span style="color: #7a0874; font-weight: bold;">&#41;</span>
    <span style="color: #000000; font-weight: bold;">if</span> <span style="color: #7a0874; font-weight: bold;">test</span> <span style="color: #ff0000;">&quot;<span style="color: #007800;">$j</span>&quot;</span> = <span style="color: #ff0000;">&quot;<span style="color: #007800;">$k</span>&quot;</span>; <span style="color: #000000; font-weight: bold;">then</span>
	<span style="color: #7a0874; font-weight: bold;">echo</span> <span style="color: #ff0000;">&quot;rename_tag <span style="color: #007800;">$j</span> tag-<span style="color: #007800;">$j</span>&quot;</span>
    <span style="color: #000000; font-weight: bold;">else</span>
	<span style="color: #7a0874; font-weight: bold;">echo</span> <span style="color: #ff0000;">&quot;rename_tag <span style="color: #007800;">$j</span> <span style="color: #007800;">$k</span>&quot;</span>
    <span style="color: #000000; font-weight: bold;">fi</span>
<span style="color: #000000; font-weight: bold;">done</span>
&#160;
<span style="color: #c20cb9; font-weight: bold;">cat</span> <span style="color: #000000; font-weight: bold;">&lt;&lt;</span>\EOF
<span style="color: #7a0874; font-weight: bold;">test</span> <span style="color: #660033;">-z</span> <span style="color: #ff0000;">&quot;<span style="color: #007800;">$new_tags</span>&quot;</span> <span style="color: #000000; font-weight: bold;">||</span> <span style="color: #007800;">$RUN_GIT</span> push origin <span style="color: #007800;">$new_tags</span>
<span style="color: #7a0874; font-weight: bold;">test</span> <span style="color: #660033;">-z</span> <span style="color: #ff0000;">&quot;<span style="color: #007800;">$old_tags</span>&quot;</span> <span style="color: #000000; font-weight: bold;">||</span> <span style="color: #007800;">$RUN_GIT</span> push origin <span style="color: #660033;">--delete</span> <span style="color: #007800;">$old_tags</span>
&#160;
<span style="color: #000000; font-weight: bold;">for</span> i <span style="color: #000000; font-weight: bold;">in</span> <span style="color: #007800;">$old_tags</span>; <span style="color: #000000; font-weight: bold;">do</span>
  <span style="color: #007800;">$RUN_GIT</span> tag <span style="color: #660033;">-d</span> <span style="color: #800000;">${i##refs/tags/}</span>
<span style="color: #000000; font-weight: bold;">done</span>
EOF</pre>

