---
layout: obsolete
title: "CreatingCustomThemedGtkSharpWidgets"
permalink: /old_site/CreatingCustomThemedGtkSharpWidgets/
---

<h1>CreatingCustomThemedGtkSharpWidgets</h1>

<p>This document will try to highlight was is required to implement a custom Gtk# widget that integrates properly with a Theme Engine.
</p><p>Gtk# based applications can be themed based on the user preferences.   The themes control how applications look on the screen.   Although the core widgets in Gtk# already follow the guidelines developers that are implementing their own custom widgets need to pay special attention to make sure that their custom widgets render properly across different engines and looks.
</p><p>For example, something that works like a button, should look like a button.
</p>
<h2> <span class="mw-headline" id="Writing_the_Widget"> Writing the Widget </span></h2>
<p>Here are some steps:
</p>
<ol><li> Create one single instance of the widget you want to emulate
</li><li> Always load style on Expose
</li><li> Always resolve respective colors from that style
</li></ol>
<p><a href="/index.php?title=Step_1)&amp;action=edit&amp;redlink=1" class="new" title="Step 1) (page does not exist)">Step 1)</a>
</p><p>As simple as this...
</p>
<pre class="csharp" style="font-family:monospace;"><span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #0600FF; font-weight: bold;">static</span> <span style="color: #6666cc; font-weight: bold;">class</span> Fakes
<span style="color: #008000;">&#123;</span>
	<span style="color: #0600FF; font-weight: bold;">private</span> <span style="color: #0600FF; font-weight: bold;">static</span> Button button <span style="color: #008000;">=</span> <span style="color: #0600FF; font-weight: bold;">null</span><span style="color: #008000;">;</span>
	<span style="color: #008080; font-style: italic;">/// &lt;value&gt;</span>
	<span style="color: #008080; font-style: italic;">/// Provides button template</span>
	<span style="color: #008080; font-style: italic;">/// &lt;/value&gt;</span>
	<span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #0600FF; font-weight: bold;">static</span> Button Button <span style="color: #008000;">&#123;</span>
		<span style="color: #0600FF; font-weight: bold;">get</span> <span style="color: #008000;">&#123;</span>
			<span style="color: #0600FF; font-weight: bold;">if</span> <span style="color: #008000;">&#40;</span>button <span style="color: #008000;">==</span> <span style="color: #0600FF; font-weight: bold;">null</span><span style="color: #008000;">&#41;</span>
				button <span style="color: #008000;">=</span> <a href="http://www.google.com/search?q=new+msdn.microsoft.com"><span style="color: #008000;">new</span></a> Button<span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
			<span style="color: #0600FF; font-weight: bold;">return</span> <span style="color: #008000;">&#40;</span>button<span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
		<span style="color: #008000;">&#125;</span>
	<span style="color: #008000;">&#125;</span>
&#160;
	<span style="color: #0600FF; font-weight: bold;">private</span> <span style="color: #0600FF; font-weight: bold;">static</span> Entry entry <span style="color: #008000;">=</span> <span style="color: #0600FF; font-weight: bold;">null</span><span style="color: #008000;">;</span>
	<span style="color: #008080; font-style: italic;">/// &lt;value&gt;</span>
	<span style="color: #008080; font-style: italic;">/// Provides entry template</span>
	<span style="color: #008080; font-style: italic;">/// &lt;/value&gt;</span>
	<span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #0600FF; font-weight: bold;">static</span> Entry Entry <span style="color: #008000;">&#123;</span>
		<span style="color: #0600FF; font-weight: bold;">get</span> <span style="color: #008000;">&#123;</span>
			<span style="color: #0600FF; font-weight: bold;">if</span> <span style="color: #008000;">&#40;</span>entry <span style="color: #008000;">==</span> <span style="color: #0600FF; font-weight: bold;">null</span><span style="color: #008000;">&#41;</span>
				entry <span style="color: #008000;">=</span> <a href="http://www.google.com/search?q=new+msdn.microsoft.com"><span style="color: #008000;">new</span></a> Entry<span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
			<span style="color: #0600FF; font-weight: bold;">return</span> <span style="color: #008000;">&#40;</span>entry<span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
		<span style="color: #008000;">&#125;</span>
	<span style="color: #008000;">&#125;</span>
<span style="color: #008000;">&#125;</span></pre>
<p>With this you get two fake widgets. One for button and one for entry. Initialization should not be done in private part so you delay its initialization to as late as possible. First reason are resources used by application, but second is more important. You need to make sure to delay any widget initialization until Gtk.Application.Init() has been called. And since the only time these will be touched are during expose event of another widget, initialization already happened.
</p><p><a href="/index.php?title=Step_2_and_3)&amp;action=edit&amp;redlink=1" class="new" title="Step 2 and 3) (page does not exist)">Step 2 and 3)</a>
</p><p>Faking widget to look like normal Gtk+ entry widget. Using expose like that will survive any on the fly theme change and so on.
</p><p>Example: Faking entry widget
</p>
<pre class="csharp" style="font-family:monospace;"><span style="color: #0600FF; font-weight: bold;">protected</span> <span style="color: #0600FF; font-weight: bold;">override</span> <span style="color: #6666cc; font-weight: bold;">bool</span> OnExposeEvent <span style="color: #008000;">&#40;</span>Gdk<span style="color: #008000;">.</span><span style="color: #0000FF;">EventExpose</span> evnt<span style="color: #008000;">&#41;</span>
<span style="color: #008000;">&#123;</span>
	<span style="color: #008080; font-style: italic;">// Take into consideration that expose event doesn't redraw whole widget</span>
	<span style="color: #008080; font-style: italic;">// it just redraws region exposed to redraw</span>
	<span style="color: #008080; font-style: italic;">// Whole area can be resolved by using widgets Allocation property</span>
	rect <span style="color: #008000;">=</span> CALCULATE_MY_RECTANGLE<span style="color: #008000;">;</span>
	<span style="color: #008080; font-style: italic;">// Resolve widget you want to use, it can also be null</span>
	Gtk<span style="color: #008000;">.</span><span style="color: #0000FF;">Widget</span> wgd <span style="color: #008000;">=</span> <span style="color: #0600FF; font-weight: bold;">this</span><span style="color: #008000;">;</span>
&#160;
	<span style="color: #008080; font-style: italic;">// Load style based on fake				</span>
	Style myStyle <span style="color: #008000;">=</span> Rc<span style="color: #008000;">.</span><span style="color: #0000FF;">GetStyle</span> <span style="color: #008000;">&#40;</span>Fakes<span style="color: #008000;">.</span><span style="color: #0000FF;">Entry</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
	<span style="color: #0600FF; font-weight: bold;">base</span><span style="color: #008000;">.</span><span style="color: #0000FF;">OnExposeEvent</span> <span style="color: #008000;">&#40;</span>evnt<span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
&#160;
	<span style="color: #0600FF; font-weight: bold;">if</span> <span style="color: #008000;">&#40;</span>CONDITION_WIDGET_IS_SENSITIVE <span style="color: #008000;">==</span> <span style="color: #0600FF; font-weight: bold;">false</span><span style="color: #008000;">&#41;</span> <span style="color: #008000;">&#123;</span>
		Gtk<span style="color: #008000;">.</span><span style="color: #0000FF;">Style</span><span style="color: #008000;">.</span><span style="color: #0000FF;">PaintFlatBox</span> <span style="color: #008000;">&#40;</span>myStyle, aArgs<span style="color: #008000;">.</span><span style="color: #0000FF;">Drawable</span>, StateType<span style="color: #008000;">.</span><span style="color: #0000FF;">Insensitive</span>, 
		                       ShadowType<span style="color: #008000;">.</span><span style="color: #0600FF; font-weight: bold;">In</span>, rect, wdg, <span style="color: #666666;">&quot;entry_bg&quot;</span>, 
		                       rect<span style="color: #008000;">.</span><span style="color: #0000FF;">X</span>, rect<span style="color: #008000;">.</span><span style="color: #0000FF;">Y</span>, rect<span style="color: #008000;">.</span><span style="color: #0000FF;">Width</span>, rect<span style="color: #008000;">.</span><span style="color: #0000FF;">Height</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
		Gtk<span style="color: #008000;">.</span><span style="color: #0000FF;">Style</span><span style="color: #008000;">.</span><span style="color: #0000FF;">PaintShadow</span><span style="color: #008000;">&#40;</span>myStyle, aArgs<span style="color: #008000;">.</span><span style="color: #0000FF;">Drawable</span>, StateType<span style="color: #008000;">.</span><span style="color: #0000FF;">Insensitive</span>, 
		                      ShadowType<span style="color: #008000;">.</span><span style="color: #0600FF; font-weight: bold;">In</span>, rect, wdg, <span style="color: #666666;">&quot;entry&quot;</span>, 
	    	                  rect<span style="color: #008000;">.</span><span style="color: #0000FF;">X</span>, rect<span style="color: #008000;">.</span><span style="color: #0000FF;">Y</span>, rect<span style="color: #008000;">.</span><span style="color: #0000FF;">Width</span>, rect<span style="color: #008000;">.</span><span style="color: #0000FF;">Height</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
	<span style="color: #008000;">&#125;</span>
	<span style="color: #0600FF; font-weight: bold;">else</span> <span style="color: #0600FF; font-weight: bold;">if</span> <span style="color: #008000;">&#40;</span>CONDITION_WIDGET_IS_FOCUSED <span style="color: #008000;">==</span> <span style="color: #0600FF; font-weight: bold;">true</span><span style="color: #008000;">&#41;</span> <span style="color: #008000;">&#123;</span>				
		Gtk<span style="color: #008000;">.</span><span style="color: #0000FF;">Style</span><span style="color: #008000;">.</span><span style="color: #0000FF;">PaintFlatBox</span> <span style="color: #008000;">&#40;</span>myStyle, aArgs<span style="color: #008000;">.</span><span style="color: #0000FF;">Drawable</span>, State, 
		                       ShadowType<span style="color: #008000;">.</span><span style="color: #0600FF; font-weight: bold;">In</span>, rect, wdg, <span style="color: #666666;">&quot;entry_bg&quot;</span>, 
		                       rect<span style="color: #008000;">.</span><span style="color: #0000FF;">X</span>, rect<span style="color: #008000;">.</span><span style="color: #0000FF;">Y</span>, rect<span style="color: #008000;">.</span><span style="color: #0000FF;">Width</span>, rect<span style="color: #008000;">.</span><span style="color: #0000FF;">Height</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
		Gtk<span style="color: #008000;">.</span><span style="color: #0000FF;">Style</span><span style="color: #008000;">.</span><span style="color: #0000FF;">PaintFocus</span> <span style="color: #008000;">&#40;</span>myStyle, aArgs<span style="color: #008000;">.</span><span style="color: #0000FF;">Drawable</span>, State, clip, wdg, <span style="color: #666666;">&quot;entry&quot;</span>, 
		                      rect<span style="color: #008000;">.</span><span style="color: #0000FF;">X</span>, rect<span style="color: #008000;">.</span><span style="color: #0000FF;">Y</span>, rect<span style="color: #008000;">.</span><span style="color: #0000FF;">Width</span>, rect<span style="color: #008000;">.</span><span style="color: #0000FF;">Height</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
		Gtk<span style="color: #008000;">.</span><span style="color: #0000FF;">Style</span><span style="color: #008000;">.</span><span style="color: #0000FF;">PaintShadow</span> <span style="color: #008000;">&#40;</span>myStyle, aArgs<span style="color: #008000;">.</span><span style="color: #0000FF;">Drawable</span>, State, 
		                       ShadowType<span style="color: #008000;">.</span><span style="color: #0600FF; font-weight: bold;">In</span>, rect, wdg, <span style="color: #666666;">&quot;entry&quot;</span>, 
		                       rect<span style="color: #008000;">.</span><span style="color: #0000FF;">X</span>, rect<span style="color: #008000;">.</span><span style="color: #0000FF;">Y</span>, rect<span style="color: #008000;">.</span><span style="color: #0000FF;">Width</span>, rect<span style="color: #008000;">.</span><span style="color: #0000FF;">Height</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
	<span style="color: #008000;">&#125;</span>
	<span style="color: #0600FF; font-weight: bold;">else</span> <span style="color: #008000;">&#123;</span>
		Gtk<span style="color: #008000;">.</span><span style="color: #0000FF;">Style</span><span style="color: #008000;">.</span><span style="color: #0000FF;">PaintFlatBox</span> <span style="color: #008000;">&#40;</span>myStyle, aArgs<span style="color: #008000;">.</span><span style="color: #0000FF;">Drawable</span>, State, 
		                       ShadowType<span style="color: #008000;">.</span><span style="color: #0600FF; font-weight: bold;">In</span>, rect, wdg, <span style="color: #666666;">&quot;entry_bg&quot;</span>, 
		                       rect<span style="color: #008000;">.</span><span style="color: #0000FF;">X</span>, rect<span style="color: #008000;">.</span><span style="color: #0000FF;">Y</span>, rect<span style="color: #008000;">.</span><span style="color: #0000FF;">Width</span>, rect<span style="color: #008000;">.</span><span style="color: #0000FF;">Height</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
		Gtk<span style="color: #008000;">.</span><span style="color: #0000FF;">Style</span><span style="color: #008000;">.</span><span style="color: #0000FF;">PaintShadow</span><span style="color: #008000;">&#40;</span>myStyle, aArgs<span style="color: #008000;">.</span><span style="color: #0000FF;">Drawable</span>, State, 
		                      ShadowType<span style="color: #008000;">.</span><span style="color: #0600FF; font-weight: bold;">In</span>, rect, wdg, <span style="color: #666666;">&quot;entry&quot;</span>, 
	    	                  rect<span style="color: #008000;">.</span><span style="color: #0000FF;">X</span>, rect<span style="color: #008000;">.</span><span style="color: #0000FF;">Y</span>, rect<span style="color: #008000;">.</span><span style="color: #0000FF;">Width</span>, rect<span style="color: #008000;">.</span><span style="color: #0000FF;">Height</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
	<span style="color: #008000;">&#125;</span>
&#160;
	<span style="color: #008080; font-style: italic;">// Dispose fake style		</span>
	myStyle<span style="color: #008000;">.</span><span style="color: #0000FF;">Dispose</span><span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
	myStyle <span style="color: #008000;">=</span> <span style="color: #0600FF; font-weight: bold;">null</span><span style="color: #008000;">;</span>
<span style="color: #008000;">&#125;</span></pre>
<p><b>Warning:</b> It is very important to always resolve colors based on the style you copied (or any other for that matter).
</p><p>Resolving colors goes like this:
</p>
<pre class="csharp" style="font-family:monospace;">&#160;
Gdk<span style="color: #008000;">.</span><span style="color: #0000FF;">Color</span> clr <span style="color: #008000;">=</span> myStyle<span style="color: #008000;">.</span><span style="color: #0000FF;">Backgrounds</span><span style="color: #008000;">&#91;</span><span style="color: #008000;">&#40;</span><span style="color: #6666cc; font-weight: bold;">int</span><span style="color: #008000;">&#41;</span> StateType<span style="color: #008000;">.</span><span style="color: #0000FF;">Normal</span><span style="color: #008000;">&#93;</span><span style="color: #008000;">;</span></pre>

