---
layout: obsolete
title: "BuildSystem/MonoBuildPlanning"
permalink: /old_site/BuildSystem/MonoBuildPlanning/
redirect_from:
  - /BuildSystem/MonoBuildPlanning/
---

<h1>BuildSystem/MonoBuildPlanning</h1>

<p><br />
Note: this is an obsolete old copy of:
</p><p><a href="{{site.baseurl}}/BuildSystem/MonoBuild" title="BuildSystem/MonoBuild">BuildSystem/MonoBuild</a>
</p>
<table id="toc" class="toc"><tr><td><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Design"><span class="tocnumber">1</span> <span class="toctext">Design</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#Phase_2"><span class="tocnumber">1.1</span> <span class="toctext">Phase 2</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="#Phase_3"><span class="tocnumber">1.2</span> <span class="toctext">Phase 3</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-4"><a href="#HOWTO"><span class="tocnumber">2</span> <span class="toctext">HOWTO</span></a>
<ul>
<li class="toclevel-2 tocsection-5"><a href="#Configuration:_Path_to_release_Work_Area"><span class="tocnumber">2.1</span> <span class="toctext">Configuration: Path to release Work Area</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#Configuring_Apache_for_MonoBuild"><span class="tocnumber">2.2</span> <span class="toctext">Configuring Apache for MonoBuild</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="#Working_example_of_.2Fetc.2Fapache2.2Fconf.d.2Fmod_perl.conf"><span class="tocnumber">2.3</span> <span class="toctext">Working example of /etc/apache2/conf.d/mod_perl.conf</span></a></li>
</ul>
</li>
</ul>
</td></tr></table>
<h1> <span class="mw-headline" id="Design"> Design </span></h1>
<ul><li> Each of the build hosts contact the web server for specific jobs
</li><li> The web server is responsible for assigning jobs to each client
</li><li> the build client will pop the job (text file) out of it's directory (hostname) 
</li><li> When the build client is done, it sends the success/fail message back to the web server (puts it in a directory), and also puts the log file in a directory
</li><li> Need to automatically generate some pages (or combine the following information into a page):
</li></ul>
<ul><li> Status page: Shows success/fail and links to log files (which get posted after the build)
</li><li> Control Center Page: build components on specific platforms
</li></ul>
<ul><li> Need to have archives of the builds (rpms) as well as the logs... very important
</li></ul>
<ul><li> How to know that the builds are in progress? (Without using a database... flat state file I guess)
</li></ul>
<p>Open questions:
</p>
<ul><li> Will we only want to be able to build HEAD from the webpage, or be able to pick a revision?
</li><li> Do we need web accessible archives (builds and logs)...? How will these archives get cleaned up?
</li></ul>
<p>On the log and download page that Ben sent me, we can have all the logs and builds available from there
</p><p>The xml format: 
</p>
<ul><li>I don't want to have to parse tons of xml files for every hit to the main status page... 
<ul><li>I don't, because you can get the revisions from the directory listing, you'll only need to parse the xml once you go to the downloads page, but you still need to get the status... have an index xml file? That means status updates will also need to go there...
</li></ul>
</li><li>One of the main issues is whether to have the xml contain multiple builds, or have an xml document for each build.
</li><li>It would probably be easier to remove a build if you could just delete the directory... I think I'll do that
</li></ul>
<p><br />
</p>
<h2> <span class="mw-headline" id="Phase_2"> Phase 2 </span></h2>
<ul><li> Later...  a cron job will set up mandatory job requests, so that the builds get run every night
</li><li> to utilize the hardware better, we need to find the best build box to assign the job to
</li><li> We need to track and calculate dependencies so we know which components to build when we need a new build (this gets somewhat complicated... always rebuild dep, what if parent project doesn't change??, etc...)
</li></ul>
<h2> <span class="mw-headline" id="Phase_3"> Phase 3 </span></h2>
<ul><li> Test suites, not only build, but do unit tests on the builds
</li><li> Ben mentioned something that we need to get our test cases running against an installed Mono instead of a compiled source tree
</li></ul>
<h1> <span class="mw-headline" id="HOWTO"> HOWTO </span></h1>
<h2> <span class="mw-headline" id="Configuration:_Path_to_release_Work_Area"> Configuration: Path to release Work Area </span></h2>
<p>Modify the Build/Config.pm and point $releaseRepo to the working copy of the following Subversion repository: mono-cvs.ximian.com/source/trunk/release
</p><p><br />
</p>
<h2> <span class="mw-headline" id="Configuring_Apache_for_MonoBuild"> Configuring Apache for MonoBuild </span></h2>
<p>Make sure you have mod_perl installed and working 
</p>
<ul><li>On SUSE type systems, make sure perl is included as part of the APACHE_MODULES list in /etc/sysconfig/apache2
</li></ul>
<p><br />
</p><p>Add the following to /etc/apache2/mod_perl-startup.pl:
</p>
<pre class="perl" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">use</span> lib <a href="http://perldoc.perl.org/functions/qw.html"><span style="color: #000066;">qw</span></a><span style="color: #009900;">&#40;</span><span style="color: #339933;">/</span>home<span style="color: #339933;">/</span>wberrier<span style="color: #339933;">/</span>wa<span style="color: #339933;">/</span>mono<span style="color: #339933;">/</span>msvn<span style="color: #339933;">/</span>release<span style="color: #339933;">/</span>monobuild<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre>
<p>The above will point to your working copy.
</p><p>Make sure that your mod_perl configuration includes the startup file.
</p><p>Also, include the following Perl Directives:
PerlInitHandler Apache::Reload
</p>
<h2> <span class="mw-headline" id="Working_example_of_.2Fetc.2Fapache2.2Fconf.d.2Fmod_perl.conf"> Working example of /etc/apache2/conf.d/mod_perl.conf </span></h2>
<pre>
&lt;Directory &quot;/srv/www/perl-lib&quot;&gt;
    AllowOverride None
    Options None
    Order allow,deny
    Deny from all
&lt;/Directory&gt;

&lt;IfModule mod_perl.c&gt;
    PerlRequire &quot;/etc/apache2/mod_perl-startup.pl&quot;

    ScriptAlias /perl/ &quot;/srv/www/cgi-bin/&quot;
    &lt;Location /perl/&gt;
        # mod_perl mode
        SetHandler perl-script
        PerlResponseHandler ModPerl::Registry
        PerlOptions +ParseHeaders
        Options +ExecCGI
    &lt;/Location&gt;

    # Important stuff
    ##############################################################
    PerlInitHandler Apache::Reload
    #ScriptAlias /cgi-perl/ &quot;/srv/www/cgi-bin/&quot;
    ScriptAlias /cgi-perl/ &quot;/home/wberrier/wa/mono/msvn/release/monobuild/www/cgi-perl/&quot;
    &lt;Location /cgi-perl&gt;
        # perl cgi mode
        SetHandler  perl-script
        PerlResponseHandler ModPerl::PerlRun
        PerlOptions +ParseHeaders
        Options +ExecCGI
    &lt;/Location&gt;
    ##############################################################

    # The /cgi-bin/ ScriptAlias is already set up in httpd.conf

&lt;/IfModule&gt;
</pre>

