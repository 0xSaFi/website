---
layout: obsolete
title: "UsingTrustedRootsRespectfully"
permalink: /old_site/UsingTrustedRootsRespectfully/
redirect_from:
  - /UsingTrustedRootsRespectfully/
  - /UsingTrustedRootsRespectfully_trust/
---

<h1>UsingTrustedRootsRespectfully</h1>

<table id="toc" class="toc"><tr><td><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Introduction"><span class="tocnumber">1</span> <span class="toctext">Introduction</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Approaches"><span class="tocnumber">2</span> <span class="toctext">Approaches</span></a>
<ul>
<li class="toclevel-2 tocsection-3"><a href="#Approach_.23-1:_Actively_ignore_security_concerns"><span class="tocnumber">2.1</span> <span class="toctext">Approach #-1: Actively ignore security concerns</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#Approach_.230:_Ignore_the_problem"><span class="tocnumber">2.2</span> <span class="toctext">Approach #0: Ignore the problem</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#Approach_.231:_Minimalist"><span class="tocnumber">2.3</span> <span class="toctext">Approach #1: Minimalist</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#Approach_.232:_Warn_and_offer_the_possibility_to_continue"><span class="tocnumber">2.4</span> <span class="toctext">Approach #2: Warn and offer the possibility to continue</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="#Approach_.233:_Application_centric_trust"><span class="tocnumber">2.5</span> <span class="toctext">Approach #3: Application centric trust</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="#Approach_.234:_Offer_to_trust_the_new_root_certificate"><span class="tocnumber">2.6</span> <span class="toctext">Approach #4: Offer to trust the new root certificate</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="#Approach_.235:_Application_or_global_trust"><span class="tocnumber">2.7</span> <span class="toctext">Approach #5: Application or global trust</span></a></li>
<li class="toclevel-2 tocsection-10"><a href="#Random_Notes"><span class="tocnumber">2.8</span> <span class="toctext">Random Notes</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-11"><a href="#Conclusion"><span class="tocnumber">3</span> <span class="toctext">Conclusion</span></a></li>
<li class="toclevel-1 tocsection-12"><a href="#Appendix_-_Source_code"><span class="tocnumber">4</span> <span class="toctext">Appendix - Source code</span></a></li>
<li class="toclevel-1 tocsection-13"><a href="#Approach_.23-1:_Actively_ignore_security_concerns_.3D"><span class="tocnumber">5</span> <span class="toctext">Approach #-1: Actively ignore security concerns =</span></a>
<ul>
<li class="toclevel-2 tocsection-14"><a href="#Approach_.230:_Ignore_the_problem_2"><span class="tocnumber">5.1</span> <span class="toctext">Approach #0: Ignore the problem</span></a></li>
<li class="toclevel-2 tocsection-15"><a href="#Approach_.231:_Minimalist_2"><span class="tocnumber">5.2</span> <span class="toctext">Approach #1: Minimalist</span></a></li>
<li class="toclevel-2 tocsection-16"><a href="#Approach_.232:_Warn_and_offer_the_possibility_to_continue_2"><span class="tocnumber">5.3</span> <span class="toctext">Approach #2: Warn and offer the possibility to continue</span></a></li>
<li class="toclevel-2 tocsection-17"><a href="#Approach_.233:_Application_centric_trust_2"><span class="tocnumber">5.4</span> <span class="toctext">Approach #3: Application centric trust</span></a></li>
<li class="toclevel-2 tocsection-18"><a href="#Approach_.234:_Offer_to_trust_the_new_root_certificate_2"><span class="tocnumber">5.5</span> <span class="toctext">Approach #4: Offer to trust the new root certificate</span></a></li>
<li class="toclevel-2 tocsection-19"><a href="#Approach_.235:_Application_or_global_trust_2"><span class="tocnumber">5.6</span> <span class="toctext">Approach #5: Application or global trust</span></a></li>
</ul>
</li>
</ul>
</td></tr></table>
<h1> <span class="mw-headline" id="Introduction"> Introduction </span></h1>
<p>You may have never heard of public-key infrastructures (PKI) and X.509
but you probably used them, most likely today. This is part of how
(most) SSL/TLS secure sessions are established over HTTP (i.e. HTTPS) using HttpWebRequest.
</p><p>In order to use X.509 certificates you must be able to link it back to a
trusted source. This is process is generally known as chaining and the
trusted source is often a self-signed certificate which is specially
identified (e.g. by being stored in a specific location).
</p><p>From a application developer point of view you should never assume that
a particular trusted root certificate is present on the user's computer.
Why? Simply because they changes. The most common changes are:
</p>
<ol><li> new roots certificates are added (i.e. you are trusting new sources);
</li><li> new certificates are used to replace older ones (like extending the validity period of the certificate authority).
</li><li> existing roots certificates are removed (i.e. you stop trusting them);
</li></ol>
<p>So it's important for applications to check for any trust problem, on any
platform, but it's even more important on Mono because it doesn't ship
with any trusted root by default (see the <a href="{{site.baseurl}}/old_site/FAQ:_Security" title="FAQ: Security">FAQ:_Security</a> for more details).
</p>
<h1> <span class="mw-headline" id="Approaches"> Approaches </span></h1>
<p>This articles goes over several approaches an application may take to
solve, or even ignore, this situation. Source code for each case can be
found at the end of the article.
</p><p><br />
</p>
<h2> <span class="mw-headline" id="Approach_.23-1:_Actively_ignore_security_concerns"> Approach #-1: Actively ignore security concerns </span></h2>
<p>You believe that security is for the weak and/or that SSL is encrypting
anyway (so why should you have to trust the other end?) and that your
application has the divine right to choose what's secure, or not, for
its end users.
</p><p>End User Choices
</p>
<ul><li> N/A (nothing to see, move along)
</li></ul>
<p>Pros
</p>
<ul><li> Users won't ever see a trust error from your application.
</li></ul>
<p>Cons
</p>
<ul><li> Users are much likely to see and/or suffer from your application (anyway).
</li></ul>
<p>Note: This approach is different than using custom, i.e. application specific, rules to determine if the trust error should be ignored. E.g. the <code>tlstest</code> application in Mono's SVN is a test tool that reports (prints) errors but will continue downloading a web page no matter what
error occurs.
</p><p><br />
</p>
<h2> <span class="mw-headline" id="Approach_.230:_Ignore_the_problem"> Approach #0: Ignore the problem </span></h2>
<p>Many existing application totally ignore the trust problem. This is a
sad situation because they are simply dumping the problem on end-users -
which probably have even less information and knowledge about the
problem and how it can be solved.
</p><p>End User Choices
</p>
<ul><li> N/A (unformatted information only)
</li></ul>
<p>Pros
</p>
<ul><li> Works on both Mono and MS runtimes;
</li><li> Easy (nothing to do) and (sadly) popular;
</li></ul>
<p>Cons
</p>
<ul><li> Application is unusable until the end-user figures out how to add the required certificate to its trusted list. Depending on the hints available (e.g. stacktrace) it may be impossible for the user to reach that conclusion. It's a good way to royally piss off a potential user about your application.
</li></ul>
<p><br />
</p>
<pre>Unhandled Exception: System.Net.WebException: Error getting response stream (Trust failure): TrustFailure
---&gt; System.IO.IOException: The authentication or decryption has failed.
---&gt; Mono.Security.Protocol.Tls.TlsException: Invalid certificate received form server.
</pre>
<p><br />
</p>
<h2> <span class="mw-headline" id="Approach_.231:_Minimalist"> Approach #1: Minimalist </span></h2>
<p>Such an error is easy to trap and report to end-user. You only must
catch the <code>WebException</code> exception thrown by
<code>HttpWebRequest.GetResponse</code> and report an informative error
and instructions to the end-user. E.g. Why the operation can't work and
how this affects the current application.
</p><p>End User Choices
</p>
<ul><li> N/A (formatted information only)
</li></ul>
<p>Pros
</p>
<ul><li> Works on both Mono and MS runtimes;
</li></ul>
<p>Cons
</p>
<ul><li> Applications are unusable until the end-user complete the instructions. Bad if/when the user is only testing/reviewing a new application. It's a good way to make a very bad impression the first time a user tries your application.
</li></ul>
<p><br />
</p>
<h2> <span class="mw-headline" id="Approach_.232:_Warn_and_offer_the_possibility_to_continue"> Approach #2: Warn and offer the possibility to continue </span></h2>
<p>Inform the user about the trust issue and let them continue at their own risk.
</p><p>End User Choices
</p>
<ul><li> Don't connect to the untrusted site. This should be the default action.
</li><li> Accept the connection, but only for this session;
</li></ul>
<p>Pros
</p>
<ul><li> Works on both Mono and MS runtimes;
</li><li> Application is usable right-away, without even restarting it, to the end-user. You get to keep the nice first impression;
</li><li> It doesn't requires any changes outside the application unless the user wants to make the trust permanent;
</li></ul>
<p>Cons
</p>
<ul><li> The same choice will be asked, over and over again, each time the application use this feature or, at least, each time the application is restarted and use the feature. You had the first impression right but your users may eventually loose patience over your application.
</li></ul>
<p><br />
</p>
<h2> <span class="mw-headline" id="Approach_.233:_Application_centric_trust"> Approach #3: Application centric trust </span></h2>
<p>This isn't a very common approach but it can be a very good one for most applications. Trust decisions don't have to be global (i.e. for all managed applications) and may make sense only to your application (or to an application group). So keeping an history of the users past decisions is both more secure and more user friendly than the previous approach.
</p><p>End User Choices
</p>
<ul><li> Don't connect to the untrusted site. This should be the default action.
</li><li> Accept the connection, only for this session;
</li><li> Always trust the certificate when used in this application;
</li></ul>
<p>Pros
</p>
<ul><li> Works on both Mono and MS runtimes;
</li><li> Application is usable right-away, without even restarting it, to the end-user;
</li><li> It doesn't require any changes outside the application;
</li></ul>
<p>Cons
</p>
<ul><li> The trust is limited to this application (or to an application group). Note that, depending on the application, this can be seen as an advantage;
</li></ul>
<p><br />
</p>
<h2> <span class="mw-headline" id="Approach_.234:_Offer_to_trust_the_new_root_certificate"> Approach #4: Offer to trust the new root certificate </span></h2>
<p>This is similar to approach #3 but it offers to make the trust relationship permanent. This may seem to makes a lot of sense for some applications but it's often hard to predict what other application will "inherit" this new trust.
</p><p>End User Choices
</p>
<ul><li> Don't connect to the untrusted site. This should be the default.
</li><li> Accept the connection, only for this session;
</li><li> Trust the new root certificate.
</li></ul>
<p>Pros
</p>
<ul><li> Works only on Mono or only on MS Fx 2.0 (see notes).
</li></ul>
<p>Cons
</p>
<ul><li> Requires different code to work on Mono and MS Fx 2.0.
</li><li> The trust on the new root is "global", i.e. all Mono applications or all MS applications (including non-managed applications).
</li></ul>
<p><br />
</p>
<h2> <span class="mw-headline" id="Approach_.235:_Application_or_global_trust"> Approach #5: Application or global trust </span></h2>
<p>The last approach is to merge #3 and #4 to give all possible choice to the end user.
</p><p>End User Choices
</p>
<ul><li> Don't connect to the untrusted site. This should be the default.
</li><li> Accept the connection, only for this session;
</li><li> Accept the connection, but only for this application.
</li><li> Trust the new root certificate.
</li></ul>
<p>Pros
</p>
<ul><li> Users gets all the choices (but are they ready for that? or are you just dumping all this on them?)
</li></ul>
<p>Cons
</p>
<ul><li> Complexify the UI. The decision between an application or global trust for a certificate can, in most cases, be an application (i.e. not an end-user) decision.
</li></ul>
<p><br />
</p>
<h2> <span class="mw-headline" id="Random_Notes"> Random Notes </span></h2>
<ul><li> Framework v2.0 introduce some classes to manipulate certificate stores. Before that you'll need to p/invoke into CryptoAPI to get the same results.
</li></ul>
<p><br />
</p>
<h1> <span class="mw-headline" id="Conclusion"> Conclusion </span></h1>
<p>Sadly trusting user input for security related question is, at best, a
"risky business".
</p><p>There's no good reason to use approaches like #-1 (adding code to be
less secure), #0 (doing nothing) and #1 (only warn). An application
should at least propose the user to continue (approach #2).
</p><p>Approach #5 (too many choice) is the most complete. In fact it may be
too complete for most (99%) of applications as it will likely confuse
the end users more than help them. Also, and like #4 (global trust),
it's more difficult to make it work on all runtimes.
</p><p>Choosing between #3 and #4 is harder as it greatly depends on the type
of application you're writing (e.g. a configuration tool doesn't want to
have its own trust list) but if interoperability between Mono and MS
runtime is a concern then you should consider using #3.
</p><p><br />
</p>
<h1> <span class="mw-headline" id="Appendix_-_Source_code"> Appendix - Source code </span></h1>
<p>Here's included some <b>sample</b> code for each approach. The code is
provided only to show how this could be done (i.e. what's the
<b>minimum</b> involved). Also don't use my bad English skills as an excuse for your bad UI&#160;;-).
</p><p>The code is made to work, as much as possible, on every runtime. When
this isn't possible (#4/#5) then the source code will only works on
Mono. All samples use the <code>ICertificatePolicy</code>, deprecated in
Fx 2.0, to provide users with a choice of options. The same technique
can be used with Mono.Security.dll
<code>SslClientStream.ServerCertValidationDelegate</code>
(see tlstest.cs for an example)
and Fx 2.0's
<code>ServicePointManager.ServerCertificateValidationCallback</code>.
</p><p><br />
</p>
<h1> <span class="mw-headline" id="Approach_.23-1:_Actively_ignore_security_concerns_.3D"> Approach #-1: Actively ignore security concerns =</span></h1>
<p>Source code using the .NET 2.0 profile, which gives you better control over the certificates being examined:
</p>
<pre class="csharp" style="font-family:monospace;"><span style="color: #0600FF; font-weight: bold;">using</span> <span style="color: #008080;">System</span><span style="color: #008000;">;</span>
<span style="color: #0600FF; font-weight: bold;">using</span> <span style="color: #008080;">System.Net</span><span style="color: #008000;">;</span>
&#160;
<span style="color: #6666cc; font-weight: bold;">class</span> MainClass
<span style="color: #008000;">&#123;</span>
	<span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #0600FF; font-weight: bold;">static</span> <span style="color: #6666cc; font-weight: bold;">bool</span> Validator <span style="color: #008000;">&#40;</span><span style="color: #6666cc; font-weight: bold;">object</span> sender, X509Certificate certificate, X509Chain chain, 
                                      SslPolicyErrors sslPolicyErrors<span style="color: #008000;">&#41;</span>
	<span style="color: #008000;">&#123;</span>
		<span style="color: #0600FF; font-weight: bold;">return</span> <span style="color: #0600FF; font-weight: bold;">true</span><span style="color: #008000;">;</span>
	<span style="color: #008000;">&#125;</span>
&#160;
	<span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #0600FF; font-weight: bold;">static</span> <span style="color: #6666cc; font-weight: bold;">void</span> Main <span style="color: #008000;">&#40;</span><span style="color: #6666cc; font-weight: bold;">string</span><span style="color: #008000;">&#91;</span><span style="color: #008000;">&#93;</span> args<span style="color: #008000;">&#41;</span>
	<span style="color: #008000;">&#123;</span>
		ServicePointManager<span style="color: #008000;">.</span><span style="color: #0000FF;">ServerCertificateValidationCallback</span> <span style="color: #008000;">=</span> Validator<span style="color: #008000;">;</span>
		WebRequest wr <span style="color: #008000;">=</span> WebRequest<span style="color: #008000;">.</span><span style="color: #0000FF;">Create</span> <span style="color: #008000;">&#40;</span>args <span style="color: #008000;">&#91;</span><span style="color: #FF0000;">0</span><span style="color: #008000;">&#93;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
		Stream stream <span style="color: #008000;">=</span> wr<span style="color: #008000;">.</span><span style="color: #0000FF;">GetResponse</span> <span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">.</span><span style="color: #0000FF;">GetResponseStream</span> <span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
		Console<span style="color: #008000;">.</span><span style="color: #0000FF;">WriteLine</span> <span style="color: #008000;">&#40;</span><a href="http://www.google.com/search?q=new+msdn.microsoft.com"><span style="color: #008000;">new</span></a> StreamReader <span style="color: #008000;">&#40;</span>stream<span style="color: #008000;">&#41;</span><span style="color: #008000;">.</span><span style="color: #0000FF;">ReadToEnd</span> <span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
	<span style="color: #008000;">&#125;</span>		
<span style="color: #008000;">&#125;</span></pre>
<p>Source code for using the .NET 1.0 profile:
</p>
<pre class="csharp" style="font-family:monospace;"><span style="color: #0600FF; font-weight: bold;">using</span> <span style="color: #008080;">System</span><span style="color: #008000;">;</span>
<span style="color: #0600FF; font-weight: bold;">using</span> <span style="color: #008080;">System.IO</span><span style="color: #008000;">;</span>
<span style="color: #0600FF; font-weight: bold;">using</span> <span style="color: #008080;">System.Net</span><span style="color: #008000;">;</span>
<span style="color: #0600FF; font-weight: bold;">using</span> <span style="color: #008080;">System.Security.Cryptography.X509Certificates</span><span style="color: #008000;">;</span>
&#160;
<span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">class</span> Program <span style="color: #008000;">:</span> ICertificatePolicy <span style="color: #008000;">&#123;</span>
&#160;
	<span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">bool</span> CheckValidationResult <span style="color: #008000;">&#40;</span>ServicePoint sp, 
		X509Certificate certificate, WebRequest request, <span style="color: #6666cc; font-weight: bold;">int</span> error<span style="color: #008000;">&#41;</span>
	<span style="color: #008000;">&#123;</span>
		<span style="color: #0600FF; font-weight: bold;">return</span> <span style="color: #0600FF; font-weight: bold;">true</span><span style="color: #008000;">;</span>
	<span style="color: #008000;">&#125;</span>
&#160;
	<span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #0600FF; font-weight: bold;">static</span> <span style="color: #6666cc; font-weight: bold;">void</span> Main <span style="color: #008000;">&#40;</span><span style="color: #6666cc; font-weight: bold;">string</span><span style="color: #008000;">&#91;</span><span style="color: #008000;">&#93;</span> args<span style="color: #008000;">&#41;</span> 
	<span style="color: #008000;">&#123;</span>
		ServicePointManager<span style="color: #008000;">.</span><span style="color: #0000FF;">CertificatePolicy</span> <span style="color: #008000;">=</span> <a href="http://www.google.com/search?q=new+msdn.microsoft.com"><span style="color: #008000;">new</span></a> Program <span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
		WebRequest wr <span style="color: #008000;">=</span> WebRequest<span style="color: #008000;">.</span><span style="color: #0000FF;">Create</span> <span style="color: #008000;">&#40;</span>args <span style="color: #008000;">&#91;</span><span style="color: #FF0000;">0</span><span style="color: #008000;">&#93;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
		Stream stream <span style="color: #008000;">=</span> wr<span style="color: #008000;">.</span><span style="color: #0000FF;">GetResponse</span> <span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">.</span><span style="color: #0000FF;">GetResponseStream</span> <span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
		Console<span style="color: #008000;">.</span><span style="color: #0000FF;">WriteLine</span> <span style="color: #008000;">&#40;</span><a href="http://www.google.com/search?q=new+msdn.microsoft.com"><span style="color: #008000;">new</span></a> StreamReader <span style="color: #008000;">&#40;</span>stream<span style="color: #008000;">&#41;</span><span style="color: #008000;">.</span><span style="color: #0000FF;">ReadToEnd</span> <span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
	<span style="color: #008000;">&#125;</span>
<span style="color: #008000;">&#125;</span></pre>
<p>Instructions
</p>
<pre>% mcs am1.cs
% mono am1.exe <a href="https://www.some-site.com/" class="external free" rel="nofollow">https://www.some-site.com/</a>
</pre>
<p>This will show the web page content without any error.
</p>
<h2> <span class="mw-headline" id="Approach_.230:_Ignore_the_problem_2"> Approach #0: Ignore the problem </span></h2>
<p>Source code
</p>
<pre class="csharp" style="font-family:monospace;"><span style="color: #0600FF; font-weight: bold;">using</span> <span style="color: #008080;">System</span><span style="color: #008000;">;</span>
<span style="color: #0600FF; font-weight: bold;">using</span> <span style="color: #008080;">System.IO</span><span style="color: #008000;">;</span>
<span style="color: #0600FF; font-weight: bold;">using</span> <span style="color: #008080;">System.Net</span><span style="color: #008000;">;</span>
&#160;
<span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">class</span> Program <span style="color: #008000;">&#123;</span>
&#160;
	<span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #0600FF; font-weight: bold;">static</span> <span style="color: #6666cc; font-weight: bold;">void</span> Main <span style="color: #008000;">&#40;</span><span style="color: #6666cc; font-weight: bold;">string</span><span style="color: #008000;">&#91;</span><span style="color: #008000;">&#93;</span> args<span style="color: #008000;">&#41;</span> 
	<span style="color: #008000;">&#123;</span>
		WebRequest wr <span style="color: #008000;">=</span> WebRequest<span style="color: #008000;">.</span><span style="color: #0000FF;">Create</span> <span style="color: #008000;">&#40;</span>args <span style="color: #008000;">&#91;</span><span style="color: #FF0000;">0</span><span style="color: #008000;">&#93;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
		Stream stream <span style="color: #008000;">=</span> wr<span style="color: #008000;">.</span><span style="color: #0000FF;">GetResponse</span> <span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">.</span><span style="color: #0000FF;">GetResponseStream</span> <span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
		Console<span style="color: #008000;">.</span><span style="color: #0000FF;">WriteLine</span> <span style="color: #008000;">&#40;</span><a href="http://www.google.com/search?q=new+msdn.microsoft.com"><span style="color: #008000;">new</span></a> StreamReader <span style="color: #008000;">&#40;</span>stream<span style="color: #008000;">&#41;</span><span style="color: #008000;">.</span><span style="color: #0000FF;">ReadToEnd</span> <span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
	<span style="color: #008000;">&#125;</span>
<span style="color: #008000;">&#125;</span></pre>
<p><br />
Instructions
</p>
<pre>% mcs a0.cs
% mono a0.exe <a href="https://www.some-site.com/" class="external free" rel="nofollow">https://www.some-site.com/</a>
Unhandled Exception: System.Net.WebException: Error getting response stream (Trust failure): TrustFailure
---&gt; System.IO.IOException: The authentication or decryption has failed.
---&gt; Mono.Security.Protocol.Tls.TlsException: Invalid certificate received form server.
</pre>
<h2> <span class="mw-headline" id="Approach_.231:_Minimalist_2"> Approach #1: Minimalist </span></h2>
<p>Source code
</p>
<pre class="csharp" style="font-family:monospace;"><span style="color: #0600FF; font-weight: bold;">using</span> <span style="color: #008080;">System</span><span style="color: #008000;">;</span>
<span style="color: #0600FF; font-weight: bold;">using</span> <span style="color: #008080;">System.IO</span><span style="color: #008000;">;</span>
<span style="color: #0600FF; font-weight: bold;">using</span> <span style="color: #008080;">System.Net</span><span style="color: #008000;">;</span>
&#160;
<span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">class</span> Program <span style="color: #008000;">&#123;</span>
&#160;
	<span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #0600FF; font-weight: bold;">static</span> <span style="color: #6666cc; font-weight: bold;">void</span> Main <span style="color: #008000;">&#40;</span><span style="color: #6666cc; font-weight: bold;">string</span><span style="color: #008000;">&#91;</span><span style="color: #008000;">&#93;</span> args<span style="color: #008000;">&#41;</span> 
	<span style="color: #008000;">&#123;</span>
		<span style="color: #0600FF; font-weight: bold;">try</span> <span style="color: #008000;">&#123;</span>
			WebRequest wr <span style="color: #008000;">=</span> WebRequest<span style="color: #008000;">.</span><span style="color: #0000FF;">Create</span> <span style="color: #008000;">&#40;</span>args <span style="color: #008000;">&#91;</span><span style="color: #FF0000;">0</span><span style="color: #008000;">&#93;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
			Stream stream <span style="color: #008000;">=</span> wr<span style="color: #008000;">.</span><span style="color: #0000FF;">GetResponse</span> <span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">.</span><span style="color: #0000FF;">GetResponseStream</span> <span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
			Console<span style="color: #008000;">.</span><span style="color: #0000FF;">WriteLine</span> <span style="color: #008000;">&#40;</span><a href="http://www.google.com/search?q=new+msdn.microsoft.com"><span style="color: #008000;">new</span></a> StreamReader <span style="color: #008000;">&#40;</span>stream<span style="color: #008000;">&#41;</span><span style="color: #008000;">.</span><span style="color: #0000FF;">ReadToEnd</span> <span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
		<span style="color: #008000;">&#125;</span>
&#160;
		<span style="color: #0600FF; font-weight: bold;">catch</span> <span style="color: #008000;">&#40;</span>WebException we<span style="color: #008000;">&#41;</span> <span style="color: #008000;">&#123;</span>
			<span style="color: #0600FF; font-weight: bold;">if</span> <span style="color: #008000;">&#40;</span>we<span style="color: #008000;">.</span><span style="color: #0000FF;">Status</span> <span style="color: #008000;">!=</span> WebExceptionStatus<span style="color: #008000;">.</span><span style="color: #0000FF;">TrustFailure</span><span style="color: #008000;">&#41;</span>
				<span style="color: #0600FF; font-weight: bold;">throw</span><span style="color: #008000;">;</span>
			Console<span style="color: #008000;">.</span><span style="color: #0000FF;">WriteLine</span> <span style="color: #008000;">&#40;</span><span style="color: #666666;">&quot;You do not trust the people who &quot;</span> <span style="color: #008000;">+</span> 
				<span style="color: #666666;">&quot;issued the certificate being used by '{0}'.&quot;</span> <span style="color: #008000;">+</span> 
				<span style="color: #666666;">&quot; Please see the application help file on &quot;</span> <span style="color: #008000;">+</span> 
				<span style="color: #666666;">&quot;the 'trust certificate' subject to learn &quot;</span> <span style="color: #008000;">+</span> 
				<span style="color: #666666;">&quot;about how this can be fixed.&quot;</span>, args <span style="color: #008000;">&#91;</span><span style="color: #FF0000;">0</span><span style="color: #008000;">&#93;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
		<span style="color: #008000;">&#125;</span>
	<span style="color: #008000;">&#125;</span>
<span style="color: #008000;">&#125;</span></pre>
<p>Instructions
</p>
<pre>% mcs a1.cs
% mono a1.exe <a href="https://www.some-site.com/" class="external free" rel="nofollow">https://www.some-site.com/</a>
You do not trust the people who issued the certificate being used by '<a href="https://www.some-site.com'" class="external free" rel="nofollow">https://www.some-site.com'</a>.
Please see the application help file on the 'trust certificate' subject to learn about how this can be fixed.
</pre>
<h2> <span class="mw-headline" id="Approach_.232:_Warn_and_offer_the_possibility_to_continue_2"> Approach #2: Warn and offer the possibility to continue </span></h2>
<p>Source code
</p>
<pre class="csharp" style="font-family:monospace;"><span style="color: #0600FF; font-weight: bold;">using</span> <span style="color: #008080;">System</span><span style="color: #008000;">;</span>
<span style="color: #0600FF; font-weight: bold;">using</span> <span style="color: #008080;">System.IO</span><span style="color: #008000;">;</span>
<span style="color: #0600FF; font-weight: bold;">using</span> <span style="color: #008080;">System.Net</span><span style="color: #008000;">;</span>
<span style="color: #0600FF; font-weight: bold;">using</span> <span style="color: #008080;">System.Security.Cryptography.X509Certificates</span><span style="color: #008000;">;</span>
&#160;
<span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">class</span> Program <span style="color: #008000;">:</span> ICertificatePolicy <span style="color: #008000;">&#123;</span>
&#160;
	<span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">bool</span> CheckValidationResult <span style="color: #008000;">&#40;</span>ServicePoint sp, 
		X509Certificate certificate, WebRequest request, <span style="color: #6666cc; font-weight: bold;">int</span> error<span style="color: #008000;">&#41;</span>
	<span style="color: #008000;">&#123;</span>
		<span style="color: #0600FF; font-weight: bold;">if</span> <span style="color: #008000;">&#40;</span>error <span style="color: #008000;">==</span> <span style="color: #FF0000;">0</span><span style="color: #008000;">&#41;</span>
			<span style="color: #0600FF; font-weight: bold;">return</span> <span style="color: #0600FF; font-weight: bold;">true</span><span style="color: #008000;">;</span>
		<span style="color: #008080; font-style: italic;">// only ask for trust failure (you may want to handle more cases)</span>
		<span style="color: #0600FF; font-weight: bold;">if</span> <span style="color: #008000;">&#40;</span>error <span style="color: #008000;">!=</span> <span style="color: #008000;">-</span><span style="color: #FF0000;">2146762486</span><span style="color: #008000;">&#41;</span>
			<span style="color: #0600FF; font-weight: bold;">return</span> <span style="color: #0600FF; font-weight: bold;">false</span><span style="color: #008000;">;</span>
&#160;
		Console<span style="color: #008000;">.</span><span style="color: #0000FF;">Write</span> <span style="color: #008000;">&#40;</span><span style="color: #666666;">&quot;A trust error occured while attempting to &quot;</span> <span style="color: #008000;">+</span> 
			<span style="color: #666666;">&quot;access the web site. Do you wish to continue this &quot;</span> <span style="color: #008000;">+</span>
			<span style="color: #666666;">&quot;session even if we couldn't assess its security? &quot;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
		<span style="color: #0600FF; font-weight: bold;">return</span> <span style="color: #008000;">&#40;</span>Console<span style="color: #008000;">.</span><span style="color: #0000FF;">ReadLine</span> <span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">.</span><span style="color: #0000FF;">ToLower</span> <span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span> <span style="color: #008000;">==</span> <span style="color: #666666;">&quot;yes&quot;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
	<span style="color: #008000;">&#125;</span>
&#160;
	<span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #0600FF; font-weight: bold;">static</span> <span style="color: #6666cc; font-weight: bold;">void</span> Main <span style="color: #008000;">&#40;</span><span style="color: #6666cc; font-weight: bold;">string</span><span style="color: #008000;">&#91;</span><span style="color: #008000;">&#93;</span> args<span style="color: #008000;">&#41;</span> 
	<span style="color: #008000;">&#123;</span>
		ServicePointManager<span style="color: #008000;">.</span><span style="color: #0000FF;">CertificatePolicy</span> <span style="color: #008000;">=</span> <a href="http://www.google.com/search?q=new+msdn.microsoft.com"><span style="color: #008000;">new</span></a> Program <span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
		<span style="color: #0600FF; font-weight: bold;">try</span> <span style="color: #008000;">&#123;</span>
			WebRequest wr <span style="color: #008000;">=</span> WebRequest<span style="color: #008000;">.</span><span style="color: #0000FF;">Create</span> <span style="color: #008000;">&#40;</span>args <span style="color: #008000;">&#91;</span><span style="color: #FF0000;">0</span><span style="color: #008000;">&#93;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
			Stream stream <span style="color: #008000;">=</span> wr<span style="color: #008000;">.</span><span style="color: #0000FF;">GetResponse</span> <span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">.</span><span style="color: #0000FF;">GetResponseStream</span> <span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
			Console<span style="color: #008000;">.</span><span style="color: #0000FF;">WriteLine</span> <span style="color: #008000;">&#40;</span><a href="http://www.google.com/search?q=new+msdn.microsoft.com"><span style="color: #008000;">new</span></a> StreamReader <span style="color: #008000;">&#40;</span>stream<span style="color: #008000;">&#41;</span><span style="color: #008000;">.</span><span style="color: #0000FF;">ReadToEnd</span> <span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
		<span style="color: #008000;">&#125;</span>
		<span style="color: #0600FF; font-weight: bold;">catch</span> <span style="color: #008000;">&#40;</span>WebException we<span style="color: #008000;">&#41;</span> <span style="color: #008000;">&#123;</span>
			<span style="color: #008080; font-style: italic;">// don't show the exception for trust failures</span>
			<span style="color: #0600FF; font-weight: bold;">if</span> <span style="color: #008000;">&#40;</span>we<span style="color: #008000;">.</span><span style="color: #0000FF;">Status</span> <span style="color: #008000;">!=</span> WebExceptionStatus<span style="color: #008000;">.</span><span style="color: #0000FF;">TrustFailure</span><span style="color: #008000;">&#41;</span>
				<span style="color: #0600FF; font-weight: bold;">throw</span><span style="color: #008000;">;</span>
			Console<span style="color: #008000;">.</span><span style="color: #0000FF;">WriteLine</span> <span style="color: #008000;">&#40;</span><span style="color: #666666;">&quot;Operation aborted by user.&quot;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
		<span style="color: #008000;">&#125;</span>
	<span style="color: #008000;">&#125;</span>
<span style="color: #008000;">&#125;</span></pre>
<p>Instructions
</p>
<pre>% mcs a2.cs
% mono a2.exe <a href="https://www.some-site.com/" class="external free" rel="nofollow">https://www.some-site.com/</a>
A trust error occured while attempting to access the web site.
Do you wish to continue this session even if we couldn't assess it's security? no
Operation aborted by user.
</pre>
<p>Entering anything but <b>yes</b> results in the second message (aborted).
</p>
<h2> <span class="mw-headline" id="Approach_.233:_Application_centric_trust_2"> Approach #3: Application centric trust </span></h2>
<p>Source code
</p>
<pre class="csharp" style="font-family:monospace;"><span style="color: #0600FF; font-weight: bold;">using</span> <span style="color: #008080;">System</span><span style="color: #008000;">;</span>
<span style="color: #0600FF; font-weight: bold;">using</span> <span style="color: #008080;">System.Collections</span><span style="color: #008000;">;</span>
<span style="color: #0600FF; font-weight: bold;">using</span> <span style="color: #008080;">System.IO</span><span style="color: #008000;">;</span>
<span style="color: #0600FF; font-weight: bold;">using</span> <span style="color: #008080;">System.IO.IsolatedStorage</span><span style="color: #008000;">;</span>
<span style="color: #0600FF; font-weight: bold;">using</span> <span style="color: #008080;">System.Net</span><span style="color: #008000;">;</span>
<span style="color: #0600FF; font-weight: bold;">using</span> <span style="color: #008080;">System.Security.Cryptography.X509Certificates</span><span style="color: #008000;">;</span>
&#160;
<span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">class</span> Program <span style="color: #008000;">:</span> ICertificatePolicy <span style="color: #008000;">&#123;</span>
	<span style="color: #0600FF; font-weight: bold;">private</span> Hashtable ht<span style="color: #008000;">;</span>
&#160;
	<span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">void</span> Load <span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span>
	<span style="color: #008000;">&#123;</span>
		<span style="color: #0600FF; font-weight: bold;">if</span> <span style="color: #008000;">&#40;</span>ht <span style="color: #008000;">==</span> <span style="color: #0600FF; font-weight: bold;">null</span><span style="color: #008000;">&#41;</span> <span style="color: #008000;">&#123;</span>
			ht <span style="color: #008000;">=</span> <a href="http://www.google.com/search?q=new+msdn.microsoft.com"><span style="color: #008000;">new</span></a> Hashtable <span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
		<span style="color: #008000;">&#125;</span>
		<span style="color: #008080; font-style: italic;">// TODO - use isolated storage so this will work even with</span>
		<span style="color: #008080; font-style: italic;">// minimal security permissions</span>
	<span style="color: #008000;">&#125;</span>
&#160;
	<span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">void</span> Save <span style="color: #008000;">&#40;</span><span style="color: #6666cc; font-weight: bold;">int</span> error, <span style="color: #6666cc; font-weight: bold;">string</span> thumbprint<span style="color: #008000;">&#41;</span>
	<span style="color: #008000;">&#123;</span>
		<span style="color: #008080; font-style: italic;">// TODO</span>
	<span style="color: #008000;">&#125;</span>
&#160;
	<span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #6666cc; font-weight: bold;">bool</span> CheckValidationResult <span style="color: #008000;">&#40;</span>ServicePoint sp, 
		X509Certificate certificate, WebRequest request, <span style="color: #6666cc; font-weight: bold;">int</span> error<span style="color: #008000;">&#41;</span>
	<span style="color: #008000;">&#123;</span>
		<span style="color: #0600FF; font-weight: bold;">if</span> <span style="color: #008000;">&#40;</span>error <span style="color: #008000;">==</span> <span style="color: #FF0000;">0</span><span style="color: #008000;">&#41;</span>
			<span style="color: #0600FF; font-weight: bold;">return</span> <span style="color: #0600FF; font-weight: bold;">true</span><span style="color: #008000;">;</span>
		<span style="color: #008080; font-style: italic;">// only ask for trust failure (you may want to handle more cases)</span>
		<span style="color: #0600FF; font-weight: bold;">if</span> <span style="color: #008000;">&#40;</span>error <span style="color: #008000;">!=</span> <span style="color: #008000;">-</span><span style="color: #FF0000;">2146762486</span><span style="color: #008000;">&#41;</span>
			<span style="color: #0600FF; font-weight: bold;">return</span> <span style="color: #0600FF; font-weight: bold;">false</span><span style="color: #008000;">;</span>
&#160;
		Load <span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
		<span style="color: #6666cc; font-weight: bold;">string</span> thumbprint <span style="color: #008000;">=</span> certificate<span style="color: #008000;">.</span><span style="color: #0000FF;">GetCertHashString</span> <span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
		<span style="color: #6666cc; font-weight: bold;">object</span> result <span style="color: #008000;">=</span> ht <span style="color: #008000;">&#91;</span>thumbprint<span style="color: #008000;">&#93;</span><span style="color: #008000;">;</span>
		<span style="color: #0600FF; font-weight: bold;">if</span> <span style="color: #008000;">&#40;</span><span style="color: #008000;">&#40;</span>result <a href="http://www.google.com/search?q=is+msdn.microsoft.com"><span style="color: #008000;">is</span></a> <span style="color: #6666cc; font-weight: bold;">int</span><span style="color: #008000;">&#41;</span> <span style="color: #008000;">&amp;&amp;</span> <span style="color: #008000;">&#40;</span><span style="color: #008000;">&#40;</span><span style="color: #6666cc; font-weight: bold;">int</span><span style="color: #008000;">&#41;</span>result <span style="color: #008000;">==</span> error<span style="color: #008000;">&#41;</span><span style="color: #008000;">&#41;</span>
			<span style="color: #0600FF; font-weight: bold;">return</span> <span style="color: #0600FF; font-weight: bold;">true</span><span style="color: #008000;">;</span>
&#160;
		Console<span style="color: #008000;">.</span><span style="color: #0000FF;">WriteLine</span> <span style="color: #008000;">&#40;</span><span style="color: #666666;">&quot;A trust error occured while attempting &quot;</span> <span style="color: #008000;">+</span> 
			<span style="color: #666666;">&quot;to access the web site. Do you wish to:&quot;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
		Console<span style="color: #008000;">.</span><span style="color: #0000FF;">WriteLine</span> <span style="color: #008000;">&#40;</span><span style="color: #666666;">&quot;<span style="color: #008080; font-weight: bold;">\t</span>a) abort this untrusted session;&quot;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
		Console<span style="color: #008000;">.</span><span style="color: #0000FF;">WriteLine</span> <span style="color: #008000;">&#40;</span><span style="color: #666666;">&quot;<span style="color: #008080; font-weight: bold;">\t</span>b) continue this session (only once);&quot;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
		Console<span style="color: #008000;">.</span><span style="color: #0000FF;">WriteLine</span> <span style="color: #008000;">&#40;</span><span style="color: #666666;">&quot;<span style="color: #008080; font-weight: bold;">\t</span>c) trust this certificate with this &quot;</span> <span style="color: #008000;">+</span>
			<span style="color: #666666;">&quot;application (forever);&quot;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
&#160;
		<span style="color: #0600FF; font-weight: bold;">switch</span> <span style="color: #008000;">&#40;</span>Console<span style="color: #008000;">.</span><span style="color: #0000FF;">ReadLine</span> <span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">.</span><span style="color: #0000FF;">ToLower</span> <span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">&#41;</span> <span style="color: #008000;">&#123;</span>
			<span style="color: #0600FF; font-weight: bold;">case</span> <span style="color: #666666;">&quot;b&quot;</span><span style="color: #008000;">:</span>
				<span style="color: #0600FF; font-weight: bold;">return</span> <span style="color: #0600FF; font-weight: bold;">true</span><span style="color: #008000;">;</span>
			<span style="color: #0600FF; font-weight: bold;">case</span> <span style="color: #666666;">&quot;c&quot;</span><span style="color: #008000;">:</span>
				Save <span style="color: #008000;">&#40;</span>error, thumbprint<span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
				<span style="color: #0600FF; font-weight: bold;">return</span> <span style="color: #0600FF; font-weight: bold;">true</span><span style="color: #008000;">;</span>
			<span style="color: #0600FF; font-weight: bold;">case</span> <span style="color: #666666;">&quot;a&quot;</span><span style="color: #008000;">:</span>
			<span style="color: #0600FF; font-weight: bold;">default</span><span style="color: #008000;">:</span>
				<span style="color: #0600FF; font-weight: bold;">return</span> <span style="color: #0600FF; font-weight: bold;">false</span><span style="color: #008000;">;</span>
		<span style="color: #008000;">&#125;</span>
	<span style="color: #008000;">&#125;</span>
&#160;
	<span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #0600FF; font-weight: bold;">static</span> <span style="color: #6666cc; font-weight: bold;">void</span> Main <span style="color: #008000;">&#40;</span><span style="color: #6666cc; font-weight: bold;">string</span><span style="color: #008000;">&#91;</span><span style="color: #008000;">&#93;</span> args<span style="color: #008000;">&#41;</span> 
	<span style="color: #008000;">&#123;</span>
		ServicePointManager<span style="color: #008000;">.</span><span style="color: #0000FF;">CertificatePolicy</span> <span style="color: #008000;">=</span> <a href="http://www.google.com/search?q=new+msdn.microsoft.com"><span style="color: #008000;">new</span></a> Program <span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
		<span style="color: #0600FF; font-weight: bold;">try</span> <span style="color: #008000;">&#123;</span>
			WebRequest wr <span style="color: #008000;">=</span> WebRequest<span style="color: #008000;">.</span><span style="color: #0000FF;">Create</span> <span style="color: #008000;">&#40;</span>args <span style="color: #008000;">&#91;</span><span style="color: #FF0000;">0</span><span style="color: #008000;">&#93;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
			Stream stream <span style="color: #008000;">=</span> wr<span style="color: #008000;">.</span><span style="color: #0000FF;">GetResponse</span> <span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">.</span><span style="color: #0000FF;">GetResponseStream</span> <span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
			Console<span style="color: #008000;">.</span><span style="color: #0000FF;">WriteLine</span> <span style="color: #008000;">&#40;</span><a href="http://www.google.com/search?q=new+msdn.microsoft.com"><span style="color: #008000;">new</span></a> StreamReader <span style="color: #008000;">&#40;</span>stream<span style="color: #008000;">&#41;</span><span style="color: #008000;">.</span><span style="color: #0000FF;">ReadToEnd</span> <span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
		<span style="color: #008000;">&#125;</span>
		<span style="color: #0600FF; font-weight: bold;">catch</span> <span style="color: #008000;">&#40;</span>WebException we<span style="color: #008000;">&#41;</span> <span style="color: #008000;">&#123;</span>
			<span style="color: #008080; font-style: italic;">// don't show the exception for trust failures</span>
			<span style="color: #0600FF; font-weight: bold;">if</span> <span style="color: #008000;">&#40;</span>we<span style="color: #008000;">.</span><span style="color: #0000FF;">Status</span> <span style="color: #008000;">!=</span> WebExceptionStatus<span style="color: #008000;">.</span><span style="color: #0000FF;">TrustFailure</span><span style="color: #008000;">&#41;</span>
				<span style="color: #0600FF; font-weight: bold;">throw</span><span style="color: #008000;">;</span>
			Console<span style="color: #008000;">.</span><span style="color: #0000FF;">WriteLine</span> <span style="color: #008000;">&#40;</span><span style="color: #666666;">&quot;Operation aborted by user.&quot;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
		<span style="color: #008000;">&#125;</span>
	<span style="color: #008000;">&#125;</span>
<span style="color: #008000;">&#125;</span></pre>
<p><b>note: incomplete (no loading/saving to isolated storage)</b>
</p><p>Instructions
</p>
<pre>% mcs a3.cs
% mono a3.exe <a href="https://www.some-site.com/" class="external free" rel="nofollow">https://www.some-site.com/</a>
A trust error occured while attempting to access the web site. Do you wish to:
      a) abort this untrusted session;
      b) continue this session (only once);
      c) trust this certificate with this application (forever);
</pre>
<p>Entering <b>a</b> (or any invalid input) will abort the operation, <b>b</b> will allow the web page to be downloaded and printed once (i.e. you'll be asked again next time you try), <b>c</b> will download and print the web page but will never ask you again trusting the web site (unless it changes its certificate <b>and</b> and the root CA that issued it).
</p>
<h2> <span class="mw-headline" id="Approach_.234:_Offer_to_trust_the_new_root_certificate_2"> Approach #4: Offer to trust the new root certificate </span></h2>
<p>Source code
</p><p><b>note: missing. check back soon&#160;;-)</b>
</p><p>Instructions
</p>
<pre>% mcs a4.cs -r:Mono.Security.dll
% mono a4.exe <a href="https://www.some-site.com/" class="external free" rel="nofollow">https://www.some-site.com/</a>
A trust error occured while attempting to access the web site. Do you wish to:
      a) abort this untrusted session;
      b) continue this session (only once);
      c) add this certificate to your trusted list (all applications, forever);
</pre>
<p>Note: this sample code will only work using Mono's certificate stores. You can use a similar technique by either p/invoking into CryptoAPI to access the Windows' certificate stores (fx 1.x) or use the new classes introduced in fx 2.0.
</p>
<h2> <span class="mw-headline" id="Approach_.235:_Application_or_global_trust_2"> Approach #5: Application or global trust </span></h2>
<p>No source code provided. You can easily merge both #3 and #4 source code
to obtain a working sample.
</p>
