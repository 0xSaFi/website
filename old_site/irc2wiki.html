---
layout: obsolete
title: "Irc2Wiki"
permalink: /old_site/Irc2Wiki/
redirect_from:
  - /Irc2Wiki/
---

<h1>Irc2Wiki</h1>

<p>A mutiliated version of Jamie Zawinksi's irc2html.pl that creates basic MediaWiki tables instead of HTML.  Used by the <a href="{{site.baseurl}}/Accessibility:_Team" title="Accessibility: Team"> Accessibility Team</a> to post IRC meeting logs.  Works great with irssi log format; can't speak for anything else.
</p>
<pre class="perl" style="font-family:monospace;"><span style="color: #666666; font-style: italic;">#!/usr/bin/perl -w</span>
<span style="color: #666666; font-style: italic;"># irc2wiki.pl --- Hacked up irc2html.pl that spits plain MediaWiki tables</span>
<span style="color: #666666; font-style: italic;">#                 Sandy Armstrong &lt;sanfordarmstrong@gmail.com&gt;</span>
<span style="color: #666666; font-style: italic;"># irc2html.pl --- converts raw chat logs to a readable HTML table-ized form.</span>
<span style="color: #666666; font-style: italic;"># Copyright Â© 1998-2006 Jamie Zawinski &lt;jwz@jwz.org&gt;</span>
<span style="color: #666666; font-style: italic;">#</span>
<span style="color: #666666; font-style: italic;"># Permission to use, copy, modify, distribute, and sell this software and its</span>
<span style="color: #666666; font-style: italic;"># documentation for any purpose is hereby granted without fee, provided that</span>
<span style="color: #666666; font-style: italic;"># the above copyright notice appear in all copies and that both that</span>
<span style="color: #666666; font-style: italic;"># copyright notice and this permission notice appear in supporting</span>
<span style="color: #666666; font-style: italic;"># documentation.  No representations are made about the suitability of this</span>
<span style="color: #666666; font-style: italic;"># software for any purpose.  It is provided &quot;as is&quot; without express or </span>
<span style="color: #666666; font-style: italic;"># implied warranty.</span>
<span style="color: #666666; font-style: italic;">#</span>
<span style="color: #666666; font-style: italic;"># Created: 11-Jun-98.</span>
<span style="color: #666666; font-style: italic;">#</span>
<span style="color: #666666; font-style: italic;"># usage: irc2html.pl [--verbose] [--strip] [--no-color] infile outfile</span>
<span style="color: #666666; font-style: italic;"># Or, just install it as a CGI on your web server.</span>
<span style="color: #666666; font-style: italic;">#</span>
<span style="color: #666666; font-style: italic;"># The format it expects from the logs is the format written by, e.g., tkirc:</span>
<span style="color: #666666; font-style: italic;"># each line has a \t on it, and the part before the tab is the person talking,</span>
<span style="color: #666666; font-style: italic;"># or the action happening (&quot;[ join ]&quot; and so on) and the part after the tab</span>
<span style="color: #666666; font-style: italic;"># is the actual text.</span>
<span style="color: #666666; font-style: italic;">#</span>
<span style="color: #666666; font-style: italic;"># A number of other formats are accepted as well, e.g.,</span>
<span style="color: #666666; font-style: italic;">#</span>
<span style="color: #666666; font-style: italic;">#      [17:01:17] &lt;user&gt; blah blah</span>
<span style="color: #666666; font-style: italic;"># and</span>
<span style="color: #666666; font-style: italic;">#      13:25 [xxx(~xxx@00.11.222.333)] blah blah</span>
<span style="color: #666666; font-style: italic;">#      13:25 [msg(xxx)] blah blah</span>
<span style="color: #666666; font-style: italic;">#</span>
<span style="color: #666666; font-style: italic;"># If the line doesn't match any of the known patterns, then we assume that</span>
<span style="color: #666666; font-style: italic;"># the stuff before the first space is the action and the rest is the text.</span>
<span style="color: #666666; font-style: italic;">#</span>
<span style="color: #666666; font-style: italic;"># The lines alternate white and gray, changing each time the person talking</span>
<span style="color: #666666; font-style: italic;"># changes (so multiple lines by the same person are colored the same.)</span>
<span style="color: #666666; font-style: italic;"># Or, if --no-color is specified, the talkers are separated by solid</span>
<span style="color: #666666; font-style: italic;"># horizontal lines.</span>
<span style="color: #666666; font-style: italic;">#</span>
<span style="color: #666666; font-style: italic;"># If a line ends in something that looks like a timestamp, that goes in</span>
<span style="color: #666666; font-style: italic;"># column 3.</span>
<span style="color: #666666; font-style: italic;">#</span>
<span style="color: #666666; font-style: italic;"># The --strip option means to strip out non-talking lines, like &quot;[ join ]&quot;.</span>
<span style="color: #666666; font-style: italic;">#</span>
<span style="color: #666666; font-style: italic;"># URLs are made clickable.</span>
<span style="color: #666666; font-style: italic;">#</span>
<span style="color: #666666; font-style: italic;"># Color codes, bold, etc. are also supported, thanks to</span>
<span style="color: #666666; font-style: italic;"># Andy Brezinsky &lt;andy@mbrez.com&gt; and Juerd &lt;juerd@juerd.nl&gt;.</span>
<span style="color: #666666; font-style: italic;">#</span>
<span style="color: #666666; font-style: italic;">#</span>
<span style="color: #666666; font-style: italic;"># This script also works as a CGI: just make a symlink (e.g., irc2html.cgi)</span>
<span style="color: #666666; font-style: italic;"># and it will present you with a text area where you can paste your char log.</span>
<span style="color: #666666; font-style: italic;"># When you submit, it will return the HTML document.  This might save some</span>
<span style="color: #666666; font-style: italic;"># time messing around with temporary files.</span>
<span style="color: #666666; font-style: italic;">#</span>
<span style="color: #666666; font-style: italic;"># 5-May-2006: jwz: updated to use CSS instead of &lt;FONT&gt; tags.</span>
&#160;
<a href="http://perldoc.perl.org/functions/require.html"><span style="color: #000066;">require</span></a> <span style="color: #cc66cc;">5</span><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">use</span> diagnostics<span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">use</span> strict<span style="color: #339933;">;</span>
&#160;
<span style="color: #b1b100;">my</span> <span style="color: #0000ff;">$progname</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">$0</span><span style="color: #339933;">;</span> <span style="color: #0000ff;">$progname</span> <span style="color: #339933;">=~</span> <a href="http://perldoc.perl.org/functions/s.html"><span style="color: #000066;">s</span></a><span style="color: #339933;">@^.*/</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#91;</span><span style="color: #339933;">^/</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">+</span><span style="color: #009900;">&#41;</span><span style="color: #0000ff;">$@</span><span style="color: #0000ff;">$1</span><span style="color: #339933;">@;</span>
<span style="color: #b1b100;">my</span> <span style="color: #0000ff;">$version</span> <span style="color: #339933;">=</span> <a href="http://perldoc.perl.org/functions/q.html"><span style="color: #000066;">q</span></a><span style="color: #009900;">&#123;</span> <span style="color: #0000ff;">$Revision</span><span style="color: #339933;">:</span> <span style="color: #cc66cc;">1.23</span> $ <span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span> <span style="color: #0000ff;">$version</span> <span style="color: #339933;">=~</span> <span style="color: #009966; font-style: italic;">s/^[^0-9]+([0-9.]+).*$/$1/</span><span style="color: #339933;">;</span>
&#160;
<span style="color: #b1b100;">my</span> <span style="color: #0000ff;">$verbose</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span>
&#160;
<span style="color: #b1b100;">my</span> <span style="color: #0000ff;">$strip_seconds</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">1</span><span style="color: #339933;">;</span>     <span style="color: #666666; font-style: italic;"># whether to keep timestamps in hh:mm only.</span>
<span style="color: #b1b100;">my</span> <span style="color: #0000ff;">$strip_timestamps</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span>  <span style="color: #666666; font-style: italic;"># whether to omit any third column entirely.</span>
<span style="color: #b1b100;">my</span> <span style="color: #0000ff;">$strip_noise</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span>       <span style="color: #666666; font-style: italic;"># whether to strip &quot;join&quot;, &quot;leave&quot;, etc.</span>
<span style="color: #b1b100;">my</span> <span style="color: #0000ff;">$colorize_p</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">1</span><span style="color: #339933;">;</span>        <span style="color: #666666; font-style: italic;"># whether to do background colors.</span>
<span style="color: #b1b100;">my</span> <span style="color: #0000ff;">$separators_p</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span>      <span style="color: #666666; font-style: italic;"># whether to do horizontal lines.</span>
<span style="color: #b1b100;">my</span> <span style="color: #0000ff;">$chunk_size</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">200</span><span style="color: #339933;">;</span>      <span style="color: #666666; font-style: italic;"># start a new table after this many lines.</span>
&#160;
<span style="color: #b1b100;">my</span> <span style="color: #0000ff;">$url_re</span> <span style="color: #339933;">=</span> <a href="http://perldoc.perl.org/functions/q.html"><span style="color: #000066;">q</span></a><span style="color: #009900;">&#123;</span><span style="color: #0000ff;">\b</span><span style="color: #009900;">&#40;</span><a href="http://perldoc.perl.org/functions/s.html"><span style="color: #000066;">s</span></a><span style="color: #339933;">?</span>https<span style="color: #339933;">?|</span>ftp<span style="color: #339933;">|</span>file<span style="color: #339933;">|</span>gopher<span style="color: #339933;">|</span><a href="http://perldoc.perl.org/functions/s.html"><span style="color: #000066;">s</span></a><span style="color: #339933;">?</span>news<span style="color: #339933;">|</span>telnet<span style="color: #339933;">|</span>mailbox<span style="color: #009900;">&#41;</span><span style="color: #339933;">:</span><span style="color: #009900;">&#125;</span> <span style="color: #339933;">.</span>
             <a href="http://perldoc.perl.org/functions/q.html"><span style="color: #000066;">q</span></a><span style="color: #009900;">&#123;</span><span style="color: #009900;">&#40;</span><span style="color: #339933;">//</span><span style="color: #009900;">&#91;</span><span style="color: #339933;">-</span>A<span style="color: #339933;">-</span>Z0<span style="color: #339933;">-</span><span style="color: #cc66cc;">9</span>_<span style="color: #339933;">.</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">+:</span><span style="color: #0000ff;">\d</span><span style="color: #339933;">*</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">?</span><span style="color: #009900;">&#125;</span> <span style="color: #339933;">.</span>
             <a href="http://perldoc.perl.org/functions/q.html"><span style="color: #000066;">q</span></a><span style="color: #009900;">&#123;</span><span style="color: #009900;">&#91;</span><span style="color: #339933;">-</span>A<span style="color: #339933;">-</span>Z0<span style="color: #339933;">-</span><span style="color: #cc66cc;">9</span>_<span style="color: #339933;">=?</span>\<span style="color: #666666; font-style: italic;">#\$\@~\`%&amp;*+|\/.,;\240]+};</span>
&#160;
<span style="color: #b1b100;">my</span> <span style="color: #0000ff;">$fg_color</span>  <span style="color: #339933;">=</span> <span style="color: #ff0000;">&quot;#000&quot;</span><span style="color: #339933;">;</span>
<span style="color: #b1b100;">my</span> <span style="color: #0000ff;">$bg_color1</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">&quot;#FFF&quot;</span><span style="color: #339933;">;</span>
<span style="color: #b1b100;">my</span> <span style="color: #0000ff;">$bg_color2</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">&quot;#EEE&quot;</span><span style="color: #339933;">;</span>
&#160;
&#160;
<span style="color: #0000ff;">$ENV</span><span style="color: #009900;">&#123;</span>USER<span style="color: #009900;">&#125;</span> <span style="color: #339933;">=</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$ENV</span><span style="color: #009900;">&#123;</span>REMOTE_ADDR<span style="color: #009900;">&#125;</span> <span style="color: #339933;">||</span> <span style="color: #ff0000;">'?'</span><span style="color: #009900;">&#41;</span> <span style="color: #b1b100;">unless</span> <a href="http://perldoc.perl.org/functions/defined.html"><span style="color: #000066;">defined</span></a> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$ENV</span><span style="color: #009900;">&#123;</span>USER<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&#160;
<span style="color: #b1b100;">my</span> <span style="color: #0000ff;">$doc_head</span> <span style="color: #339933;">=</span> 
 <span style="color: #009900;">&#40;</span>
  <span style="color: #ff0000;">&quot;&quot;</span>
 <span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&#160;
<span style="color: #b1b100;">my</span> <span style="color: #0000ff;">$stylesheet</span> <span style="color: #339933;">=</span> 
 <span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;&lt;!--   This style sheet can be omitted if you don't care<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">.</span>
  <span style="color: #ff0000;">&quot;       about the colored text that was used below.   --&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">.</span>
  <span style="color: #ff0000;">&quot;&lt;STYLE TYPE=<span style="color: #000099; font-weight: bold;">\&quot;</span>text/css<span style="color: #000099; font-weight: bold;">\&quot;</span>&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">.</span>
  <span style="color: #ff0000;">&quot; &lt;!--<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">.</span>
  <span style="color: #ff0000;">&quot;  .fc0  { color:white   } .bc0  { background:white   }<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">.</span>
  <span style="color: #ff0000;">&quot;  .fc1  { color:black   } .bc1  { background:black   }<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">.</span>
  <span style="color: #ff0000;">&quot;  .fc2  { color:navy    } .bc2  { background:navy    }<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">.</span>
  <span style="color: #ff0000;">&quot;  .fc3  { color:green   } .bc3  { background:green   }<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">.</span>
  <span style="color: #ff0000;">&quot;  .fc4  { color:red     } .bc4  { background:red     }<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">.</span>
  <span style="color: #ff0000;">&quot;  .fc5  { color:darkred } .bc5  { background:darkred }<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">.</span>
  <span style="color: #ff0000;">&quot;  .fc6  { color:purple  } .bc6  { background:purple  }<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">.</span>
  <span style="color: #ff0000;">&quot;  .fc7  { color:orange  } .bc7  { background:orange  }<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">.</span>
  <span style="color: #ff0000;">&quot;  .fc8  { color:yellow  } .bc8  { background:yellow  }<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">.</span>
  <span style="color: #ff0000;">&quot;  .fc9  { color:lime    } .bc9  { background:lime    }<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">.</span>
  <span style="color: #ff0000;">&quot;  .fc10 { color:aqua    } .bc10 { background:aqua    }<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">.</span>
  <span style="color: #ff0000;">&quot;  .fc11 { color:C0C0FF  } .bc11 { background:C0C0FF  }<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">.</span>
  <span style="color: #ff0000;">&quot;  .fc12 { color:blue    } .bc12 { background:blue    }<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">.</span>
  <span style="color: #ff0000;">&quot;  .fc13 { color:magenta } .bc13 { background:magenta }<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">.</span>
  <span style="color: #ff0000;">&quot;  .fc14 { color:gray    } .bc14 { background:gray    }<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">.</span>
  <span style="color: #ff0000;">&quot;  .fc15 { color:silver  } .bc15 { background:silver  }<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">.</span>
<span style="color: #666666; font-style: italic;"># &quot;  .fixed {font-family: fixedsys, courier new, courier, fixed;\n&quot; .</span>
<span style="color: #666666; font-style: italic;"># &quot;          font-size: xx-small; }\n&quot; .</span>
  <span style="color: #ff0000;">&quot;  --&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">.</span>
  <span style="color: #ff0000;">&quot;&lt;/STYLE&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">.</span>
  <span style="color: #ff0000;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&#160;
<span style="color: #b1b100;">my</span> <span style="color: #0000ff;">$margin_style</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">&quot; STYLE=<span style="color: #000099; font-weight: bold;">\&quot;</span>border-top: 1px solid;<span style="color: #000099; font-weight: bold;">\&quot;</span>&quot;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;"># used for separators</span>
&#160;
&#160;
<span style="color: #b1b100;">my</span> <span style="color: #0000ff;">$input_lines</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span>
<span style="color: #b1b100;">my</span> <span style="color: #0000ff;">$output_lines</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span>
&#160;
&#160;
<span style="color: #000000; font-weight: bold;">sub</span> convert_line_body<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$)</span> <span style="color: #009900;">&#123;</span>
  <span style="color: #b1b100;">my</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$line</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">@_</span><span style="color: #339933;">;</span>
&#160;
  <span style="color: #666666; font-style: italic;"># don't allow any single word to be longer than N chars -- insert spaces.</span>
  <span style="color: #666666; font-style: italic;"># (actually, insert non-breaking spaces (240) which we convert later.)</span>
  <span style="color: #cc66cc;">1</span> <span style="color: #b1b100;">while</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$line</span> <span style="color: #339933;">=~</span> <a href="http://perldoc.perl.org/functions/s.html"><span style="color: #000066;">s</span></a><span style="color: #339933;">/^</span><span style="color: #009900;">&#40;</span><span style="color: #339933;">.*?</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#91;</span><span style="color: #339933;">^</span> <span style="color: #0000ff;">\t</span><span style="color: #0000ff;">\n</span>\<span style="color: #cc66cc;">240</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#123;</span><span style="color: #cc66cc;">40</span><span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#91;</span><span style="color: #339933;">^</span> <span style="color: #0000ff;">\t</span><span style="color: #0000ff;">\n</span>\<span style="color: #cc66cc;">240</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">.*</span><span style="color: #009900;">&#41;</span><span style="color: #0000ff;">$/</span><span style="color: #0000ff;">$1</span><span style="color: #0000ff;">$2</span>\<span style="color: #cc66cc;">240</span><span style="color: #0000ff;">$3</span><span style="color: #339933;">/</span><a href="http://perldoc.perl.org/functions/s.html"><span style="color: #000066;">s</span></a><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&#160;
  <span style="color: #0000ff;">$line</span> <span style="color: #339933;">=~</span> <span style="color: #009966; font-style: italic;">s/&amp;/&amp;amp;/g</span><span style="color: #339933;">;</span>
  <span style="color: #0000ff;">$line</span> <span style="color: #339933;">=~</span> <span style="color: #009966; font-style: italic;">s/&lt;/&amp;lt;/g</span><span style="color: #339933;">;</span>
  <span style="color: #0000ff;">$line</span> <span style="color: #339933;">=~</span> <span style="color: #009966; font-style: italic;">s/&gt;/&amp;gt;/g</span><span style="color: #339933;">;</span>
<span style="color: #666666; font-style: italic;">#  $line =~ s/\&quot;/&amp;quot;/g;</span>
&#160;
  <span style="color: #666666; font-style: italic;"># make urls clickable.</span>
  <span style="color: #666666; font-style: italic;">#$line =~ s@($url_re)@&lt;A HREF=&quot;$1&quot;&gt;$1&lt;/A&gt;@gi;</span>
&#160;
  <span style="color: #666666; font-style: italic;"># if the url appeared to end in punctuation, back up over it.</span>
  <span style="color: #666666; font-style: italic;">#$line =~ s@([-.,!;?\#]+)(\&quot;&gt;)@$2@gs;</span>
  <span style="color: #666666; font-style: italic;">#$line =~ s@([-.,!;?\#]+)(&lt;/A&gt;)@$2$1@gs;</span>
&#160;
  <span style="color: #666666; font-style: italic;"># if we inserted any non-breaking spaces inside URLs, just nuke them.</span>
  <span style="color: #666666; font-style: italic;">#1 while ($line =~ s@(&lt;A HREF=\&quot;[^\&quot;\240]*)\240([^\&quot;]*\&quot;&gt;)@$1$2@gi);</span>
&#160;
  <span style="color: #666666; font-style: italic;"># convert remaining non-breaking spaces to real spaces.</span>
  <span style="color: #0000ff;">$line</span> <span style="color: #339933;">=~</span> <span style="color: #009966; font-style: italic;">s/\240/ /g</span><span style="color: #339933;">;</span>
&#160;
  <span style="color: #666666; font-style: italic;">#if ($verbose) {</span>
  <span style="color: #666666; font-style: italic;">#  $_ = $line;</span>
  <span style="color: #666666; font-style: italic;">#  while (s@&lt;A HREF=\&quot;(.*?)\&quot;&gt;@@i) {</span>
  <span style="color: #666666; font-style: italic;">#    print STDERR &quot;$progname: line $input_lines: URL: $1\n&quot;;</span>
  <span style="color: #666666; font-style: italic;">#  }</span>
  <span style="color: #666666; font-style: italic;">#}</span>
&#160;
  <span style="color: #666666; font-style: italic;"># if there are any ctl characters in it, do color-decoding</span>
  <span style="color: #0000ff;">$line</span> <span style="color: #339933;">=</span> convert_color <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$line</span><span style="color: #009900;">&#41;</span>
    <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$line</span> <span style="color: #339933;">=~</span> <span style="color: #009966; font-style: italic;">m/[\000-\010\013\014\016-\037]/</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&#160;
  <a href="http://perldoc.perl.org/functions/return.html"><span style="color: #000066;">return</span></a> <span style="color: #0000ff;">$line</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span>
&#160;
&#160;
<span style="color: #b1b100;">my</span> <span style="color: #0000ff;">$prev_head</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">&quot;&quot;</span><span style="color: #339933;">;</span>
<span style="color: #b1b100;">my</span> <span style="color: #0000ff;">$prev_stamp</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">&quot;&quot;</span><span style="color: #339933;">;</span>
<span style="color: #b1b100;">my</span> <span style="color: #0000ff;">$bg_color</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">$bg_color1</span><span style="color: #339933;">;</span>
<span style="color: #b1b100;">my</span> <span style="color: #0000ff;">$line_tick</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span>
<span style="color: #b1b100;">my</span> <span style="color: #0000ff;">$any_styles</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span>   <span style="color: #666666; font-style: italic;"># whether any red hot style sheet action is needed</span>
&#160;
<span style="color: #000000; font-weight: bold;">sub</span> convert_line<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$)</span> <span style="color: #009900;">&#123;</span>
  <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$_</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">@_</span><span style="color: #339933;">;</span>
&#160;
  <span style="color: #666666; font-style: italic;"># alternate log format...</span>
  <a href="http://perldoc.perl.org/functions/s.html"><span style="color: #000066;">s</span></a><span style="color: #339933;">@^</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">\d</span><span style="color: #339933;">?</span><span style="color: #0000ff;">\d</span><span style="color: #339933;">:</span><span style="color: #0000ff;">\d</span><span style="color: #0000ff;">\d</span><span style="color: #009900;">&#40;</span><span style="color: #339933;">:</span><span style="color: #0000ff;">\d</span><span style="color: #0000ff;">\d</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">?</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#93;</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">.*</span><span style="color: #009900;">&#41;</span><span style="color: #0000ff;">$@</span><span style="color: #0000ff;">$3</span> <span style="color: #009900;">&#123;</span><span style="color: #0000ff;">$1</span><span style="color: #009900;">&#125;</span><span style="color: #0000ff;">@gs</span><span style="color: #339933;">;</span>    <span style="color: #666666; font-style: italic;"># leading timestamp</span>
  <a href="http://perldoc.perl.org/functions/s.html"><span style="color: #000066;">s</span></a><span style="color: #339933;">@^</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">\d</span><span style="color: #339933;">?</span><span style="color: #0000ff;">\d</span><span style="color: #339933;">:</span><span style="color: #0000ff;">\d</span><span style="color: #0000ff;">\d</span><span style="color: #009900;">&#40;</span><span style="color: #339933;">:</span><span style="color: #0000ff;">\d</span><span style="color: #0000ff;">\d</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">?</span> <span style="color: #339933;">?</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#91;</span>AP<span style="color: #009900;">&#93;</span>M<span style="color: #009900;">&#41;</span><span style="color: #339933;">?</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">.*</span><span style="color: #009900;">&#41;</span><span style="color: #0000ff;">$@</span><span style="color: #0000ff;">$4</span> <span style="color: #009900;">&#123;</span><span style="color: #0000ff;">$1</span><span style="color: #009900;">&#125;</span><span style="color: #0000ff;">@gsi</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;"># leading timestamp</span>
&#160;
  <span style="color: #666666; font-style: italic;"># leading time/date stamp</span>
  <a href="http://perldoc.perl.org/functions/s.html"><span style="color: #000066;">s</span></a><span style="color: #339933;">@^</span>\<span style="color: #009900;">&#91;</span><span style="color: #0000ff;">\d</span><span style="color: #0000ff;">\d</span><span style="color: #339933;">?/</span><span style="color: #0000ff;">\d</span><span style="color: #0000ff;">\d</span><span style="color: #339933;">/</span><span style="color: #0000ff;">\d</span><span style="color: #0000ff;">\d</span> \<span style="color: #339933;">@</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">\d</span><span style="color: #339933;">?</span><span style="color: #0000ff;">\d</span><span style="color: #339933;">:</span><span style="color: #0000ff;">\d</span><span style="color: #0000ff;">\d</span><span style="color: #009900;">&#40;</span><span style="color: #339933;">:</span><span style="color: #0000ff;">\d</span><span style="color: #0000ff;">\d</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">?</span><span style="color: #009900;">&#41;</span>\<span style="color: #009900;">&#93;</span>\<a href="http://perldoc.perl.org/functions/s.html"><span style="color: #000066;">s</span></a><span style="color: #339933;">+</span><span style="color: #009900;">&#40;</span><span style="color: #339933;">.*</span><span style="color: #009900;">&#41;</span><span style="color: #0000ff;">$@</span><span style="color: #0000ff;">$3</span> <span style="color: #009900;">&#123;</span><span style="color: #0000ff;">$1</span><span style="color: #009900;">&#125;</span><span style="color: #0000ff;">@gs</span><span style="color: #339933;">;</span>
&#160;
  <span style="color: #666666; font-style: italic;"># IRSSI leading full date log format</span>
  <a href="http://perldoc.perl.org/functions/s.html"><span style="color: #000066;">s</span></a><span style="color: #339933;">@^</span><span style="color: #0000ff;">\d</span><span style="color: #0000ff;">\d</span><span style="color: #339933;">?-...-</span><span style="color: #0000ff;">\d</span><span style="color: #0000ff;">\d</span><span style="color: #0000ff;">\d</span><span style="color: #0000ff;">\d</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">\d</span><span style="color: #0000ff;">\d</span><span style="color: #339933;">?:</span><span style="color: #0000ff;">\d</span><span style="color: #0000ff;">\d</span><span style="color: #009900;">&#40;</span><span style="color: #339933;">:</span><span style="color: #0000ff;">\d</span><span style="color: #0000ff;">\d</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">?</span><span style="color: #009900;">&#41;</span>\<a href="http://perldoc.perl.org/functions/s.html"><span style="color: #000066;">s</span></a><span style="color: #339933;">+</span><span style="color: #009900;">&#40;</span><span style="color: #339933;">.*</span><span style="color: #009900;">&#41;</span><span style="color: #0000ff;">$@</span><span style="color: #0000ff;">$3</span> <span style="color: #009900;">&#123;</span><span style="color: #0000ff;">$1</span><span style="color: #009900;">&#125;</span><span style="color: #0000ff;">@gs</span><span style="color: #339933;">;</span>
&#160;
  <span style="color: #666666; font-style: italic;"># GAIM inline timestamps (alone on a line with leading whitespace)</span>
  <a href="http://perldoc.perl.org/functions/s.html"><span style="color: #000066;">s</span></a><span style="color: #339933;">@^</span>  <span style="color: #339933;">+</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">\d</span><span style="color: #0000ff;">\d</span><span style="color: #339933;">?:</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">?</span><span style="color: #0000ff;">\d</span><span style="color: #0000ff;">\d</span><span style="color: #339933;">?:</span><span style="color: #0000ff;">\d</span><span style="color: #0000ff;">\d</span><span style="color: #009900;">&#41;</span><span style="color: #0000ff;">$@</span><span style="color: #339933;">***</span> <span style="color: #0000ff;">$1</span><span style="color: #0000ff;">@gs</span><span style="color: #339933;">;</span>
&#160;
  <span style="color: #666666; font-style: italic;"># goofy name+host format...</span>
  <a href="http://perldoc.perl.org/functions/s.html"><span style="color: #000066;">s</span></a><span style="color: #339933;">@^</span>\<span style="color: #009900;">&#91;</span>msg\<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#91;</span><span style="color: #339933;">^</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>\<span style="color: #009900;">&#91;</span>\<span style="color: #009900;">&#93;</span> <span style="color: #0000ff;">\t</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">+</span><span style="color: #009900;">&#41;</span>\<span style="color: #009900;">&#41;</span>\<span style="color: #009900;">&#93;</span> <span style="color: #339933;">@&gt;&gt;</span> <span style="color: #0000ff;">$1</span><span style="color: #0000ff;">\t</span><span style="color: #0000ff;">@gsi</span><span style="color: #339933;">;</span>
  <a href="http://perldoc.perl.org/functions/s.html"><span style="color: #000066;">s</span></a><span style="color: #339933;">@^</span>\<span style="color: #009900;">&#91;</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#91;</span><span style="color: #339933;">^</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>\<span style="color: #009900;">&#91;</span>\<span style="color: #009900;">&#93;</span> <span style="color: #0000ff;">\t</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">+</span><span style="color: #009900;">&#41;</span>\<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#91;</span><span style="color: #339933;">^</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>\<span style="color: #009900;">&#91;</span>\<span style="color: #009900;">&#93;</span> <span style="color: #0000ff;">\t</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">+</span><span style="color: #009900;">&#41;</span>\<span style="color: #009900;">&#41;</span>\<span style="color: #009900;">&#93;</span> <span style="color: #339933;">@&lt;</span><span style="color: #0000ff;">$1</span><span style="color: #339933;">&gt;</span><span style="color: #0000ff;">\t</span><span style="color: #0000ff;">@gsi</span><span style="color: #339933;">;</span>
&#160;
  <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://perldoc.perl.org/functions/m.html"><span style="color: #000066;">m</span></a><span style="color: #339933;">@^</span>\<a href="http://perldoc.perl.org/functions/s.html"><span style="color: #000066;">s</span></a><span style="color: #339933;">*</span><span style="color: #0000ff;">$@</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    <span style="color: #0000ff;">$prev_head</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">&quot;&quot;</span><span style="color: #339933;">;</span>
    <span style="color: #0000ff;">$bg_color</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">$bg_color1</span><span style="color: #339933;">;</span>
    <span style="color: #b1b100;">my</span> <span style="color: #0000ff;">$color_style</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">''</span><span style="color: #339933;">;</span>
    <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$colorize_p</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
      <span style="color: #0000ff;">$color_style</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">&quot; STYLE=<span style="color: #000099; font-weight: bold;">\&quot;</span>background:$bg_color<span style="color: #000099; font-weight: bold;">\&quot;</span>&quot;</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span>
    <a href="http://perldoc.perl.org/functions/return.html"><span style="color: #000066;">return</span></a> <span style="color: #ff0000;">&quot;&lt;TR&gt;&lt;TD COLSPAN=2$color_style&gt;&lt;BR&gt;&lt;/TD&gt;&lt;/TR&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
  <span style="color: #009900;">&#125;</span>
&#160;
  <span style="color: #b1b100;">my</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$head</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">$body</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">=</span> <a href="http://perldoc.perl.org/functions/m.html"><span style="color: #000066;">m</span></a><span style="color: #339933;">@^</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#91;</span><span style="color: #339933;">^</span><span style="color: #0000ff;">\t</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">+</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">\t</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">+</span><span style="color: #009900;">&#40;</span><span style="color: #339933;">.*</span><span style="color: #009900;">&#41;</span>$<span style="color: #339933;">@</span><a href="http://perldoc.perl.org/functions/s.html"><span style="color: #000066;">s</span></a><span style="color: #339933;">;</span>
  <span style="color: #b1b100;">my</span> <span style="color: #0000ff;">$stamp</span> <span style="color: #339933;">=</span> <a href="http://perldoc.perl.org/functions/undef.html"><span style="color: #000066;">undef</span></a><span style="color: #339933;">;</span>
&#160;
  <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><a href="http://perldoc.perl.org/functions/defined.html"><span style="color: #000066;">defined</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$head</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
&#160;
    <span style="color: #666666; font-style: italic;"># it's best if the head and body are separated by a tab; but if we can't</span>
    <span style="color: #666666; font-style: italic;"># get that, try for it separated by spaces.</span>
<span style="color: #666666; font-style: italic;">#   if (m@^(&lt;[^&gt; \t\n]+&gt;) (.*)$@s) {</span>
    <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://perldoc.perl.org/functions/m.html"><span style="color: #000066;">m</span></a><span style="color: #339933;">@^</span><span style="color: #009900;">&#40;</span><span style="color: #339933;">&lt;</span><span style="color: #009900;">&#91;</span>\<span style="color: #339933;">@</span>\<span style="color: #339933;">+</span> <span style="color: #009900;">&#93;</span><span style="color: #339933;">?</span><span style="color: #009900;">&#91;</span><span style="color: #339933;">^&gt;</span> <span style="color: #0000ff;">\t</span><span style="color: #0000ff;">\n</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">+&gt;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">.*</span><span style="color: #009900;">&#41;</span>$<span style="color: #339933;">@</span><a href="http://perldoc.perl.org/functions/s.html"><span style="color: #000066;">s</span></a><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
      <span style="color: #0000ff;">$head</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">$1</span><span style="color: #339933;">;</span>
      <span style="color: #0000ff;">$body</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">$2</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">elsif</span> <span style="color: #009900;">&#40;</span><a href="http://perldoc.perl.org/functions/m.html"><span style="color: #000066;">m</span></a><span style="color: #339933;">@^</span><span style="color: #009900;">&#40;</span>\<span style="color: #339933;">*</span> <span style="color: #009900;">&#91;</span><span style="color: #339933;">^&gt;</span> <span style="color: #0000ff;">\t</span><span style="color: #0000ff;">\n</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">+</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">.*</span><span style="color: #009900;">&#41;</span>$<span style="color: #339933;">@</span><a href="http://perldoc.perl.org/functions/s.html"><span style="color: #000066;">s</span></a><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
      <span style="color: #0000ff;">$head</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">$1</span><span style="color: #339933;">;</span>
      <span style="color: #0000ff;">$body</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">$2</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">elsif</span> <span style="color: #009900;">&#40;</span><a href="http://perldoc.perl.org/functions/m.html"><span style="color: #000066;">m</span></a><span style="color: #339933;">@^</span><span style="color: #009900;">&#40;</span>\<span style="color: #009900;">&#91;</span> <span style="color: #339933;">*</span><span style="color: #009900;">&#91;</span><span style="color: #339933;">^</span>\<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">+</span>\<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">.*</span><span style="color: #009900;">&#41;</span>$<span style="color: #339933;">@</span><a href="http://perldoc.perl.org/functions/s.html"><span style="color: #000066;">s</span></a><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
      <span style="color: #0000ff;">$head</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">$1</span><span style="color: #339933;">;</span>
      <span style="color: #0000ff;">$body</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">$2</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">elsif</span> <span style="color: #009900;">&#40;</span><a href="http://perldoc.perl.org/functions/m.html"><span style="color: #000066;">m</span></a><span style="color: #339933;">@^</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#91;</span><span style="color: #339933;">^</span>\<span style="color: #009900;">&#91;</span>\<span style="color: #009900;">&#93;</span><span style="color: #339933;">&lt;&gt;</span> <span style="color: #0000ff;">\t</span><span style="color: #0000ff;">\n</span><span style="color: #339933;">:</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">+:</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">.*</span><span style="color: #009900;">&#41;</span>$<span style="color: #339933;">@</span><a href="http://perldoc.perl.org/functions/s.html"><span style="color: #000066;">s</span></a><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
      <span style="color: #0000ff;">$head</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">$1</span><span style="color: #339933;">;</span>
      <span style="color: #0000ff;">$body</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">$2</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">elsif</span> <span style="color: #009900;">&#40;</span><a href="http://perldoc.perl.org/functions/m.html"><span style="color: #000066;">m</span></a><span style="color: #339933;">@^</span><span style="color: #009900;">&#40;</span><span style="color: #339933;">&gt;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">.*</span><span style="color: #009900;">&#41;</span>$<span style="color: #339933;">@</span><a href="http://perldoc.perl.org/functions/s.html"><span style="color: #000066;">s</span></a><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
      <span style="color: #0000ff;">$head</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">$1</span><span style="color: #339933;">;</span>
      <span style="color: #0000ff;">$body</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">$2</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">elsif</span> <span style="color: #009900;">&#40;</span><a href="http://perldoc.perl.org/functions/m.html"><span style="color: #000066;">m</span></a><span style="color: #339933;">@^</span><span style="color: #009900;">&#40;</span>\<span style="color: #339933;">*+</span> <span style="color: #339933;">*</span><span style="color: #009900;">&#91;</span><span style="color: #339933;">^</span>\<span style="color: #009900;">&#91;</span>\<span style="color: #009900;">&#93;</span><span style="color: #339933;">&lt;&gt;</span> <span style="color: #0000ff;">\t</span><span style="color: #0000ff;">\n</span><span style="color: #339933;">:</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">+</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">.*</span><span style="color: #009900;">&#41;</span>$<span style="color: #339933;">@</span><a href="http://perldoc.perl.org/functions/s.html"><span style="color: #000066;">s</span></a><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
      <span style="color: #0000ff;">$head</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">$1</span><span style="color: #339933;">;</span>
      <span style="color: #0000ff;">$body</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">$2</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
      <span style="color: #0000ff;">$head</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">&quot;&quot;</span><span style="color: #339933;">;</span>
      <span style="color: #0000ff;">$body</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">$_</span><span style="color: #339933;">;</span>
      <a href="http://perldoc.perl.org/functions/print.html"><span style="color: #000066;">print</span></a> <span style="color: #000000; font-weight: bold;">STDERR</span> <span style="color: #ff0000;">&quot;$progname: unparsable line $input_lines: $_<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #b1b100;">if</span> <span style="color: #0000ff;">$verbose</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span>
  <span style="color: #009900;">&#125;</span>
&#160;
  <span style="color: #666666; font-style: italic;"># If there's a timestamp at the end of the line, put it in column 3.</span>
  <span style="color: #666666; font-style: italic;"># Otherwise, there is no column 3.</span>
  <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$body</span> <span style="color: #339933;">=~</span>
      <a href="http://perldoc.perl.org/functions/m.html"><span style="color: #000066;">m</span></a><span style="color: #339933;">@^</span><span style="color: #009900;">&#40;</span><span style="color: #339933;">.*?</span><span style="color: #009900;">&#41;</span>\<a href="http://perldoc.perl.org/functions/s.html"><span style="color: #000066;">s</span></a><span style="color: #339933;">*</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#123;</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">?</span>\<a href="http://perldoc.perl.org/functions/s.html"><span style="color: #000066;">s</span></a><span style="color: #339933;">*</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">\d</span><span style="color: #0000ff;">\d</span><span style="color: #339933;">?:</span><span style="color: #0000ff;">\d</span><span style="color: #0000ff;">\d</span><span style="color: #009900;">&#40;</span><span style="color: #339933;">:</span><span style="color: #0000ff;">\d</span><span style="color: #0000ff;">\d</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">?</span><span style="color: #009900;">&#40;</span> <span style="color: #339933;">?</span><span style="color: #009900;">&#91;</span>AP<span style="color: #009900;">&#93;</span>M<span style="color: #009900;">&#41;</span><span style="color: #339933;">?</span><span style="color: #009900;">&#41;</span>\<a href="http://perldoc.perl.org/functions/s.html"><span style="color: #000066;">s</span></a><span style="color: #339933;">*</span><span style="color: #009900;">&#91;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#125;</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">?</span>\<a href="http://perldoc.perl.org/functions/s.html"><span style="color: #000066;">s</span></a><span style="color: #339933;">*</span>$<span style="color: #0000ff;">@i</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    <span style="color: #0000ff;">$body</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">$1</span><span style="color: #339933;">;</span>
    <span style="color: #0000ff;">$stamp</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">$2</span><span style="color: #339933;">;</span>
&#160;
    <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$strip_timestamps</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
      <span style="color: #0000ff;">$stamp</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">''</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">elsif</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$strip_seconds</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
      <span style="color: #0000ff;">$stamp</span> <span style="color: #339933;">=~</span> <a href="http://perldoc.perl.org/functions/s.html"><span style="color: #000066;">s</span></a><span style="color: #339933;">@^</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">\d</span><span style="color: #339933;">?</span><span style="color: #0000ff;">\d</span><span style="color: #339933;">:</span><span style="color: #0000ff;">\d</span><span style="color: #0000ff;">\d</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">:</span><span style="color: #0000ff;">\d</span><span style="color: #0000ff;">\d</span><span style="color: #0000ff;">$@</span><span style="color: #0000ff;">$1</span><span style="color: #339933;">@;</span>
    <span style="color: #009900;">&#125;</span>
&#160;
    <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$stamp</span> <span style="color: #b1b100;">eq</span> <span style="color: #0000ff;">$prev_stamp</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
      <span style="color: #0000ff;">$stamp</span> <span style="color: #339933;">=</span> <a href="http://perldoc.perl.org/functions/undef.html"><span style="color: #000066;">undef</span></a><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
      <span style="color: #0000ff;">$prev_stamp</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">$stamp</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span>
  <span style="color: #009900;">&#125;</span>
&#160;
&#160;
  <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$strip_noise</span> <span style="color: #339933;">&amp;&amp;</span> <span style="color: #0000ff;">$head</span> <span style="color: #339933;">=~</span> <a href="http://perldoc.perl.org/functions/m.html"><span style="color: #000066;">m</span></a><span style="color: #339933;">@^</span><span style="color: #009900;">&#40;</span>\<span style="color: #009900;">&#91;</span><span style="color: #339933;">|</span>\<span style="color: #339933;">*</span>\<span style="color: #339933;">*</span>\<span style="color: #339933;">*</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">@</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    <a href="http://perldoc.perl.org/functions/print.html"><span style="color: #000066;">print</span></a> <span style="color: #000000; font-weight: bold;">STDERR</span> <span style="color: #ff0000;">&quot;$progname: deleting noise line $input_lines: $head<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span>
        <span style="color: #b1b100;">if</span> <span style="color: #0000ff;">$verbose</span><span style="color: #339933;">;</span>
    <a href="http://perldoc.perl.org/functions/return.html"><span style="color: #000066;">return</span></a> <span style="color: #ff0000;">&quot;&quot;</span><span style="color: #339933;">;</span>
  <span style="color: #009900;">&#125;</span>
&#160;
  <span style="color: #0000ff;">$head</span> <span style="color: #339933;">=</span> convert_line_body <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$head</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  <span style="color: #0000ff;">$body</span> <span style="color: #339933;">=</span> convert_line_body <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$body</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&#160;
  <span style="color: #b1b100;">my</span> <span style="color: #0000ff;">$continuation</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">1</span><span style="color: #339933;">;</span>
  <span style="color: #b1b100;">my</span> <span style="color: #0000ff;">$color_changed_p</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span>
&#160;
  <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$head</span> <span style="color: #b1b100;">ne</span> <span style="color: #0000ff;">$prev_head</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    <span style="color: #0000ff;">$prev_head</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">$head</span><span style="color: #339933;">;</span>
    <span style="color: #0000ff;">$continuation</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span>
    <span style="color: #0000ff;">$color_changed_p</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">1</span><span style="color: #339933;">;</span>
    <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$bg_color</span> <span style="color: #b1b100;">eq</span> <span style="color: #0000ff;">$bg_color1</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
      <span style="color: #0000ff;">$bg_color</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">$bg_color2</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
      <span style="color: #0000ff;">$bg_color</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">$bg_color1</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span>
  <span style="color: #009900;">&#125;</span>
&#160;
  <span style="color: #0000ff;">$head</span> <span style="color: #339933;">.=</span> <span style="color: #ff0000;">&quot;&amp;nbsp;&quot;</span><span style="color: #339933;">;</span>
&#160;
  <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$head</span> <span style="color: #339933;">=~</span> <a href="http://perldoc.perl.org/functions/m.html"><span style="color: #000066;">m</span></a><span style="color: #339933;">@^</span><span style="color: #009900;">&#40;</span>\<span style="color: #009900;">&#91;</span><span style="color: #339933;">|</span>\<span style="color: #339933;">*</span>\<span style="color: #339933;">*</span>\<span style="color: #339933;">*</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">@</span> <span style="color: #339933;">||</span>
      <span style="color: #0000ff;">$head</span> <span style="color: #339933;">=~</span> <a href="http://perldoc.perl.org/functions/m.html"><span style="color: #000066;">m</span></a><span style="color: #339933;">@</span>\<span style="color: #009900;">&#40;</span>\<a href="http://perldoc.perl.org/functions/s.html"><span style="color: #000066;">s</span></a><span style="color: #339933;">*</span><span style="color: #0000ff;">\d</span><span style="color: #0000ff;">\d</span><span style="color: #0000ff;">\d</span><span style="color: #339933;">+</span>\<a href="http://perldoc.perl.org/functions/s.html"><span style="color: #000066;">s</span></a><span style="color: #339933;">*</span>\<span style="color: #009900;">&#41;</span><span style="color: #339933;">@</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    <span style="color: #0000ff;">$head</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">&quot;''$head''&quot;</span><span style="color: #339933;">;</span>
    <span style="color: #0000ff;">$body</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">&quot;''$body''&quot;</span><span style="color: #339933;">;</span>
&#160;
  <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">elsif</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$continuation</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    <span style="color: #0000ff;">$head</span> <span style="color: #339933;">=</span> <span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
    <span style="color: #0000ff;">$head</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">&quot;'''$head'''&quot;</span><span style="color: #339933;">;</span>
  <span style="color: #009900;">&#125;</span>
&#160;
  <span style="color: #666666; font-style: italic;"># Specify the foreground color in the table cells too, in case this</span>
  <span style="color: #666666; font-style: italic;"># html gets pasted somwehere with conflicting document colors.</span>
  <span style="color: #666666; font-style: italic;">#</span>
  <span style="color: #b1b100;">my</span> <span style="color: #0000ff;">$color_style</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">''</span><span style="color: #339933;">;</span>
&#160;
  <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$separators_p</span> <span style="color: #339933;">&amp;&amp;</span> <span style="color: #0000ff;">$color_changed_p</span> <span style="color: #339933;">&amp;&amp;</span> <span style="color: #0000ff;">$output_lines</span> <span style="color: #339933;">!=</span> <span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    <span style="color: #0000ff;">$color_style</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">$margin_style</span><span style="color: #339933;">;</span>
  <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">elsif</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$colorize_p</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    <span style="color: #0000ff;">$color_style</span> <span style="color: #339933;">=</span> <span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot; STYLE=<span style="color: #000099; font-weight: bold;">\&quot;</span>color:$fg_color&quot;</span> <span style="color: #339933;">.</span> 
                    <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$bg_color</span> <span style="color: #b1b100;">eq</span> <span style="color: #0000ff;">$bg_color1</span> 
                     <span style="color: #339933;">?</span> <span style="color: #ff0000;">''</span>
                     <span style="color: #339933;">:</span> <span style="color: #ff0000;">&quot;; background:$bg_color&quot;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">.</span>
                    <span style="color: #ff0000;">&quot;<span style="color: #000099; font-weight: bold;">\&quot;</span>&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  <span style="color: #009900;">&#125;</span>
&#160;
  <span style="color: #b1b100;">my</span> <span style="color: #0000ff;">$result</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">&quot;|-<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">.</span>
               <span style="color: #ff0000;">&quot;| $head<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">.</span>
               <span style="color: #ff0000;">&quot;| $body<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
&#160;
  <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$stamp</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    <span style="color: #0000ff;">$result</span> <span style="color: #339933;">.=</span> <span style="color: #ff0000;">&quot;| $stamp<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
  <span style="color: #009900;">&#125;</span>
&#160;
&#160;
  <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$line_tick</span><span style="color: #339933;">++</span> <span style="color: #339933;">&gt;</span> <span style="color: #0000ff;">$chunk_size</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    <span style="color: #0000ff;">$line_tick</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span>
&#160;
    <span style="color: #0000ff;">$color_style</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">''</span><span style="color: #339933;">;</span>
    <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$bg_color</span> <span style="color: #b1b100;">ne</span> <span style="color: #0000ff;">$bg_color1</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
      <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$separators_p</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
        <span style="color: #0000ff;">$color_style</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">$margin_style</span><span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">elsif</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$colorize_p</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
          <span style="color: #0000ff;">$color_style</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">&quot; STYLE=<span style="color: #000099; font-weight: bold;">\&quot;</span>background:$bg_color1<span style="color: #000099; font-weight: bold;">\&quot;</span>&quot;</span><span style="color: #339933;">;</span>
        <span style="color: #009900;">&#125;</span>
    <span style="color: #009900;">&#125;</span>
  <span style="color: #009900;">&#125;</span>
&#160;
  <span style="color: #0000ff;">$result</span> <span style="color: #339933;">=~</span> <a href="http://perldoc.perl.org/functions/s.html"><span style="color: #000066;">s</span></a><span style="color: #339933;">@&lt;</span>TD VALIGN<span style="color: #339933;">=</span>TOP NOWRAP<span style="color: #339933;">&gt;&lt;/</span>TD<span style="color: #339933;">&gt;@</span><span style="color: #009999;">&lt;TD&gt;</span><span style="color: #339933;">&lt;/</span>TD<span style="color: #339933;">&gt;</span><span style="color: #0000ff;">@g</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;"># simplify...</span>
  <span style="color: #0000ff;">$result</span> <span style="color: #339933;">=~</span> <a href="http://perldoc.perl.org/functions/s.html"><span style="color: #000066;">s</span></a><span style="color: #339933;">@</span> NOWRAP<span style="color: #009900;">&#40;</span><span style="color: #339933;">&gt;</span><span style="color: #009900;">&#91;</span><span style="color: #339933;">^</span>\<a href="http://perldoc.perl.org/functions/s.html"><span style="color: #000066;">s</span></a><span style="color: #009900;">&#93;</span><span style="color: #339933;">+?&lt;/</span>TD<span style="color: #339933;">&gt;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">@</span><span style="color: #0000ff;">$1</span><span style="color: #0000ff;">@g</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;"># if no spaces, don't need nowrap</span>
&#160;
  <span style="color: #0000ff;">$output_lines</span><span style="color: #339933;">++;</span>
&#160;
  <a href="http://perldoc.perl.org/functions/return.html"><span style="color: #000066;">return</span></a> <span style="color: #0000ff;">$result</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span>
&#160;
<span style="color: #000000; font-weight: bold;">sub</span> convert_color<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$)</span> <span style="color: #009900;">&#123;</span>
  <span style="color: #b1b100;">my</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$str</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">@_</span><span style="color: #339933;">;</span>
&#160;
  <span style="color: #0000ff;">$str</span> <span style="color: #339933;">=~</span> <span style="color: #009966; font-style: italic;">s/\e\[.*?[a-zA-Z]//g</span><span style="color: #339933;">;</span>
&#160;
  <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$str</span> <span style="color: #339933;">=~</span> <span style="color: #009966; font-style: italic;">/(&lt;BR&gt;)/i</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    <span style="color: #0000ff;">$str</span> <span style="color: #339933;">=~</span> <a href="http://perldoc.perl.org/functions/s.html"><span style="color: #000066;">s</span></a><span style="color: #339933;">//</span><span style="color: #0000ff;">\cO</span><span style="color: #0000ff;">$1</span><span style="color: #339933;">/</span>g<span style="color: #339933;">;</span>
  <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
    <span style="color: #0000ff;">$str</span> <span style="color: #339933;">.=</span> <span style="color: #ff0000;">&quot;<span style="color: #000099; font-weight: bold;">\c</span>O&quot;</span><span style="color: #339933;">;</span>
  <span style="color: #009900;">&#125;</span>
&#160;
  <span style="color: #0000ff;">$str</span> <span style="color: #339933;">=~</span> <span style="color: #009966; font-style: italic;">s/\cV(.*?)\cV/\cC0,1$1\cO/g</span><span style="color: #339933;">;</span>
  <span style="color: #0000ff;">$str</span> <span style="color: #339933;">=~</span> <span style="color: #009966; font-style: italic;">s/\cV/\cC0,1/</span><span style="color: #339933;">;</span>
&#160;
  <span style="color: #b1b100;">my</span> <span style="color: #0000ff;">@chars</span> <span style="color: #339933;">=</span> <span style="color: #009900;">&#40;</span><a href="http://perldoc.perl.org/functions/split.html"><span style="color: #000066;">split</span></a><span style="color: #009900;">&#40;</span><span style="color: #339933;">//,</span> <span style="color: #0000ff;">$str</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  <span style="color: #b1b100;">my</span> <span style="color: #0000ff;">$ret</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">''</span><span style="color: #339933;">;</span>
  <span style="color: #b1b100;">my</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$CCfc</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">$CCbc</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">$CCnc</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  <span style="color: #b1b100;">my</span> <span style="color: #0000ff;">$CCb</span>  <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span>
  <span style="color: #b1b100;">my</span> <span style="color: #0000ff;">$CCu</span>  <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span>
  <span style="color: #b1b100;">while</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">@chars</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    <span style="color: #b1b100;">my</span> <span style="color: #0000ff;">$char</span> <span style="color: #339933;">=</span> <a href="http://perldoc.perl.org/functions/shift.html"><span style="color: #000066;">shift</span></a> <span style="color: #0000ff;">@chars</span><span style="color: #339933;">;</span>
    <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$char</span> <span style="color: #b1b100;">eq</span> <span style="color: #ff0000;">&quot;<span style="color: #000099; font-weight: bold;">\c</span>B&quot;</span><span style="color: #009900;">&#41;</span>    <span style="color: #009900;">&#123;</span> <span style="color: #0000ff;">$ret</span> <span style="color: #339933;">.=</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$CCb</span> <span style="color: #339933;">?</span> <span style="color: #ff0000;">'&lt;/b&gt;'</span> <span style="color: #339933;">:</span> <span style="color: #ff0000;">'&lt;b&gt;'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #0000ff;">$CCb</span> <span style="color: #339933;">=</span> <span style="color: #339933;">!</span><span style="color: #0000ff;">$CCb</span><span style="color: #339933;">;</span> <span style="color: #009900;">&#125;</span>
    <span style="color: #b1b100;">elsif</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$char</span> <span style="color: #b1b100;">eq</span> <span style="color: #ff0000;">&quot;<span style="color: #000099; font-weight: bold;">\c</span>_&quot;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> <span style="color: #0000ff;">$ret</span> <span style="color: #339933;">.=</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$CCu</span> <span style="color: #339933;">?</span> <span style="color: #ff0000;">'&lt;/u&gt;'</span> <span style="color: #339933;">:</span> <span style="color: #ff0000;">'&lt;u&gt;'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #0000ff;">$CCu</span> <span style="color: #339933;">=</span> <span style="color: #339933;">!</span><span style="color: #0000ff;">$CCu</span><span style="color: #339933;">;</span> <span style="color: #009900;">&#125;</span>
    <span style="color: #b1b100;">elsif</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$char</span> <span style="color: #b1b100;">eq</span> <span style="color: #ff0000;">&quot;<span style="color: #000099; font-weight: bold;">\c</span>O&quot;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
      <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$CCb</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> <span style="color: #0000ff;">$CCb</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> <span style="color: #0000ff;">$ret</span> <span style="color: #339933;">.=</span> <span style="color: #ff0000;">'&lt;/b&gt;'</span><span style="color: #339933;">;</span> <span style="color: #009900;">&#125;</span>
      <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$CCu</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> <span style="color: #0000ff;">$CCu</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> <span style="color: #0000ff;">$ret</span> <span style="color: #339933;">.=</span> <span style="color: #ff0000;">'&lt;/u&gt;'</span><span style="color: #339933;">;</span> <span style="color: #009900;">&#125;</span>
      <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$CCnc</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
        <span style="color: #0000ff;">$CCbc</span><span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> <span style="color: #0000ff;">$ret</span> <span style="color: #339933;">.=</span> <span style="color: #ff0000;">'&lt;/SPAN&gt;'</span> x <span style="color: #0000ff;">$CCnc</span><span style="color: #339933;">;</span>
        <span style="color: #0000ff;">$CCfc</span><span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> <span style="color: #0000ff;">$CCnc</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> <span style="color: #009900;">&#125;</span>
    <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">elsif</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$char</span> <span style="color: #b1b100;">eq</span> <span style="color: #ff0000;">&quot;<span style="color: #000099; font-weight: bold;">\c</span>C&quot;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
      <span style="color: #b1b100;">my</span> <span style="color: #0000ff;">$CCcs</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">''</span><span style="color: #339933;">;</span>
      <span style="color: #b1b100;">while</span> <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$char</span> <span style="color: #339933;">=</span> <a href="http://perldoc.perl.org/functions/shift.html"><span style="color: #000066;">shift</span></a> <span style="color: #0000ff;">@chars</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">=~</span> <span style="color: #009966; font-style: italic;">/[\d,]/</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
        <span style="color: #0000ff;">$CCcs</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">$char</span><span style="color: #339933;">;</span>
      <span style="color: #009900;">&#125;</span>
&#160;
      <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$char</span> <span style="color: #339933;">=~</span> <span style="color: #009966; font-style: italic;">/[^\d,]/</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
        <a href="http://perldoc.perl.org/functions/unshift.html"><span style="color: #000066;">unshift</span></a> <span style="color: #0000ff;">@chars</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">$char</span><span style="color: #339933;">;</span>
      <span style="color: #009900;">&#125;</span>
&#160;
      <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$CCcs</span> <span style="color: #b1b100;">eq</span> <span style="color: #ff0000;">''</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$CCbc</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> <span style="color: #0000ff;">$ret</span> <span style="color: #339933;">.=</span> <span style="color: #ff0000;">'&lt;/SPAN&gt;'</span><span style="color: #339933;">;</span> <span style="color: #0000ff;">$CCnc</span><span style="color: #339933;">--;</span> <span style="color: #009900;">&#125;</span>
        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$CCfc</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> <span style="color: #0000ff;">$ret</span> <span style="color: #339933;">.=</span> <span style="color: #ff0000;">'&lt;/SPAN&gt;'</span><span style="color: #339933;">;</span> <span style="color: #0000ff;">$CCnc</span><span style="color: #339933;">--;</span> <span style="color: #009900;">&#125;</span>
        <span style="color: #0000ff;">$CCbc</span> <span style="color: #339933;">=</span> <a href="http://perldoc.perl.org/functions/undef.html"><span style="color: #000066;">undef</span></a><span style="color: #339933;">;</span> <span style="color: #0000ff;">$CCfc</span> <span style="color: #339933;">=</span> <a href="http://perldoc.perl.org/functions/undef.html"><span style="color: #000066;">undef</span></a><span style="color: #339933;">;</span>
      <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
        <span style="color: #b1b100;">my</span> <span style="color: #0000ff;">@k</span> <span style="color: #339933;">=</span> <a href="http://perldoc.perl.org/functions/split.html"><span style="color: #000066;">split</span></a> <span style="color: #009966; font-style: italic;">/,/</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">$CCcs</span><span style="color: #339933;">;</span>
        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://perldoc.perl.org/functions/defined.html"><span style="color: #000066;">defined</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$k</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">&amp;&amp;</span> <span style="color: #0000ff;">$k</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span> <span style="color: #b1b100;">ne</span> <span style="color: #ff0000;">''</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
          <span style="color: #0000ff;">$CCfc</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">$k</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
          <span style="color: #0000ff;">$ret</span> <span style="color: #339933;">.=</span> <span style="color: #ff0000;">&quot;&lt;SPAN CLASS=fc$CCfc&gt;&quot;</span><span style="color: #339933;">;</span>
          <span style="color: #0000ff;">$any_styles</span><span style="color: #339933;">++;</span>
          <span style="color: #0000ff;">$CCnc</span><span style="color: #339933;">++;</span>
        <span style="color: #009900;">&#125;</span>
&#160;
        <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://perldoc.perl.org/functions/defined.html"><span style="color: #000066;">defined</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$k</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">&amp;&amp;</span> <span style="color: #0000ff;">$k</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span> <span style="color: #b1b100;">ne</span> <span style="color: #ff0000;">''</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
          <span style="color: #0000ff;">$CCbc</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">$k</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
          <span style="color: #0000ff;">$ret</span> <span style="color: #339933;">.=</span> <span style="color: #ff0000;">&quot;&lt;SPAN CLASS=bc$CCbc&gt;&quot;</span><span style="color: #339933;">;</span>
          <span style="color: #0000ff;">$any_styles</span><span style="color: #339933;">++;</span>
          <span style="color: #0000ff;">$CCnc</span><span style="color: #339933;">++;</span>
        <span style="color: #009900;">&#125;</span>
      <span style="color: #009900;">&#125;</span>
    <span style="color: #009900;">&#125;</span>
    <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
      <span style="color: #0000ff;">$ret</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">$char</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span>
  <span style="color: #009900;">&#125;</span>
  <a href="http://perldoc.perl.org/functions/return.html"><span style="color: #000066;">return</span></a> <span style="color: #0000ff;">$ret</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span>
&#160;
&#160;
<span style="color: #b1b100;">my</span> <span style="color: #0000ff;">$buffered_line</span> <span style="color: #339933;">=</span> <a href="http://perldoc.perl.org/functions/undef.html"><span style="color: #000066;">undef</span></a><span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">sub</span> convert<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$)</span> <span style="color: #009900;">&#123;</span>
  <span style="color: #b1b100;">my</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$line</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">@_</span><span style="color: #339933;">;</span>
&#160;
  <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$line</span> <span style="color: #339933;">=~</span> <span style="color: #009966; font-style: italic;">m/^[A-Za-z]/</span> <span style="color: #339933;">&amp;&amp;</span>
      <span style="color: #0000ff;">$line</span> <span style="color: #339933;">!~</span> <span style="color: #009966; font-style: italic;">m/^[^ \t\r\n:]+: /</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    <span style="color: #0000ff;">$buffered_line</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">''</span> <span style="color: #b1b100;">unless</span> <a href="http://perldoc.perl.org/functions/defined.html"><span style="color: #000066;">defined</span></a> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$buffered_line</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    <span style="color: #0000ff;">$buffered_line</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">$line</span><span style="color: #339933;">;</span>
    <a href="http://perldoc.perl.org/functions/return.html"><span style="color: #000066;">return</span></a> <span style="color: #ff0000;">&quot;&quot;</span><span style="color: #339933;">;</span>
  <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
    <span style="color: #b1b100;">my</span> <span style="color: #0000ff;">$ret</span> <span style="color: #339933;">=</span> <span style="color: #009900;">&#40;</span><a href="http://perldoc.perl.org/functions/defined.html"><span style="color: #000066;">defined</span></a> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$buffered_line</span><span style="color: #009900;">&#41;</span>
               <span style="color: #339933;">?</span> convert_line <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$buffered_line</span><span style="color: #009900;">&#41;</span>
               <span style="color: #339933;">:</span> <span style="color: #ff0000;">&quot;&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    <span style="color: #0000ff;">$buffered_line</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">$line</span><span style="color: #339933;">;</span>
    <a href="http://perldoc.perl.org/functions/return.html"><span style="color: #000066;">return</span></a> <span style="color: #0000ff;">$ret</span><span style="color: #339933;">;</span>
  <span style="color: #009900;">&#125;</span>
<span style="color: #009900;">&#125;</span>
&#160;
&#160;
<span style="color: #666666; font-style: italic;"># convert everything in the given string.</span>
<span style="color: #000000; font-weight: bold;">sub</span> convert_body<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$)</span> <span style="color: #009900;">&#123;</span>
  <span style="color: #b1b100;">my</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$body</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">@_</span><span style="color: #339933;">;</span>
&#160;
  <span style="color: #b1b100;">my</span> <span style="color: #0000ff;">$color_style</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">''</span><span style="color: #339933;">;</span>
  <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$colorize_p</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    <span style="color: #0000ff;">$color_style</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">&quot; STYLE=<span style="color: #000099; font-weight: bold;">\&quot;</span>background:$bg_color<span style="color: #000099; font-weight: bold;">\&quot;</span>&quot;</span><span style="color: #339933;">;</span>
  <span style="color: #009900;">&#125;</span>
  <span style="color: #b1b100;">my</span> <span style="color: #0000ff;">$output</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">&quot;{|border=<span style="color: #000099; font-weight: bold;">\&quot;</span>0<span style="color: #000099; font-weight: bold;">\&quot;</span> cellpadding=<span style="color: #000099; font-weight: bold;">\&quot;</span>5<span style="color: #000099; font-weight: bold;">\&quot;</span> cellspacing=<span style="color: #000099; font-weight: bold;">\&quot;</span>0<span style="color: #000099; font-weight: bold;">\&quot;</span> align=<span style="color: #000099; font-weight: bold;">\&quot;</span>center<span style="color: #000099; font-weight: bold;">\&quot;</span><span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
&#160;
  <span style="color: #0000ff;">$input_lines</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span>
  <span style="color: #b1b100;">foreach</span> <span style="color: #009900;">&#40;</span><a href="http://perldoc.perl.org/functions/split.html"><span style="color: #000066;">split</span></a> <span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">$body</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    <span style="color: #0000ff;">$input_lines</span><span style="color: #339933;">++;</span>
    <span style="color: #0000ff;">$output</span> <span style="color: #339933;">.=</span> convert <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$_</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  <span style="color: #009900;">&#125;</span>
  <span style="color: #0000ff;">$output</span> <span style="color: #339933;">.=</span> convert <span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  <span style="color: #0000ff;">$output</span> <span style="color: #339933;">.=</span> <span style="color: #ff0000;">&quot;|-<span style="color: #000099; font-weight: bold;">\n</span>|}&quot;</span><span style="color: #339933;">;</span>
&#160;
  <span style="color: #b1b100;">my</span> <span style="color: #0000ff;">$ss</span> <span style="color: #339933;">=</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$any_styles</span> <span style="color: #339933;">?</span> <span style="color: #0000ff;">$stylesheet</span> <span style="color: #339933;">:</span> <span style="color: #ff0000;">&quot;&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  <span style="color: #0000ff;">$_</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">$doc_head</span><span style="color: #339933;">;</span>
  <span style="color: #009966; font-style: italic;">s/%%STYLESHEET%%/$ss/</span><span style="color: #339933;">;</span>
  <span style="color: #0000ff;">$output</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">$_</span> <span style="color: #339933;">.</span> <span style="color: #0000ff;">$output</span><span style="color: #339933;">;</span>
  <a href="http://perldoc.perl.org/functions/return.html"><span style="color: #000066;">return</span></a> <span style="color: #0000ff;">$output</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span>
&#160;
&#160;
<span style="color: #666666; font-style: italic;"># This is the main loop when we seem to have been invoked as a CGI script.</span>
<span style="color: #666666; font-style: italic;">#</span>
<span style="color: #000000; font-weight: bold;">sub</span> do_cgi<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
  error <span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">400</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">&quot;malformed URL&quot;</span><span style="color: #009900;">&#41;</span> <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$ENV</span><span style="color: #009900;">&#123;</span>PATH_INFO<span style="color: #009900;">&#125;</span> <span style="color: #339933;">||</span> <span style="color: #0000ff;">$ENV</span><span style="color: #009900;">&#123;</span>QUERY_STRING<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&#160;
  <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$ENV</span><span style="color: #009900;">&#123;</span>REQUEST_METHOD<span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">eq</span> <span style="color: #ff0000;">'GET'</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    <span style="color: #666666; font-style: italic;">#</span>
    <span style="color: #666666; font-style: italic;"># GET means this is the top-level invocation: just display the HTML</span>
    <span style="color: #666666; font-style: italic;"># for the form in which the user can paste an IRC log.</span>
    <span style="color: #666666; font-style: italic;">#</span>
    <a href="http://perldoc.perl.org/functions/print.html"><span style="color: #000066;">print</span></a> <span style="color: #000000; font-weight: bold;">STDOUT</span> <span style="color: #ff0000;">&quot;Content-Type: text/html<span style="color: #000099; font-weight: bold;">\n</span><span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
&#160;
    <a href="http://perldoc.perl.org/functions/print.html"><span style="color: #000066;">print</span></a> <span style="color: #000000; font-weight: bold;">STDOUT</span>
     <span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;&lt;HTML&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">.</span>
      <span style="color: #ff0000;">&quot; &lt;HEAD&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">.</span>
      <span style="color: #ff0000;">&quot;  &lt;TITLE&gt;$progname&lt;/TITLE&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">.</span>
      <span style="color: #ff0000;">&quot; &lt;/HEAD&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">.</span>
      <span style="color: #ff0000;">&quot; &lt;BODY&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">.</span>
      <span style="color: #ff0000;">&quot;  &lt;FORM METHOD=POST&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">.</span>
      <span style="color: #ff0000;">&quot;   &lt;TABLE&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">.</span>
      <span style="color: #ff0000;">&quot;    &lt;TR&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">.</span>
      <span style="color: #ff0000;">&quot;     &lt;TD COLSPAN=2 VALIGN=TOP ALIGN=CENTER&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">.</span>
      <span style="color: #ff0000;">&quot;      &lt;DIV ALIGN=CENTER&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">.</span>
      <span style="color: #ff0000;">&quot;       &lt;B&gt;&lt;SPAN STYLE='font-size:larger'&gt;Chat log to HTML Converter&lt;BR&gt;&lt;/SPAN&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">.</span>
      <span style="color: #ff0000;">&quot;        by &lt;A HREF=<span style="color: #000099; font-weight: bold;">\&quot;</span>http://www.jwz.org/<span style="color: #000099; font-weight: bold;">\&quot;</span>&gt;&quot;</span> <span style="color: #339933;">.</span>
               <span style="color: #ff0000;">&quot;Jamie Zawinski&lt;/A&gt;&lt;BR&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">.</span>
      <span style="color: #ff0000;">&quot;        Version &lt;A HREF=<span style="color: #000099; font-weight: bold;">\&quot;</span>http://www.jwz.org/hacks/irc2html.pl<span style="color: #000099; font-weight: bold;">\&quot;</span>&gt;&quot;</span> <span style="color: #339933;">.</span>
      <span style="color: #ff0000;">&quot;$version&lt;/A&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">.</span>
      <span style="color: #ff0000;">&quot;      &lt;/SPAN&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">.</span>
      <span style="color: #ff0000;">&quot;      Paste your IRC/AIM log here:&lt;/B&gt;&lt;BR&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">.</span>
      <span style="color: #ff0000;">&quot;      &lt;TEXTAREA NAME=<span style="color: #000099; font-weight: bold;">\&quot;</span>body<span style="color: #000099; font-weight: bold;">\&quot;</span> ROWS=10 COLS=60 WRAP=OFF&gt;&lt;/TEXTAREA&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">.</span>
      <span style="color: #ff0000;">&quot;     &lt;/TD&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">.</span>
      <span style="color: #ff0000;">&quot;    &lt;/TR&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">.</span>
      <span style="color: #ff0000;">&quot;    &lt;TR&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">.</span>
      <span style="color: #ff0000;">&quot;     &lt;TD VALIGN=TOP ALIGN=LEFT NOWRAP&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">.</span>
      <span style="color: #ff0000;">&quot;      &lt;INPUT NAME=<span style="color: #000099; font-weight: bold;">\&quot;</span>strip_status<span style="color: #000099; font-weight: bold;">\&quot;</span> TYPE=CHECKBOX&gt;&quot;</span> <span style="color: #339933;">.</span>
             <span style="color: #ff0000;">&quot; Strip Status Lines&lt;BR&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">.</span>
      <span style="color: #ff0000;">&quot;      &lt;INPUT NAME=<span style="color: #000099; font-weight: bold;">\&quot;</span>strip_timestamps<span style="color: #000099; font-weight: bold;">\&quot;</span> TYPE=CHECKBOX&gt;&quot;</span> <span style="color: #339933;">.</span>
             <span style="color: #ff0000;">&quot; Strip Timestamps&lt;BR&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">.</span>
      <span style="color: #ff0000;">&quot;      &lt;INPUT NAME=<span style="color: #000099; font-weight: bold;">\&quot;</span>colorize<span style="color: #000099; font-weight: bold;">\&quot;</span> TYPE=CHECKBOX CHECKED&gt; Colorize<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">.</span>
      <span style="color: #ff0000;">&quot;     &lt;/TD&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">.</span>
      <span style="color: #ff0000;">&quot;     &lt;TD VALIGN=MIDDLE ALIGN=RIGHT NOWRAP&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">.</span>
      <span style="color: #ff0000;">&quot;      &lt;INPUT TYPE=SUBMIT VALUE=<span style="color: #000099; font-weight: bold;">\&quot;</span>Generate HTML<span style="color: #000099; font-weight: bold;">\&quot;</span>&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">.</span>
      <span style="color: #ff0000;">&quot;      &amp;nbsp; &amp;nbsp; &amp;nbsp; <span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">.</span>
      <span style="color: #ff0000;">&quot;      &lt;INPUT TYPE=RESET VALUE=<span style="color: #000099; font-weight: bold;">\&quot;</span>Clear<span style="color: #000099; font-weight: bold;">\&quot;</span>&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">.</span>
      <span style="color: #ff0000;">&quot;     &lt;/TD&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">.</span>
      <span style="color: #ff0000;">&quot;    &lt;/TR&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">.</span>
      <span style="color: #ff0000;">&quot;   &lt;/TABLE&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">.</span>
      <span style="color: #ff0000;">&quot;  &lt;/FORM&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">.</span>
      <span style="color: #ff0000;">&quot; &lt;/BODY&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">.</span>
      <span style="color: #ff0000;">&quot;&lt;/HTML&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&#160;
  <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">elsif</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$ENV</span><span style="color: #009900;">&#123;</span>REQUEST_METHOD<span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">eq</span> <span style="color: #ff0000;">'POST'</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    <span style="color: #666666; font-style: italic;">#</span>
    <span style="color: #666666; font-style: italic;"># POST means that the form has been submitted; read the log text and</span>
    <span style="color: #666666; font-style: italic;"># print out the corresponding HTML.</span>
    <span style="color: #666666; font-style: italic;">#</span>
    <span style="color: #b1b100;">my</span> <span style="color: #0000ff;">$args</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">''</span><span style="color: #339933;">;</span>
    <span style="color: #b1b100;">while</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">&lt;&gt;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> <span style="color: #0000ff;">$args</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">$_</span><span style="color: #339933;">;</span> <span style="color: #009900;">&#125;</span>
&#160;
    <span style="color: #0000ff;">$colorize_p</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span>   <span style="color: #666666; font-style: italic;"># for cgi, must default to 0</span>
&#160;
    <span style="color: #b1b100;">my</span> <span style="color: #0000ff;">$body</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">''</span><span style="color: #339933;">;</span>
    <span style="color: #b1b100;">foreach</span> <span style="color: #009900;">&#40;</span><a href="http://perldoc.perl.org/functions/split.html"><span style="color: #000066;">split</span></a> <span style="color: #009900;">&#40;</span><span style="color: #ff0000;">'&amp;'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">$args</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
      <span style="color: #b1b100;">my</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$key</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">$val</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">=</span> <span style="color: #009966; font-style: italic;">m/^(.*?)=(.*)$/s</span><span style="color: #339933;">;</span>
      <span style="color: #b1b100;">if</span>    <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$key</span> <span style="color: #b1b100;">eq</span> <span style="color: #ff0000;">'body'</span><span style="color: #009900;">&#41;</span>  <span style="color: #009900;">&#123;</span> <span style="color: #0000ff;">$body</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">$val</span><span style="color: #339933;">;</span> <span style="color: #009900;">&#125;</span>
      <span style="color: #b1b100;">elsif</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$key</span> <span style="color: #b1b100;">eq</span> <span style="color: #ff0000;">'strip_status'</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> <span style="color: #0000ff;">$strip_noise</span> <span style="color: #339933;">=</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$val</span> <span style="color: #b1b100;">eq</span> <span style="color: #ff0000;">'on'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #009900;">&#125;</span>
      <span style="color: #b1b100;">elsif</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$key</span> <span style="color: #b1b100;">eq</span> <span style="color: #ff0000;">'strip_timestamps'</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> <span style="color: #0000ff;">$strip_timestamps</span> <span style="color: #339933;">=</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$val</span> <span style="color: #b1b100;">eq</span> <span style="color: #ff0000;">'on'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><span style="color: #009900;">&#125;</span>
      <span style="color: #b1b100;">elsif</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$key</span> <span style="color: #b1b100;">eq</span> <span style="color: #ff0000;">'colorize'</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> <span style="color: #0000ff;">$colorize_p</span> <span style="color: #339933;">=</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$val</span> <span style="color: #b1b100;">eq</span> <span style="color: #ff0000;">'on'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #009900;">&#125;</span>
      <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span> error <span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">400</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">&quot;unknown option $key&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #009900;">&#125;</span>
    <span style="color: #009900;">&#125;</span>
&#160;
    <span style="color: #0000ff;">$separators_p</span> <span style="color: #339933;">=</span> <span style="color: #339933;">!</span><span style="color: #0000ff;">$colorize_p</span><span style="color: #339933;">;</span>
<span style="color: #666666; font-style: italic;">#    $colorize_p = 1;####</span>
&#160;
    <span style="color: #0000ff;">$body</span> <span style="color: #339933;">=~</span> <span style="color: #009966; font-style: italic;">s/\+/ /g</span><span style="color: #339933;">;</span>                           <span style="color: #666666; font-style: italic;"># spaces are encoded</span>
    <span style="color: #0000ff;">$body</span> <span style="color: #339933;">=~</span> <span style="color: #009966; font-style: italic;">s/%([\dA-F]{2})/chr(hex($1))/gexi</span><span style="color: #339933;">;</span>  <span style="color: #666666; font-style: italic;"># de-hexilate</span>
    <span style="color: #0000ff;">$body</span> <span style="color: #339933;">=~</span> <a href="http://perldoc.perl.org/functions/s.html"><span style="color: #000066;">s</span></a><span style="color: #339933;">@</span><span style="color: #0000ff;">\r</span><span style="color: #0000ff;">\n</span><span style="color: #339933;">@</span><span style="color: #0000ff;">\n</span><span style="color: #0000ff;">@sg</span><span style="color: #339933;">;</span>                       <span style="color: #666666; font-style: italic;"># CRLF -&gt; LF</span>
    <span style="color: #0000ff;">$body</span> <span style="color: #339933;">=~</span> <a href="http://perldoc.perl.org/functions/s.html"><span style="color: #000066;">s</span></a><span style="color: #339933;">@</span><span style="color: #0000ff;">\r</span><span style="color: #339933;">@</span><span style="color: #0000ff;">\n</span><span style="color: #0000ff;">@sg</span><span style="color: #339933;">;</span>                         <span style="color: #666666; font-style: italic;"># CR -&gt; LF</span>
&#160;
    <a href="http://perldoc.perl.org/functions/print.html"><span style="color: #000066;">print</span></a> <span style="color: #000000; font-weight: bold;">STDOUT</span> <span style="color: #ff0000;">&quot;Content-Type: text/html<span style="color: #000099; font-weight: bold;">\n</span><span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
    <a href="http://perldoc.perl.org/functions/print.html"><span style="color: #000066;">print</span></a> <span style="color: #000000; font-weight: bold;">STDOUT</span> convert_body <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$body</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
    error <span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">400</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">&quot;$ENV{REQUEST_METHOD} not supported&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  <span style="color: #009900;">&#125;</span>
<span style="color: #009900;">&#125;</span>
&#160;
<span style="color: #000000; font-weight: bold;">sub</span> error<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$$</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
  <span style="color: #b1b100;">my</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$http_status</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">$err</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">@_</span><span style="color: #339933;">;</span>
&#160;
  <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://perldoc.perl.org/functions/defined.html"><span style="color: #000066;">defined</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$ENV</span><span style="color: #009900;">&#123;</span>REQUEST_URI<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    <a href="http://perldoc.perl.org/functions/print.html"><span style="color: #000066;">print</span></a> <span style="color: #ff0000;">&quot;Status: $http_status<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
    <a href="http://perldoc.perl.org/functions/print.html"><span style="color: #000066;">print</span></a> <span style="color: #ff0000;">&quot;Content-Type: text/html<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
    <a href="http://perldoc.perl.org/functions/print.html"><span style="color: #000066;">print</span></a> <span style="color: #ff0000;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>&lt;TITLE&gt;Error&lt;/TITLE&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
    <a href="http://perldoc.perl.org/functions/print.html"><span style="color: #000066;">print</span></a> <span style="color: #ff0000;">&quot;&lt;H1&gt;$http_status&lt;/H1&gt;&lt;P&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
    <span style="color: #0000ff;">$err</span> <span style="color: #339933;">=~</span> <span style="color: #009966; font-style: italic;">s/&amp;/&amp;amp;/g</span><span style="color: #339933;">;</span>
    <span style="color: #0000ff;">$err</span> <span style="color: #339933;">=~</span> <span style="color: #009966; font-style: italic;">s/&lt;/&amp;lt;/g</span><span style="color: #339933;">;</span>
    <span style="color: #0000ff;">$err</span> <span style="color: #339933;">=~</span> <span style="color: #009966; font-style: italic;">s/&gt;/&amp;gt;/g</span><span style="color: #339933;">;</span>
    <a href="http://perldoc.perl.org/functions/print.html"><span style="color: #000066;">print</span></a> <span style="color: #ff0000;">&quot;$err<span style="color: #000099; font-weight: bold;">\n</span>&lt;P&gt;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
    <a href="http://perldoc.perl.org/functions/exit.html"><span style="color: #000066;">exit</span></a> <span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&#160;
  <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
    <a href="http://perldoc.perl.org/functions/print.html"><span style="color: #000066;">print</span></a> <span style="color: #000000; font-weight: bold;">STDERR</span> <span style="color: #ff0000;">&quot;$progname: $err<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
    <a href="http://perldoc.perl.org/functions/exit.html"><span style="color: #000066;">exit</span></a> <span style="color: #cc66cc;">1</span><span style="color: #339933;">;</span>
  <span style="color: #009900;">&#125;</span>
<span style="color: #009900;">&#125;</span>
&#160;
<span style="color: #000000; font-weight: bold;">sub</span> usage<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
  <a href="http://perldoc.perl.org/functions/print.html"><span style="color: #000066;">print</span></a> <span style="color: #000000; font-weight: bold;">STDERR</span> <span style="color: #ff0000;">&quot;usage: $progname [--verbose] [--strip] [--no-color]<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span> <span style="color: #339933;">.</span>
               <span style="color: #ff0000;">&quot;                 [input-chat-log] [output-html-file]<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
  <a href="http://perldoc.perl.org/functions/exit.html"><span style="color: #000066;">exit</span></a> <span style="color: #cc66cc;">1</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span>
&#160;
<span style="color: #000000; font-weight: bold;">sub</span> main<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
&#160;
  <span style="color: #b1b100;">my</span> <span style="color: #0000ff;">$in</span>  <span style="color: #339933;">=</span> <a href="http://perldoc.perl.org/functions/undef.html"><span style="color: #000066;">undef</span></a><span style="color: #339933;">;</span>
  <span style="color: #b1b100;">my</span> <span style="color: #0000ff;">$out</span> <span style="color: #339933;">=</span> <a href="http://perldoc.perl.org/functions/undef.html"><span style="color: #000066;">undef</span></a><span style="color: #339933;">;</span>
&#160;
  <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><a href="http://perldoc.perl.org/functions/defined.html"><span style="color: #000066;">defined</span></a> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$ENV</span><span style="color: #009900;">&#123;</span>REQUEST_URI<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    <a href="http://perldoc.perl.org/functions/return.html"><span style="color: #000066;">return</span></a> do_cgi<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  <span style="color: #009900;">&#125;</span>
&#160;
  <span style="color: #b1b100;">while</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$_</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">$ARGV</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    <a href="http://perldoc.perl.org/functions/shift.html"><span style="color: #000066;">shift</span></a> <span style="color: #339933;">@</span><span style="color: #000000; font-weight: bold;">ARGV</span><span style="color: #339933;">;</span>
    <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$_</span> <span style="color: #b1b100;">eq</span> <span style="color: #ff0000;">&quot;--verbose&quot;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> <span style="color: #0000ff;">$verbose</span><span style="color: #339933;">++;</span> <span style="color: #009900;">&#125;</span>
    <span style="color: #b1b100;">elsif</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$_</span> <span style="color: #b1b100;">eq</span> <span style="color: #ff0000;">&quot;--strip&quot;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> <span style="color: #0000ff;">$strip_noise</span><span style="color: #339933;">++;</span> <span style="color: #009900;">&#125;</span>
    <span style="color: #b1b100;">elsif</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$_</span> <span style="color: #b1b100;">eq</span> <span style="color: #ff0000;">&quot;--no-time&quot;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> <span style="color: #0000ff;">$strip_timestamps</span><span style="color: #339933;">++;</span> <span style="color: #009900;">&#125;</span>
    <span style="color: #b1b100;">elsif</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$_</span> <span style="color: #b1b100;">eq</span> <span style="color: #ff0000;">&quot;--no-color&quot;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> <span style="color: #0000ff;">$colorize_p</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span> <span style="color: #0000ff;">$separators_p</span> <span style="color: #339933;">=</span> <span style="color: #cc66cc;">1</span><span style="color: #339933;">;</span> <span style="color: #009900;">&#125;</span>
    <span style="color: #b1b100;">elsif</span> <span style="color: #009900;">&#40;</span><span style="color: #009966; font-style: italic;">m/^-v+$/</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> <span style="color: #0000ff;">$verbose</span> <span style="color: #339933;">+=</span> <a href="http://perldoc.perl.org/functions/length.html"><span style="color: #000066;">length</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$_</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">-</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">;</span> <span style="color: #009900;">&#125;</span>
    <span style="color: #b1b100;">elsif</span> <span style="color: #009900;">&#40;</span><span style="color: #009966; font-style: italic;">m/^-./</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> usage<span style="color: #339933;">;</span> <span style="color: #009900;">&#125;</span>
    <span style="color: #b1b100;">elsif</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><a href="http://perldoc.perl.org/functions/defined.html"><span style="color: #000066;">defined</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$in</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> <span style="color: #0000ff;">$in</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">$_</span><span style="color: #339933;">;</span> <span style="color: #009900;">&#125;</span>
    <span style="color: #b1b100;">elsif</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">!</span><a href="http://perldoc.perl.org/functions/defined.html"><span style="color: #000066;">defined</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$out</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> <span style="color: #0000ff;">$out</span> <span style="color: #339933;">=</span> <span style="color: #0000ff;">$_</span><span style="color: #339933;">;</span> <span style="color: #009900;">&#125;</span>
    <span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span> usage<span style="color: #339933;">;</span> <span style="color: #009900;">&#125;</span>
  <span style="color: #009900;">&#125;</span>
&#160;
  <span style="color: #0000ff;">$in</span>  <span style="color: #339933;">=</span> <span style="color: #ff0000;">&quot;-&quot;</span> <span style="color: #b1b100;">unless</span> <span style="color: #0000ff;">$in</span><span style="color: #339933;">;</span>
  <span style="color: #0000ff;">$out</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">&quot;-&quot;</span> <span style="color: #b1b100;">unless</span> <span style="color: #0000ff;">$out</span><span style="color: #339933;">;</span>
&#160;
  <a href="http://perldoc.perl.org/functions/local.html"><span style="color: #000066;">local</span></a> <span style="color: #0000ff;">*IN</span><span style="color: #339933;">;</span>
  <a href="http://perldoc.perl.org/functions/local.html"><span style="color: #000066;">local</span></a> <span style="color: #0000ff;">*OUT</span><span style="color: #339933;">;</span>
  <a href="http://perldoc.perl.org/functions/open.html"><span style="color: #000066;">open</span></a> <span style="color: #009900;">&#40;</span>IN<span style="color: #339933;">,</span> <span style="color: #ff0000;">&quot;&lt;$in&quot;</span><span style="color: #009900;">&#41;</span>   <span style="color: #339933;">||</span> <a href="http://perldoc.perl.org/functions/die.html"><span style="color: #000066;">die</span></a> <span style="color: #ff0000;">&quot;$progname: unable to read $in: $!<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
  <a href="http://perldoc.perl.org/functions/open.html"><span style="color: #000066;">open</span></a> <span style="color: #009900;">&#40;</span>OUT<span style="color: #339933;">,</span> <span style="color: #ff0000;">&quot;&gt;$out&quot;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">||</span> <a href="http://perldoc.perl.org/functions/die.html"><span style="color: #000066;">die</span></a> <span style="color: #ff0000;">&quot;$progname: unable to write $out: $!<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
&#160;
  <span style="color: #0000ff;">$in</span>  <span style="color: #339933;">=</span> <span style="color: #ff0000;">&quot;stdin&quot;</span>  <span style="color: #b1b100;">if</span> <span style="color: #0000ff;">$in</span>  <span style="color: #b1b100;">eq</span> <span style="color: #ff0000;">&quot;-&quot;</span><span style="color: #339933;">;</span>
  <span style="color: #0000ff;">$out</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">&quot;stdout&quot;</span> <span style="color: #b1b100;">if</span> <span style="color: #0000ff;">$out</span> <span style="color: #b1b100;">eq</span> <span style="color: #ff0000;">&quot;-&quot;</span><span style="color: #339933;">;</span>
  <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$verbose</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    <a href="http://perldoc.perl.org/functions/print.html"><span style="color: #000066;">print</span></a> <span style="color: #000000; font-weight: bold;">STDERR</span> <span style="color: #ff0000;">&quot;$progname: converting $in to $out...<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
  <span style="color: #009900;">&#125;</span>
&#160;
  <span style="color: #b1b100;">my</span> <span style="color: #0000ff;">$body</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">''</span><span style="color: #339933;">;</span>
  <span style="color: #0000ff;">$body</span> <span style="color: #339933;">.=</span> <span style="color: #0000ff;">$_</span> <span style="color: #b1b100;">while</span> <span style="color: #009900;">&#40;</span><span style="color: #009999;">&lt;IN&gt;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  <a href="http://perldoc.perl.org/functions/print.html"><span style="color: #000066;">print</span></a> OUT convert_body <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$body</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  <a href="http://perldoc.perl.org/functions/close.html"><span style="color: #000066;">close</span></a> OUT<span style="color: #339933;">;</span>
  <a href="http://perldoc.perl.org/functions/close.html"><span style="color: #000066;">close</span></a> IN<span style="color: #339933;">;</span>
&#160;
  <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span><span style="color: #0000ff;">$verbose</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    <a href="http://perldoc.perl.org/functions/print.html"><span style="color: #000066;">print</span></a> <span style="color: #000000; font-weight: bold;">STDERR</span> <span style="color: #ff0000;">&quot;$progname: wrote $out ($output_lines lines).<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">;</span>
  <span style="color: #009900;">&#125;</span>
<span style="color: #009900;">&#125;</span>
&#160;
main<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<a href="http://perldoc.perl.org/functions/exit.html"><span style="color: #000066;">exit</span></a> <span style="color: #cc66cc;">0</span><span style="color: #339933;">;</span></pre>

