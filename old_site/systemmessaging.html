---
layout: obsolete
title: "System.Messaging"
permalink: /old_site/System.Messaging/
---

<h1>System.Messaging</h1>

<p><br />
At this point Mono has alpha support for the System.Messaging namespace, current (as of release 2.4.2.1) Mono uses <a href="http://www.amqp.org" class="external text" rel="nofollow">AMQP</a> through <a href="http://www.rabbitmq.com" class="external text" rel="nofollow">RabbitMQ</a> to partially implement the messaging APIs. 
</p>
<table id="toc" class="toc"><tr><td><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Getting_Started"><span class="tocnumber">1</span> <span class="toctext">Getting Started</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#What.27s_Supported.3F"><span class="tocnumber">2</span> <span class="toctext">What's Supported?</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#What.27s_In_Progress"><span class="tocnumber">3</span> <span class="toctext">What's In Progress</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#Getting_Involved"><span class="tocnumber">4</span> <span class="toctext">Getting Involved</span></a></li>
</ul>
</td></tr></table>
<h2> <span class="mw-headline" id="Getting_Started"> Getting Started </span></h2>
<p>To get started with System.Messaging, first you will need an AMQP implementation that will provide the messaging implementation.  While in theory any AMQP should work, only RabbitMQ has been tested so far, <a href="http://www.rabbitmq.com/download.html" class="external text" rel="nofollow">binaries</a> are available for Windows and various flavours of GNU/Linux.
</p><p>To implement a System.Messaging client, you will need to reference the following 4 dlls, available in the 2.4.2.1 release of Mono.
</p>
<ul><li> System.Messaging.dll (the MS compatible API)
</li><li> Mono.Messaging.dll (The Mono Messaging SPI)
</li><li> Mono.Messaging.RabbitMQ.dll (Bindings from Mono.Messaging to the RabbitMQ server)
</li><li> RabbitMQ.Client.dll (The RabbitMQ supplied .NET client library)
</li></ul>
<p>Simply implement a System.Messaging client as you would against the MS APIs.
</p><p>When running the client it is necessary to define the MONO_MESSAGING_PROVIDER environment variable.  It should be set to:
</p><p>Mono.Messaging.RabbitMQ.RabbitMQMessagingProvider,Mono.Messaging.RabbitMQ
</p><p>Which is the full class name of the messaging provider class that is the entry point for the implementation of the Mono.Messaging SPI.  In coming versions of Mono the value for the environment variable will be shortened.
</p><p>Due to a bug (which will be fixed in a later release), you will also need to add the mono assemblies to the MONO_PATH environment variable, e.g:
</p><p>MONO_PATH=/usr/lib/mono/2.0
</p><p>Example code:
</p>
<pre class="csharp" style="font-family:monospace;"><span style="color: #0600FF; font-weight: bold;">using</span> <span style="color: #008080;">System</span><span style="color: #008000;">;</span>
<span style="color: #0600FF; font-weight: bold;">using</span> <span style="color: #008080;">System.Messaging</span><span style="color: #008000;">;</span>
&#160;
<span style="color: #0600FF; font-weight: bold;">namespace</span> messagingexample
<span style="color: #008000;">&#123;</span>
    <span style="color: #6666cc; font-weight: bold;">class</span> MainClass <span style="color: #008000;">&#123;</span>
&#160;
        <span style="color: #0600FF; font-weight: bold;">public</span> <span style="color: #0600FF; font-weight: bold;">static</span> <span style="color: #6666cc; font-weight: bold;">void</span> Main <span style="color: #008000;">&#40;</span><span style="color: #6666cc; font-weight: bold;">string</span><span style="color: #008000;">&#91;</span><span style="color: #008000;">&#93;</span>args<span style="color: #008000;">&#41;</span>
        <span style="color: #008000;">&#123;</span>
            <span style="color: #008080; font-style: italic;">// '.' Represents connecting to localhost.</span>
            <span style="color: #008080; font-style: italic;">// 'private$' Indicates a private queue, not really needed for</span>
            <span style="color: #008080; font-style: italic;">// mono/rabbitmq, but is supported for MS compatibility.</span>
            <span style="color: #008080; font-style: italic;">// 'testq' Is the name of the queue.</span>
            <span style="color: #6666cc; font-weight: bold;">string</span> path <span style="color: #008000;">=</span> <span style="color: #666666;">@&quot;.\private$\testq&quot;</span><span style="color: #008000;">;</span>
            MessageQueue queue <span style="color: #008000;">=</span> MessageQueue<span style="color: #008000;">.</span><span style="color: #0000FF;">Exists</span> <span style="color: #008000;">&#40;</span>path<span style="color: #008000;">&#41;</span> <span style="color: #008000;">?</span>
                <a href="http://www.google.com/search?q=new+msdn.microsoft.com"><span style="color: #008000;">new</span></a> MessageQueue <span style="color: #008000;">&#40;</span>path<span style="color: #008000;">&#41;</span> <span style="color: #008000;">:</span> MessageQueue<span style="color: #008000;">.</span><span style="color: #0000FF;">Create</span> <span style="color: #008000;">&#40;</span>path<span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
            queue<span style="color: #008000;">.</span><span style="color: #0000FF;">Formatter</span> <span style="color: #008000;">=</span> <a href="http://www.google.com/search?q=new+msdn.microsoft.com"><span style="color: #008000;">new</span></a> BinaryMessageFormatter <span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
&#160;
&#160;
            <span style="color: #0600FF; font-weight: bold;">while</span> <span style="color: #008000;">&#40;</span><span style="color: #0600FF; font-weight: bold;">true</span><span style="color: #008000;">&#41;</span>
            <span style="color: #008000;">&#123;</span>
                Console<span style="color: #008000;">.</span><span style="color: #0000FF;">Write</span> <span style="color: #008000;">&#40;</span><span style="color: #666666;">&quot;Please enter a message (empty line to exit): &quot;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
                <span style="color: #6666cc; font-weight: bold;">string</span> input <span style="color: #008000;">=</span> Console<span style="color: #008000;">.</span><span style="color: #0000FF;">ReadLine</span> <span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
                <span style="color: #0600FF; font-weight: bold;">if</span> <span style="color: #008000;">&#40;</span>input <span style="color: #008000;">!=</span> <span style="color: #0600FF; font-weight: bold;">null</span> <span style="color: #008000;">&amp;&amp;</span> input<span style="color: #008000;">.</span><span style="color: #0000FF;">Length</span> <span style="color: #008000;">&gt;</span> <span style="color: #FF0000;">0</span><span style="color: #008000;">&#41;</span>
                <span style="color: #008000;">&#123;</span>
                    Message m <span style="color: #008000;">=</span> <a href="http://www.google.com/search?q=new+msdn.microsoft.com"><span style="color: #008000;">new</span></a> Message <span style="color: #008000;">&#40;</span>input<span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
                    queue<span style="color: #008000;">.</span><span style="color: #0000FF;">Send</span> <span style="color: #008000;">&#40;</span>m<span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
                    Message response <span style="color: #008000;">=</span> queue<span style="color: #008000;">.</span><span style="color: #0000FF;">Receive</span> <span style="color: #008000;">&#40;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
                    Console<span style="color: #008000;">.</span><span style="color: #0000FF;">WriteLine</span> <span style="color: #008000;">&#40;</span><span style="color: #666666;">&quot;Received: {0}&quot;</span>, response<span style="color: #008000;">.</span><span style="color: #0000FF;">Body</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
                <span style="color: #008000;">&#125;</span>
                <span style="color: #0600FF; font-weight: bold;">else</span>
                <span style="color: #008000;">&#123;</span>
                    Console<span style="color: #008000;">.</span><span style="color: #0000FF;">WriteLine</span> <span style="color: #008000;">&#40;</span><span style="color: #666666;">&quot;Exiting...&quot;</span><span style="color: #008000;">&#41;</span><span style="color: #008000;">;</span>
                    <span style="color: #0600FF; font-weight: bold;">break</span><span style="color: #008000;">;</span>
                <span style="color: #008000;">&#125;</span>
            <span style="color: #008000;">&#125;</span>
        <span style="color: #008000;">&#125;</span>
    <span style="color: #008000;">&#125;</span>
<span style="color: #008000;">&#125;</span></pre>
<h2> <span class="mw-headline" id="What.27s_Supported.3F"> What's Supported? </span></h2>
<p>The Microsoft System.Messaging APIs (for better or worse) weren't designed to be a generic messaging API, unlike something like JMS.  Therefore some parts of the System.Messaging API are difficult to implement as they tie too closely to the MSMQ server to be reimplemented in a generic fashion.  Some of the key areas that can't be supported are:
</p>
<ul><li> MessageQueue.ReadHandle
</li><li> MessageQueue.WriteHandle
</li><li> MessageQueue security and permissions support.
</li><li> MessageEnumerators are mostly supported, but some of the transactional remove methods can't be implemented.
</li></ul>
<p>However most of the key aspects are implemented including Send/Receive, Async Send/Receive, Transactions, Persistence.  The current implementation doesn't support authentication against the RabbitMQ server, so relies on using the default guest account.
</p><p>AMQP version 0.8 (currently supported by RabbitMQ) does not have support for queue discovery, i.e. looking up/finding queues by name.  AMQP uses a 'declare' command which creates to queue if it doesn't exist.  To support MessageQueue.Exists ("queue name") methods, the Mono/RabbitMQ integration keeps a local cache of the queues that have been created.  So the first time MessageQueue.Exists is called for a specific queue after starting it will always return false until MessageQueue.Create is called, at which point the name of the queue is added to the cache.
</p>
<h2> <span class="mw-headline" id="What.27s_In_Progress"> What's In Progress </span></h2>
<ul><li> Moving the Mono.Messaging.RabbitMQ to .NET 2.0 APIs to support System.Configuration.
</li><li> Use System.Configuration to support authentication and allow different queues to map to different users.
</li><li> Performance and Load testing.
</li></ul>
<h2> <span class="mw-headline" id="Getting_Involved"> Getting Involved </span></h2>
<p>What's most needed right now is users and testers.  We really need a picture of what Mono users most want to see from its implementation of System.Messaging.  Grab the latest release, try it out and raise bugs against the parts that don't work.
</p>
