---
layout: obsolete
title: "CGI"
permalink: /old_site/CGI/
---

<h1>CGI</h1>

<p><br />
<a href="http://hoohoo.ncsa.illinois.edu/cgi/" class="external text" rel="nofollow">CGI</a> is the most widely supported web server application interface. <a href="{{site.baseurl}}/ASP.NET" title="ASP.NET">ASP.NET</a> (and <a href="{{site.baseurl}}/Mono" title="Mono" class="mw-redirect">Mono</a>) has a relatively long startup time and requires a relatively large amount of initial memory that makes it unsuitable to be used as a CGI application in the traditional way because CGI requires the web server to create a new application process for each request.
</p><p>Both <a href="{{site.baseurl}}/Mod_mono" title="Mod mono">mod_mono</a> and <a href="{{site.baseurl}}/FastCGI" title="FastCGI">fastcgi-mono-server</a> are using a persistent separate process that is processing the requests thus eliminating the performance impact of long startup time and reducing overall memory requirements.
</p><p>Shared hosing environments usually use <a href="http://httpd.apache.org" class="external text" rel="nofollow">Apache</a> that only has support for CGI out of the box. Both mod_mono and FastCGI support require installing modules that can only be done by server administrators.
</p><p><a href="http://www.fastcgi.com/" class="external text" rel="nofollow">cgi-fcgi</a> is a CGI to FastCGI bridge also capable of starting a FastCGI application that has support for a wide range of platforms. <b>cgi-fcgi</b> along with <b>fastcgi-mono-server</b> enables <b>ASP.NET</b> on any web server that has support for CGI without noticeable performance impact.
</p>
<table id="toc" class="toc"><tr><td><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Installing_Mono_and_cgi-fcgi"><span class="tocnumber">1</span> <span class="toctext">Installing Mono and cgi-fcgi</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Script_files"><span class="tocnumber">2</span> <span class="toctext">Script files</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Recycling_the_FastCGI_server"><span class="tocnumber">3</span> <span class="toctext">Recycling the FastCGI server</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#ASP.NET_configuration"><span class="tocnumber">4</span> <span class="toctext">ASP.NET configuration</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="#Apache_configuration"><span class="tocnumber">5</span> <span class="toctext">Apache configuration</span></a></li>
</ul>
</td></tr></table>
<h2> <span class="mw-headline" id="Installing_Mono_and_cgi-fcgi"> Installing Mono and cgi-fcgi </span></h2>
<p>For more detailed instructions on installing Mono see our <a href="{{site.baseurl}}/Getting_Mono" title="Getting Mono" class="mw-redirect">Getting Mono</a> and <a href="{{site.baseurl}}/Compiling_Mono" title="Compiling Mono">Compiling Mono</a> pages. cgi-fcgi is available for download from the  <a href="http://www.fastcgi.com/drupal/node/5" class="external text" rel="nofollow">FastCGI</a> site as part of the <b>Development Kit</b>.
</p><p>The following sample configuration assumes installation prefixes used here to configure cgi-fcgi and mono. If you use different prefixes you also will have to modify the sample files:
</p>
<pre class="bash" style="font-family:monospace;">$ <span style="color: #c20cb9; font-weight: bold;">tar</span> xzf fcgi-2.4.0.tar.gz
$ <span style="color: #7a0874; font-weight: bold;">cd</span> fcgi-2.4.0
$ .<span style="color: #000000; font-weight: bold;">/</span>configure <span style="color: #660033;">--prefix</span>=<span style="color: #000000; font-weight: bold;">/</span>home<span style="color: #000000; font-weight: bold;">/</span>username<span style="color: #000000; font-weight: bold;">/</span>fcgi
$ <span style="color: #c20cb9; font-weight: bold;">make</span> 
$ <span style="color: #c20cb9; font-weight: bold;">make</span> <span style="color: #c20cb9; font-weight: bold;">install</span>
...
$ <span style="color: #c20cb9; font-weight: bold;">tar</span> xjf mono-<span style="color: #000000;">2.4</span>.tar.bz2
$ <span style="color: #7a0874; font-weight: bold;">cd</span> mono-<span style="color: #000000;">2.4</span>
$ .<span style="color: #000000; font-weight: bold;">/</span>configure <span style="color: #660033;">--prefix</span>=<span style="color: #000000; font-weight: bold;">/</span>home<span style="color: #000000; font-weight: bold;">/</span>username<span style="color: #000000; font-weight: bold;">/</span>mono
$ <span style="color: #c20cb9; font-weight: bold;">make</span> 
$ <span style="color: #c20cb9; font-weight: bold;">make</span> <span style="color: #c20cb9; font-weight: bold;">install</span>
...
$ <span style="color: #c20cb9; font-weight: bold;">tar</span> xjf xsp-<span style="color: #000000;">2.4</span>.tar.bz2
$ <span style="color: #7a0874; font-weight: bold;">cd</span> xsp-<span style="color: #000000;">2.4</span>
$ <span style="color: #7a0874; font-weight: bold;">export</span> <span style="color: #007800;">PATH</span>=<span style="color: #000000; font-weight: bold;">/</span>home<span style="color: #000000; font-weight: bold;">/</span>username<span style="color: #000000; font-weight: bold;">/</span>mono<span style="color: #000000; font-weight: bold;">/</span>bin:<span style="color: #007800;">$PATH</span>
$ <span style="color: #7a0874; font-weight: bold;">export</span> <span style="color: #007800;">PKG_CONFIG_PATH</span>=<span style="color: #000000; font-weight: bold;">/</span>home<span style="color: #000000; font-weight: bold;">/</span>username<span style="color: #000000; font-weight: bold;">/</span>mono<span style="color: #000000; font-weight: bold;">/</span>lib<span style="color: #000000; font-weight: bold;">/</span>pkgconfig:<span style="color: #007800;">$PKG_CONFIG_PATH</span>
$ .<span style="color: #000000; font-weight: bold;">/</span>configure <span style="color: #660033;">--prefix</span>=<span style="color: #000000; font-weight: bold;">/</span>home<span style="color: #000000; font-weight: bold;">/</span>username<span style="color: #000000; font-weight: bold;">/</span>mono
$ <span style="color: #c20cb9; font-weight: bold;">make</span> 
$ <span style="color: #c20cb9; font-weight: bold;">make</span> <span style="color: #c20cb9; font-weight: bold;">install</span></pre>
<p>You also may compile them on a compatible development machine using the same installation prefixes and upload the binaries to the web server.
</p><p>If you have no shell access to the web server you can use <a href="http://phpshell.sourceforge.net/" class="external text" rel="nofollow">PHP Shell</a> that is a lightweight remote shell wrapper to extract compressed files, monitor or kill your processes or execute arbitrary commands.
</p>
<h2> <span class="mw-headline" id="Script_files"> Script files </span></h2>
<p>Handler CGI script (<i>/home/username/public_html/cgi-bin/mono-cgi</i>):
</p>
<pre class="bash" style="font-family:monospace;"><span style="color: #666666; font-style: italic;">#!/home/username/fcgi/bin/cgi-fcgi -f</span>
<span style="color: #660033;">-connect</span> <span style="color: #000000; font-weight: bold;">/</span>home<span style="color: #000000; font-weight: bold;">/</span>username<span style="color: #000000; font-weight: bold;">/</span>tmp<span style="color: #000000; font-weight: bold;">/</span>mono-fcgi.sock <span style="color: #000000; font-weight: bold;">/</span>home<span style="color: #000000; font-weight: bold;">/</span>username<span style="color: #000000; font-weight: bold;">/</span>bin<span style="color: #000000; font-weight: bold;">/</span>mono-fcgi</pre>
<p>Using this configuration cgi-fcgi will create a listening socket and pass it to a new mono-fcgi process when unable to connect to the socket that will avoid race conditions and will result in less overhead than using a shell script. For more information see <a href="http://www.fastcgi.com/devkit/doc/fcgi-devel-kit.htm#S4.2" class="external text" rel="nofollow">cgi-fcgi documentation</a>.
</p><p><br />
A separate shell script (<i>/home/username/bin/mono-fcgi</i>) is required to start fastcgi-mono-server because cgi-fcgi has no support for setting environment variables or passing arguments to the FastCGI application. CGI variables also have to be removed to avoid falling back to them:
</p>
<pre class="bash" style="font-family:monospace;"><span style="color: #666666; font-style: italic;">#!/bin/sh</span>
<span style="color: #7a0874; font-weight: bold;">umask</span> 0077
<span style="color: #7a0874; font-weight: bold;">exec</span> <span style="color: #000000; font-weight: bold;">&gt;&gt;/</span>home<span style="color: #000000; font-weight: bold;">/</span>username<span style="color: #000000; font-weight: bold;">/</span>tmp<span style="color: #000000; font-weight: bold;">/</span>mono-fcgi.log
<span style="color: #7a0874; font-weight: bold;">exec</span> <span style="color: #000000;">2</span><span style="color: #000000; font-weight: bold;">&gt;&gt;/</span>home<span style="color: #000000; font-weight: bold;">/</span>username<span style="color: #000000; font-weight: bold;">/</span>tmp<span style="color: #000000; font-weight: bold;">/</span>mono-fcgi.err
&#160;
<span style="color: #7a0874; font-weight: bold;">echo</span> $<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #c20cb9; font-weight: bold;">date</span> +<span style="color: #ff0000;">&quot;[%F&#160;%T]&quot;</span><span style="color: #7a0874; font-weight: bold;">&#41;</span> Starting fastcgi-mono-server2
&#160;
<span style="color: #7a0874; font-weight: bold;">cd</span> <span style="color: #000000; font-weight: bold;">/</span>
<span style="color: #c20cb9; font-weight: bold;">chmod</span> 0700 <span style="color: #000000; font-weight: bold;">/</span>home<span style="color: #000000; font-weight: bold;">/</span>username<span style="color: #000000; font-weight: bold;">/</span>tmp<span style="color: #000000; font-weight: bold;">/</span>mono-fcgi.sock
<span style="color: #7a0874; font-weight: bold;">echo</span> <span style="color: #007800;">$$</span><span style="color: #000000; font-weight: bold;">&gt;/</span>home<span style="color: #000000; font-weight: bold;">/</span>username<span style="color: #000000; font-weight: bold;">/</span>tmp<span style="color: #000000; font-weight: bold;">/</span>mono-fcgi.pid
<span style="color: #666666; font-style: italic;"># stdin is the socket handle</span>
<span style="color: #7a0874; font-weight: bold;">exec</span> <span style="color: #c20cb9; font-weight: bold;">env</span> <span style="color: #660033;">-i</span> \
<span style="color: #007800;">PATH</span>=<span style="color: #ff0000;">&quot;/home/username/mono/bin:<span style="color: #007800;">$PATH</span>&quot;</span> \
<span style="color: #007800;">LD_LIBRARY_PATH</span>=<span style="color: #ff0000;">&quot;/home/username/mono/lib:<span style="color: #007800;">$LD_LIBRARY_PATH</span>&quot;</span> \
<span style="color: #007800;">TMP</span>=<span style="color: #ff0000;">&quot;/home/username/tmp&quot;</span> \
<span style="color: #007800;">MONO_SHARED_DIR</span>=<span style="color: #ff0000;">&quot;/home/username/tmp&quot;</span> \
<span style="color: #000000; font-weight: bold;">/</span>home<span style="color: #000000; font-weight: bold;">/</span>username<span style="color: #000000; font-weight: bold;">/</span>mono<span style="color: #000000; font-weight: bold;">/</span>bin<span style="color: #000000; font-weight: bold;">/</span>fastcgi-mono-server2 \
<span style="color: #000000; font-weight: bold;">/</span><span style="color: #007800;">root</span>=<span style="color: #000000; font-weight: bold;">/</span>home<span style="color: #000000; font-weight: bold;">/</span>username<span style="color: #000000; font-weight: bold;">/</span>public_html <span style="color: #000000; font-weight: bold;">/</span><span style="color: #007800;">applications</span>=<span style="color: #000000; font-weight: bold;">/</span>:<span style="color: #000000; font-weight: bold;">/</span>home<span style="color: #000000; font-weight: bold;">/</span>username<span style="color: #000000; font-weight: bold;">/</span>public_html</pre>
<p>This script also logs stdout and stderr and creates a pid file.
</p><p>You may want to use name based virtual hosts or define more applications on command line. For more information see <a href="{{site.baseurl}}/FastCGI#How_Applications_are_Handled_.28and_how_to_configure_them.29" title="FastCGI">How Applications are Handled</a>.
</p>
<h2> <span class="mw-headline" id="Recycling_the_FastCGI_server"> Recycling the FastCGI server </span></h2>
<p>The FastCGI server can be recycled by removing the socket file that will allow pending requests to be processed by the existing server process while new requests will be routed to a new server process created by cgi-fcgi.
</p><p>The following script (<i>/home/username/bin/recycle-mono-fcgi</i>) can be used in a cron job to recycle the FastCGI server periodically:
</p>
<pre class="bash" style="font-family:monospace;"><span style="color: #666666; font-style: italic;">#!/bin/sh</span>
<span style="color: #007800;">SOCKETFILE</span>=<span style="color: #000000; font-weight: bold;">/</span>home<span style="color: #000000; font-weight: bold;">/</span>username<span style="color: #000000; font-weight: bold;">/</span>tmp<span style="color: #000000; font-weight: bold;">/</span>mono-fcgi.sock
<span style="color: #007800;">PIDFILE</span>=<span style="color: #000000; font-weight: bold;">/</span>home<span style="color: #000000; font-weight: bold;">/</span>username<span style="color: #000000; font-weight: bold;">/</span>tmp<span style="color: #000000; font-weight: bold;">/</span>mono-fcgi.pid
<span style="color: #007800;">PID</span>=<span style="color: #000000;">0</span>
&#160;
<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #7a0874; font-weight: bold;">&#91;</span> <span style="color: #660033;">-e</span> <span style="color: #007800;">$PIDFILE</span> <span style="color: #7a0874; font-weight: bold;">&#93;</span>; <span style="color: #000000; font-weight: bold;">then</span>
	<span style="color: #007800;">PID</span>=$<span style="color: #7a0874; font-weight: bold;">&#40;</span><span style="color: #c20cb9; font-weight: bold;">cat</span> <span style="color: #007800;">$PIDFILE</span> <span style="color: #000000;">2</span><span style="color: #000000; font-weight: bold;">&gt;/</span>dev<span style="color: #000000; font-weight: bold;">/</span>null<span style="color: #7a0874; font-weight: bold;">&#41;</span>
	<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #7a0874; font-weight: bold;">&#91;</span> <span style="color: #660033;">-z</span> <span style="color: #ff0000;">&quot;<span style="color: #007800;">$PID</span>&quot;</span> <span style="color: #660033;">-o</span> <span style="color: #660033;">-z</span> <span style="color: #ff0000;">&quot;<span style="color: #007800;">$(ps --pid $PID -o pid=)</span>&quot;</span> <span style="color: #7a0874; font-weight: bold;">&#93;</span>; <span style="color: #000000; font-weight: bold;">then</span>
		<span style="color: #007800;">PID</span>=<span style="color: #000000;">0</span>
	<span style="color: #000000; font-weight: bold;">fi</span>
<span style="color: #000000; font-weight: bold;">fi</span>
&#160;
<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #7a0874; font-weight: bold;">&#91;</span> <span style="color: #007800;">$PID</span> <span style="color: #660033;">-ne</span> <span style="color: #000000;">0</span> <span style="color: #7a0874; font-weight: bold;">&#93;</span>; <span style="color: #000000; font-weight: bold;">then</span>
	<span style="color: #666666; font-style: italic;"># New requests will be routed to a new server process</span>
	<span style="color: #c20cb9; font-weight: bold;">rm</span> <span style="color: #660033;">-f</span> <span style="color: #007800;">$PIDFILE</span>
	<span style="color: #c20cb9; font-weight: bold;">rm</span> <span style="color: #660033;">-f</span> <span style="color: #007800;">$SOCKETFILE</span>
	<span style="color: #666666; font-style: italic;"># Wait for pending requests</span>
	<span style="color: #c20cb9; font-weight: bold;">sleep</span> <span style="color: #000000;">2</span>
	<span style="color: #c20cb9; font-weight: bold;">kill</span> <span style="color: #007800;">$PID</span>
	<span style="color: #666666; font-style: italic;"># Wait for graceful shutdown</span>
	<span style="color: #c20cb9; font-weight: bold;">sleep</span> <span style="color: #000000;">2</span>
	<span style="color: #000000; font-weight: bold;">if</span> <span style="color: #7a0874; font-weight: bold;">&#91;</span> <span style="color: #660033;">-n</span> <span style="color: #ff0000;">&quot;<span style="color: #007800;">$(ps --pid $PID -o pid=)</span>&quot;</span> <span style="color: #7a0874; font-weight: bold;">&#93;</span>; <span style="color: #000000; font-weight: bold;">then</span>
		<span style="color: #666666; font-style: italic;"># Kill if failed to terminate</span>
		<span style="color: #c20cb9; font-weight: bold;">kill</span> <span style="color: #660033;">-9</span> <span style="color: #007800;">$PID</span>
	<span style="color: #000000; font-weight: bold;">fi</span>
<span style="color: #000000; font-weight: bold;">fi</span></pre>
<p>For security reasons you should execute this script using the user account of the FastCGI server to avoid terminating processes of other users.
</p>
<h2> <span class="mw-headline" id="ASP.NET_configuration"> ASP.NET configuration </span></h2>
<p>To improve security you should disable access to CGI script source code (<i>/home/username/public_html/cgi-bin/Web.config</i>):
</p>
<pre class="xml" style="font-family:monospace;"><span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;configuration<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;system.web<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;httpHandlers<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
      <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;add</span> <span style="color: #000066;">verb</span>=<span style="color: #ff0000;">&quot;*&quot;</span> <span style="color: #000066;">path</span>=<span style="color: #ff0000;">&quot;mono-cgi&quot;</span> <span style="color: #000066;">type</span>=<span style="color: #ff0000;">&quot;System.Web.HttpForbiddenHandler&quot;</span> <span style="color: #000066;">validate</span>=<span style="color: #ff0000;">&quot;true&quot;</span><span style="color: #000000; font-weight: bold;">/&gt;</span></span>
    <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/httpHandlers<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
  <span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/system.web<span style="color: #000000; font-weight: bold;">&gt;</span></span></span>
<span style="color: #009900;"><span style="color: #000000; font-weight: bold;">&lt;/configuration<span style="color: #000000; font-weight: bold;">&gt;</span></span></span></pre>
<h2> <span class="mw-headline" id="Apache_configuration"> Apache configuration </span></h2>
<p>A simple Apache configuration file (<i>/home/username/public_html/.htaccess</i>):
</p>
<pre>
Action mono-cgi /cgi-bin/mono-cgi
AddHandler mono-cgi .aspx .asmx .ashx .ascx .asax .axd .config .cs
</pre>
<p>You may want to handle other extensions with ASP.NET. For more examples on configuration see <a href="{{site.baseurl}}/Mod_mono#Manual_Mod_Mono_Configuration" title="Mod mono">Manual Mod_Mono Configuration</a>.
</p><p><br />
To improve security you should protect ASP.NET Application Folders:
</p>
<pre>
Redirect 404 /bin
Redirect 404 /App_Browsers
Redirect 404 /App_Code
Redirect 404 /App_Data
Redirect 404 /App_GlobalResources
Redirect 404 /App_LocalResources
Redirect 404 /App_WebReferences
</pre>
<p><br />
Non-existent files can also be handled with Apache 2.2:
</p>
<pre>
Action mono-cgi /cgi-bin/mono-cgi virtual
AddHandler mono-cgi .aspx .asmx .ashx .ascx .asax .axd .config .cs
</pre>
<p><br />
Or handle all requests with ASP.NET:
</p>
<pre>
Action mono-cgi /cgi-bin/mono-cgi
SetHandler mono-cgi
</pre>
<p>You also will have to create a configuration file (<i>/home/username/public_html/cgi-bin/.htaccess</i>) to avoid server error resulting from circular dependency:
</p>
<pre>
&lt;Files mono-cgi&gt;
  Options +ExecCGI
  SetHandler cgi-script
&lt;/Files&gt;
</pre>
<p>You also may have to use this to enable CGI script execution.
</p><p><br />
<i>Author: Kornél Pál &lt;<a href="http://www.kornelpal.com/" class="external free" rel="nofollow">http://www.kornelpal.com/</a>&gt;</i>
</p>
