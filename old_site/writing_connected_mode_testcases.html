---
layout: obsolete
title: "Writing Connected Mode Testcases"
permalink: /old_site/Writing_Connected_Mode_Testcases/
redirect_from:
  - /Writing_Connected_Mode_Testcases/
---

<h1>Writing Connected Mode Testcases</h1>

<table id="toc" class="toc"><tr><td><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#What_is_this_framework_all_about.3F"><span class="tocnumber">1</span> <span class="toctext">What is this framework all about?</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#What_is_Connected_Mode_.26_Disconnected_mode.3F"><span class="tocnumber">2</span> <span class="toctext">What is Connected Mode &amp; Disconnected mode?</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Where_is_it.3F"><span class="tocnumber">3</span> <span class="toctext">Where is it?</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#How_to_run_these_tests.3F"><span class="tocnumber">4</span> <span class="toctext">How to run these tests?</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="#How_to_write_a_connected_mode_test.3F"><span class="tocnumber">5</span> <span class="toctext">How to write a connected mode test?</span></a></li>
<li class="toclevel-1 tocsection-6"><a href="#How_to_add_a_new_database_provider_framework.3F"><span class="tocnumber">6</span> <span class="toctext">How to add a new database provider framework?</span></a></li>
<li class="toclevel-1 tocsection-7"><a href="#Guidelines"><span class="tocnumber">7</span> <span class="toctext">Guidelines</span></a></li>
</ul>
</td></tr></table>
<h2> <span class="mw-headline" id="What_is_this_framework_all_about.3F">What is this framework all about?</span></h2>
<h2> <span class="mw-headline" id="What_is_Connected_Mode_.26_Disconnected_mode.3F">What is Connected Mode &amp; Disconnected mode?</span></h2>
<p>Connected mode is a behavior in ADO.NET where it deals with the live data communication with a database server. Whereas, the disconnected mode deals with in-memory data.  Basically, the disconnected mode is a cache of your data whereas the connected mode is a stream access to a data source.
</p><p>Disconnected mode tests does not require a database connection and can be tested without any external servers or libraries. So, it is easier to write tests for this. But, the connected mode tests require a particular database and needs a kind of setup before running these setups. There are a lot of databases available and all offer different feature set, semantics for communication and SQL syntax. So it would be a difficult task to write common tests to test all of them. So, we have to write tests for each and every provider out there and there would be a lot of duplicate work. We tried to minimize this effort and complexity by categorizing them and maximizing the sharing of common code. 
</p><p>Few of the classes which constitute the connected mode behavior are given below.
</p>
<ul><li> DataSet
</li><li> DataTable
</li><li> DataRow
</li><li> DataColumn
</li><li> DataRelation
</li><li> DataView
</li><li> DataAdapter
</li></ul>
<p>The disconnected mode behavior is provided by the specific provider classes derived from the following common base classes.
</p>
<ul><li> Connection
</li><li> Command
</li><li> DataReader
</li></ul>
<h2> <span class="mw-headline" id="Where_is_it.3F">Where is it?</span></h2>
<p>The connected mode test suite for ADO.NET is under mcs/class/System.Data/Test/ProviderTests. The disconnected mode tests are scattered under mcs/class/System.Data/Test into their respective namespaces.
</p><p>The directory Structure of this suite is as
</p>
<pre>
     ProviderTests
	+ Common			- common helper classes for test suite
	+ ProviderIndependantTests	- Set of test fixtures which can be shared across providers
	+ sql				- sql scripts to set up test database.
	+ System.Data.SqlClient		- Microsoft Sql Server specific tests
	+ System.Data.Odbc		- Odbc specific tests.
</pre>
<h2> <span class="mw-headline" id="How_to_run_these_tests.3F">How to run these tests?</span></h2>
<p>You need to first setup the connection string for the database provider for which you want to run the tests. The connection strings are given in the respective database provider's configuration file. Say, if you want to run tests for sqlserver you need to edit the sqlserver.config file. There should be a key with name "ConnString" which should be having a valid connection string.
</p><p>The tests operate on a common data pool. So, you need to set up the common data pool by populating the schema given in the sql subdirectory. Say, if you want to populate schema for sqlserver, run 
</p>
<pre> 	tsql -S sql-server -U user -P password &lt; sql/sqlserver.sql
</pre>
<p>Then you can run the tests any number of times by giving the following make with target
</p>
<pre>      make run-test DATABASE=&lt;your database&gt;
</pre>
<p>Allowed keywords for &lt;your database&gt; are sqlserver, odbc.
</p>
<h2> <span class="mw-headline" id="How_to_write_a_connected_mode_test.3F">How to write a connected mode test?</span></h2>
<ul><li> Identify which provider you are going to write the test case for. If your database is not in the test framework, see the below section to add a new provider framework.
</li></ul>
<ul><li> For testing any provider class, you need a database connection. Use the ConnectionManager singleton class to create,open and close connection. The best way is to copy an existing test case and change.
</li></ul>
<ul><li> Write tests as normal tests and follow the guidelines given in the following section. See <a href="{{site.baseurl}}/Testing" title="Testing" class="mw-redirect"> Writing Nunit Testcases  </a>.
</li></ul>
<ul><li> Include a category of your database as attribute for the test. Say, if you are writing test case Microsoft Sql Server, write [Category ("sqlserver")].
</li></ul>
<h2> <span class="mw-headline" id="How_to_add_a_new_database_provider_framework.3F">How to add a new database provider framework?</span></h2>
<ul><li> If you want to use this framework to test a new database provider, create a directory by the name of your namespace under ProviderTests.
</li></ul>
<h2> <span class="mw-headline" id="Guidelines">Guidelines</span></h2>
<ul><li> It is recommended  to create all the connected mode classes through Provider Factory classes.  So that, if your test case is generic enough, it can be moved to ProviderIndependant tests without much code changes.  Wherever possible, use IDb* interfaces.
</li></ul>

