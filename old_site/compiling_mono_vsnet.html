---
layout: obsolete
title: "Compiling Mono VSNET"
permalink: /old_site/Compiling_Mono_VSNET/
---

<h1>Compiling Mono VSNET</h1>

<p><a href="{{site.baseurl}}/SVN" title="SVN" class="mw-redirect">SVN</a> now includes a Visual Studio .NET 2005 solution <b>mono.sln</b> in the <a href="http://anonsvn.mono-project.com/viewvc/trunk/mono/msvc/" class="external text" rel="nofollow">mono/msvc directory</a>,  and some projects files to build most of the unmanaged parts in Mono.
</p><p>There is an ongoing effort to build the class libraries with Visual Studio as well, see the section "Work in Progress" below for more information.
</p><p>The <b>mono.sln</b> solution file contains the VC projects files for:
</p>
<ul><li> Embedded Samples
<ul><li> test-invoke.vcproj
</li><li> test-metadata.vcproj
</li><li> teste.vcproj
</li></ul>
</li><li> Libraries
<ul><li> libgc.vcproj
</li><li> libmono.vcproj
</li><li> eglib.vcproj
</li></ul>
</li><li> Tools
<ul><li> genmdesc.vcproj
</li><li> monoburg.vcproj
</li><li> monodiet.vcproj
</li><li> monodis.vcproj
</li><li> monograph.vcproj
</li><li> pedump.vcproj
</li></ul>
</li><li> mono.vcproj
</li></ul>
<table id="toc" class="toc"><tr><td><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Requirements"><span class="tocnumber">1</span> <span class="toctext">Requirements</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Optional"><span class="tocnumber">2</span> <span class="toctext">Optional</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Required_Local_Changes"><span class="tocnumber">3</span> <span class="toctext">Required Local Changes</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#Building"><span class="tocnumber">4</span> <span class="toctext">Building</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="#Known_Issues"><span class="tocnumber">5</span> <span class="toctext">Known Issues</span></a></li>
<li class="toclevel-1 tocsection-6"><a href="#Work_in_Progress"><span class="tocnumber">6</span> <span class="toctext">Work in Progress</span></a>
<ul>
<li class="toclevel-2 tocsection-7"><a href="#How_this_works"><span class="tocnumber">6.1</span> <span class="toctext">How this works</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-8"><a href="#More_informations"><span class="tocnumber">7</span> <span class="toctext">More informations</span></a></li>
</ul>
</td></tr></table>
<h1> <span class="mw-headline" id="Requirements"> Requirements </span></h1>
<p>1. Visual Studio .NET 2005. Previous Visual Studio versions may work or requires, hopefully minimal, changes.
</p>
<h1> <span class="mw-headline" id="Optional"> Optional</span></h1>
<p>1. A <a href="{{site.baseurl}}/Compiling_Mono#Windows_Compilation_Compiling_Mono" title="Compiling Mono">working</a> (i.e. where you could successfully build mono) <a href="http://www.cygwin.com/" class="external text" rel="nofollow">cygwin</a> setup! This is required to:
</p>
<ul><li> build the class libraries; and
</li><li> test for regressions.
</li></ul>
<h1> <span class="mw-headline" id="Required_Local_Changes"> Required Local Changes </span></h1>
<p>All required libraries for building mono in Visual Studio are referenced via the MONO_DEPENDENCIES_PREFIX environment variable. Set this variable to a previous installed mono (C:\Mono-1.2.5.2 for example), or to a cygwin environment setup for building mono (D:\cygwin\opt for example). 
</p><p>Each executed assembly (i.e. the EXE) must be able to find a working mscorlib.dll (and all the other required assemblies). This can be done in different ways. My preference is to use the project <b>properties pages</b> in the <b>Configuration Properties\Debugging\Environment</b> options and set <b>MONO_PATH</b> to the class libraries directory build by cygwin (local) or on Linux (remote). E.g.
</p>
<ul><li> <b>MONO_PATH=z:\svn\mcs\class\lib\default\</b> allows me to use the class libs build under Linux; while
</li><li> <b>MONO_PATH=C:\cygwin\opt\mono\lib\mono\1.0</b> use the one built from cygwin (after a make install)
</li></ul>
<h1> <span class="mw-headline" id="Building"> Building </span></h1>
<p>Once everything is installed (and edited) you can right-click on the <b>mono</b> solution (in the <b>Solution Explorer</b>), select <b>Clean Solution</b> (for the first time) then <b>Build Solution</b>.
</p><p>From the shell it is possible to build by using this command:
</p>
<pre class="bash" style="font-family:monospace;"> c<span style="color: #000000; font-weight: bold;">&gt;</span> vcbuild mono.sln <span style="color: #ff0000;">&quot;Debug_eglib|win32&quot;</span></pre>
<h1> <span class="mw-headline" id="Known_Issues"> Known Issues </span></h1>
<p>1. Most, BUT NOT ALL, the regressions tests pass under this build. The failures seems limited to some mathematical differences and to code relying on the stack walking functions. The hacks to replace the GCC functions (<b>__builtin_frame_address</b> and <b>__builtin_return_address</b>) are incomplete;
</p><p>2. The solution doesn't provide complete (i.e. from scratch) build. It requires a working cygwin environment to create some files (e.g. via genmdesc, monoburg). This isn't so bad as without cygwin you wouldn't be able to test Mono properly;
</p><p>3. Only the Debug target is configured properly (that would be easy to fix, but would require turning off some optimizations like <b>omitting stack frames</b>). Anyway there are other issues [1] to fix before switching to Release and IMHO the <b>biggest</b> advantage to VS.NET is it's debugger/debugging tools;
</p><p>4. The C compiler emits _lots_ of warning during compilation. Some warnings have been turned off for some projects (there was so much that it slowed down compilation). You can bring them back (or hide more of them) using the project <b>properties pages</b> windows, <b>Configuration Properties\C/C++\Advanced\Disable Specific Warnings</b>;
</p><p>5. Visual Studio 2005 should have all the latest header files required, but if not (or if you're using an older version of VS) then install MS Platform SDK (Windows Server 2003 is the latest) to ensure you have the latest Windows header files. You can download it from: <a href="http://www.microsoft.com/msdownload/platformsdk/sdkupdate/psdk-full.htm" class="external free" rel="nofollow">http://www.microsoft.com/msdownload/platformsdk/sdkupdate/psdk-full.htm</a>
</p><p>6. Not everyone has VS.NET so it is possible you may have to add some (new) files to the build from time to time. Please report such issues on the mailing list.
</p><p>7. Probably a lot more I didn't discover... or has changed since.
</p>
<h1> <span class="mw-headline" id="Work_in_Progress"> Work in Progress </span></h1>
<p>To build the class libraries you need:
</p>
<ul><li> To run from a command shell in mono\msvc the setup-solution.bat program
</li><li> To build the mono.sln solution in mono\msvc
</li><li> To copy into mcs\class\lib\basic the basic mcs.exe, mscorlib.dll, System.dll and System.Xml.dll from a Linux system from the 1.0 directory
</li></ul>
<p>VERY IMPORTANT: you need the latest version of `mcs' to be built, or you will get some errors while building corlib-basic.csproj in class/corlib.
</p>
<h2> <span class="mw-headline" id="How_this_works"> How this works </span></h2>
<p>We will be using the makefile process to generate csproj files for each component that must be built in Visual Studio.   The foundation for this lives in mono/msvc/scripts.
</p><p>The entire setup is contained in mono/msvc, to set it up do:
</p>
<pre class="bash" style="font-family:monospace;"> c:\mono\msvc<span style="color: #000000; font-weight: bold;">&gt;</span> setup-solution.bat</pre>
<p>This will generate the project files, once you build the mono runtime from the mono.sln, you should be able to load the project files for the assemblies in order.
</p><p>Currently the rules have only been tested for the class libraries, but it will be expanded in the future to also support the rest of the tools.
</p><p>The process will:
</p>
<ul><li> Generate a .csproj file per-assembly/profile
<ul><li> This means: mscorlib-bootstrap, mscorlib-net_1_1, mscorlib-net_2_0, mscolib_net_2_1
</li></ul>
</li><li> Drive the compilation by changing the CscToolPath directory in each of those project files to point to a custom directory that contains a wrapper that calls Mono and MCS with the appropriate flags.
</li></ul>
<p>A batch file in the mono/msvc/setup-solution.bat will prepare the tree before the solutions are ready to be used.
</p><p>The solutions are built from the actual commands and flags that are used by the Unix makefiles.   This is a two step process.
</p><p>The first step is collecting all the flags from the Makefiles, and this is done by running the following command in mono:
</p>
<pre class="bash" style="font-family:monospace;"> $ <span style="color: #7a0874; font-weight: bold;">cd</span> mono
 $ <span style="color: #c20cb9; font-weight: bold;">make</span> update-csproj</pre>
<p>This performs a full directory scan for all the assemblies that we are building and produces the file mono/msvc/scripts/order.xml that contains the information necessary to generate the solutions.
</p><p>Once the order.xml file is produed, the genproj.exe command can be run to populate all of the .csproj files from the order.xml file and the .sources in each directory in the build system.
</p>
<h1> <span class="mw-headline" id="More_informations"> More informations </span></h1>
<p>Please email <b>&lt;mono-devel-list@lists.ximian.com&gt;</b> if you have any problem and/or if there's something wrong or missing in the instructions.
</p><p>An offline version of this document is available in the file <a href="http://github.com/mono/mono/blob/master/README.vsnet" class="external text" rel="nofollow">README.vsnet</a>.
</p>
