---
layout: obsolete
title: "CSharp Compiler"
permalink: /old_site/CSharp_Compiler/
---

<h1>CSharp Compiler</h1>

<p><br />
</p>
<table id="toc" class="toc"><tr><td><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Introduction"><span class="tocnumber">1</span> <span class="toctext">Introduction</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#Compiler_Service"><span class="tocnumber">1.1</span> <span class="toctext">Compiler Service</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="#State_of_the_Compiler"><span class="tocnumber">1.2</span> <span class="toctext">State of the Compiler</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#Specification"><span class="tocnumber">1.3</span> <span class="toctext">Specification</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#Working_with_MCS"><span class="tocnumber">1.4</span> <span class="toctext">Working with MCS</span></a>
<ul>
<li class="toclevel-3 tocsection-6"><a href="#Obtaining_MCS"><span class="tocnumber">1.4.1</span> <span class="toctext">Obtaining MCS</span></a></li>
<li class="toclevel-3 tocsection-7"><a href="#Running_MCS"><span class="tocnumber">1.4.2</span> <span class="toctext">Running MCS</span></a></li>
<li class="toclevel-3 tocsection-8"><a href="#Reporting_Bugs"><span class="tocnumber">1.4.3</span> <span class="toctext">Reporting Bugs</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-9"><a href="#Implementation_details"><span class="tocnumber">2</span> <span class="toctext">Implementation details</span></a>
<ul>
<li class="toclevel-2 tocsection-10"><a href="#CIL_Optimizations."><span class="tocnumber">2.1</span> <span class="toctext">CIL Optimizations.</span></a>
<ul>
<li class="toclevel-3 tocsection-11"><a href="#Open_bugs"><span class="tocnumber">2.1.1</span> <span class="toctext">Open bugs</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-12"><a href="#Slides"><span class="tocnumber">3</span> <span class="toctext">Slides</span></a></li>
<li class="toclevel-1 tocsection-13"><a href="#History"><span class="tocnumber">4</span> <span class="toctext">History</span></a></li>
<li class="toclevel-1 tocsection-14"><a href="#Common_Questions"><span class="tocnumber">5</span> <span class="toctext">Common Questions</span></a></li>
</ul>
</td></tr></table>
<h2> <span class="mw-headline" id="Introduction"> Introduction </span></h2>
<p>The Mono C# compiler is considered feature complete for C# 1.0, C# 2.0, C# 3.0 and C# 4.0 (<a href="{{site.baseurl}}/ECMA" title="ECMA">ECMA</a>).   A preview of C# 5.0 is distributed with Mono 2.11 or when building Mono from our trunk source code release.
</p><p>Historically, various version of same compiler existed.
</p>
<ul><li> <b>gmcs</b>: compiler to target the 2.0 mscorlib.
</li><li> <b>smcs</b>: compiler to target the 2.1 mscorlib, to build <a href="{{site.baseurl}}/Moonlight" title="Moonlight">Moonlight</a> applications.
</li><li> <b>dmcs</b>: compiler to target the 4.0 mscorlib.
</li></ul>
<p>Starting with Mono version 2.11 a new unified compiler <b>mcs</b> is available. It replaces all previous runtime specific compilers (gmcs, dmcs, smcs). They still exist (as scripts only) to ease the migration path to mcs but we recommend to use mcs.
</p><p>Bug reports or any compiler issue can be <a href="{{site.baseurl}}/Bugs" title="Bugs">filed on our bug tracking system.</a> 
</p><p>The compiler is able to compile itself and many more C# programs (there is a test suite included that you can use). The compiler  is routinely used to compile Mono, roughly four million lines of C# code and a few other projects.
</p><p>The compiler is also fairly fast. On a IBM ThinkPad t40 it compiles 18,000 lines of C# code per second. 
</p>
<h3> <span class="mw-headline" id="Compiler_Service"> Compiler Service </span></h3>
<p>Starting with Mono 2.2 it supports a <a href="{{site.baseurl}}/CsharpRepl" title="CsharpRepl">Compiler Service</a> that applications can consume.
</p><p>The compiler can be used as a service by using the Mono.CSharp.Evaluator class in the Mono.Sharp.dll assembly.   
</p><p>Both a console and GUI <a href="{{site.baseurl}}/CsharpRepl" title="CsharpRepl">read-eval-print</a> shells are distributed as part of Mono 2.2 and are both built on top of the above service.
</p>
<h3> <span class="mw-headline" id="State_of_the_Compiler"> State of the Compiler </span></h3>
<p>The (<b>mcs</b>) compiler defaults to the latest language specification available.
</p><p>All C# 2.0 features are supported including: 
</p>
<ul><li> <a href="http://msdn2.microsoft.com/library/0yw3tz5k.aspx" class="external text" rel="nofollow">Anonymous methods</a> 
</li><li> <a href="http://msdn2.microsoft.com/library/dscyy5s0.aspx" class="external text" rel="nofollow">Iterators</a> 
</li><li> <a href="http://msdn2.microsoft.com/library/wa80x488.aspx" class="external text" rel="nofollow">Partial classes</a> 
</li><li> <a href="http://msdn2.microsoft.com/en-US/library/512aeb7t(vs.80).aspx" class="external text" rel="nofollow">Generics</a> 
</li><li> <a href="http://msdn2.microsoft.com/library/1t3y8s4s.aspx" class="external text" rel="nofollow">Nullable types</a>
</li><li> <a href="http://msdn2.microsoft.com/library/0tke9fxk(en-us,vs.80).aspx" class="external text" rel="nofollow">Friend assemblies</a>
</li><li> <a href="http://msdn2.microsoft.com/library/79b3xss3.aspx" class="external text" rel="nofollow">Static classes</a> 
</li><li> <a href="http://msdn2.microsoft.com/library/ms173174.aspx" class="external text" rel="nofollow">Covariance and contravariance</a> 
</li><li> <a href="http://msdn2.microsoft.com/library/75e8y5dd.aspx" class="external text" rel="nofollow">Access modifiers on properties</a> 
</li><li> <a href="http://msdn2.microsoft.com/library/zycewsya.aspx" class="external text" rel="nofollow">Fixed buffers</a> 
</li><li> <a href="http://msdn2.microsoft.com/library/e59b22c5(en-us,vs.80).aspx" class="external text" rel="nofollow">External assembly alias</a>
</li><li> <a href="http://msdn2.microsoft.com/library/htccxtad(en-us,vs.80).aspx" class="external text" rel="nofollow">namespace alias qualifier</a>
</li><li> <a href="http://msdn2.microsoft.com/library/441722ys.aspx" class="external text" rel="nofollow">Inline warning control</a>.
</li></ul>
<p>All C# 3.0 features are supported including: 
</p>
<ul><li> Extension methods
</li><li> Query expressions (LINQ)
</li><li> Expression trees
</li><li> Automatically implemented properties
</li><li> Lambda expressions
</li><li> Anonymous types
</li><li> Collection initializers
</li><li> Object initializers
</li><li> Implicitly typed arrays
</li><li> Partial methods
</li></ul>
<p>All C# 4.0 features are supported including: 
</p>
<ul><li> Dynamic binding support
</li><li> Generic type variance
</li><li> Optional parameters
</li><li> Named arguments
</li></ul>
<p>All C# 5.0 feature are supported including:
</p>
<ul><li> Asynchronous programming support
</li><li> Caller info attributes
</li></ul>
<p>If you want to limit the mcs compiler to be a strict 2.0 compiler, use the -langversion:ISO-2 flag, further options are available for each language version.
</p>
<h3> <span class="mw-headline" id="Specification"> Specification </span></h3>
<p>The C# 2.0 specification is available on the <a href="http://www.ecma-international.org/publications/standards/Ecma-334.htm" class="external text" rel="nofollow">third edition of the ECMA 334 standard</a>.
</p><p>An on-line and hyperlinked version of the C# 1.0 specification is available from <a href="http://www.jaggersoft.com" class="external text" rel="nofollow">Jon Jagger's</a> site <a href="http://www.jaggersoft.com/csharp_standard/" class="external text" rel="nofollow">here</a>.
</p><p>The specification shipped with Monodoc, and available on our web downloads is based on Jon's original XML documentation that he extracted from the ECMA 334 specification.
</p>
<h3> <span class="mw-headline" id="Working_with_MCS"> Working with MCS </span></h3>
<h4> <span class="mw-headline" id="Obtaining_MCS"> Obtaining MCS </span></h4>
<p>The Mono C# compiler is part of the `mono' module in the Mono Git you can get it from our <a href="{{site.baseurl}}/SourceCodeRepository" title="SourceCodeRepository">source code</a> server, or you can get nightly <a href="{{site.baseurl}}/Downloads" title="Downloads">download page</a>.
</p><p>You can also browse or download a snapshot of the compiler alone:
</p>
<ul><li> <a href="http://github.com/mono/mono/tree/master/mcs/mcs/" class="external text" rel="nofollow">browse the sources</a>.
</li></ul>
<p>If you are interested in developing the C# compiler, the C# Compiler as a Service or the interactive shell on Windows we provide Visual Studio solutions that work on VS 2008 and 2010 and allow developers to quickly get the compiler up and running.
</p><p>To do this, download the entire MCS tree from:
</p>
<ul><li> <a href="http://github.com/mono/mono/tree/master/mcs/" class="external free" rel="nofollow">http://github.com/mono/mono/tree/master/mcs/</a>.
</li></ul>
<p>And then open the Visual Studio solution on mcs/tools/csharp, this will build the Mono.CSharp.dll compiler as a service as well as the command line interactive C# shell "csharp".
</p>
<h4> <span class="mw-headline" id="Running_MCS"> Running MCS </span></h4>
<p>MCS is written in C# and uses heavily the .NET APIs (in particular it uses System.Reflection and System.Reflection.Emit). MCS runs on Linux with the Mono runtime and on Windows with both the .NET runtime and the Mono runtime.
</p>
<h4> <span class="mw-headline" id="Reporting_Bugs"> Reporting Bugs </span></h4>
<p>You can submit bugs by filing the bugs against the C# compiler in our <a href="{{site.baseurl}}/Bugs" title="Bugs">Bugs</a> page.
</p><p>When you report a bug, try to provide a small test case that would show the error so we can include this as part of the Mono C# regression test suite. 
If the bug is an error or a warning that we do not flag, write a sample program called `csXXXX.cs' where XXXX is the code number that is used by the Microsoft C# compiler that illustrates the problem. That way we can also do regression tests on the invalid input.
</p>
<h2> <span class="mw-headline" id="Implementation_details"> Implementation details </span></h2>
<p>The compiler is documented in the file <a href="http://github.com/mono/mono/blob/master/mcs/docs/compiler.txt" class="external text" rel="nofollow">mcs/docs/compiler</a>
</p>
<h3> <span class="mw-headline" id="CIL_Optimizations."> CIL Optimizations. </span></h3>
<p>The compiler performs a number of simple optimizations on its input: constant folding (this is required by the C# language spec) and can perform dead code elimination. 
</p><p>Other more interesting optimizations like hoisting are not possible at this point since the compiler output at this point does not generate an intermediate representation that is suitable to perform basic block computation. 
</p><p>Adding an intermediate layer to enable the basic block computation to the compiler should be a simple task, but we are considering having a generic CIL optimizer. Since all the information that is required to perform basic block-based optimizations is available at the CIL level, we might just skip this step altogether and have just a generic IL optimizer that would perform hoisting on arbitrary CIL programs, not only those produced by MCS. 
</p><p>If this tool is further expanded to perform constant folding (not needed for our C# compiler, as it is already in there) and dead code elimination, other compiler authors might be able to use this generic CIL optimizer in their projects reducing their time to develop a production compiler. 
</p>
<h4> <span class="mw-headline" id="Open_bugs"> Open bugs </span></h4>
<p>See the <a href="{{site.baseurl}}/Bug_Reporting" title="Bug Reporting" class="mw-redirect">bugs page</a> for more information. 
A test suite is maintained to track the progress of the compiler and various programs are routinely compiled and ran.
</p>
<h2> <span class="mw-headline" id="Slides"> Slides </span></h2>
<p>Slides for the Mono C# Compiler presentation at .NET ONE are available <a href="http://primates.ximian.com/~miguel/slides-europe-nov-2002/Mono_C_Sharp_Overview_1007.sxi" class="external text" rel="nofollow">here</a> in StarOffice format. 
</p>
<h2> <span class="mw-headline" id="History"> History </span></h2>
<p>MCS was able to parse itself on April 2001, MCS compiled itself for the first time on December 28 2001. MCS became self hosting on January 3rd, 2002. 
</p><p>The Mono Runtime and the Mono execution engine were able to make our compiler self hosting on March 12, 2002.
</p><p>On July 2003 work started on the generics support of mcs.  Since the core of the compiler was used in production and in the development of Mono itself, a fork of the compiler was created.  This fork is `gmcs'.  The `gmcs' fork merges all of the changes from mcs on a regular basis and will eventually become the default compiler.
</p><p>Support for the third edition of the C# standard became available on the Mono 1.1.8 release in the summer of 2005.
</p><p>The compiler was originally written as an attempt to learn the C# language, it began as a tokenizer for the language, and then evolved into a parser for the language and later got the semantic analysis and code generation features in place.   This explains the difference in coding styles from the tokenizer (which is the earliest code) and the code generation (which came at later phases).
</p><p>Miguel de Icaza started the compiler and did most of the early work.   He was  later  was joined by Ravi Pratap who would take over attributes, delegates, and overload resolution.
</p><p>Martin Baulig wrote the flow analysis code as well as the generics support.   Harinath Raja fixed and refactored large parts of the compiler, rearchitected flow analysis and fixed many of the early design mistakes.
</p><p>Harinath Raja has been the compiler maintainer for the last two years and was in charge of making the compiler conform to the standard and productized many areas in the compiler, from fixing the name resolution hacks, to performance, to correctness, to simplifying many of the complexity that had crawled into the compiler over the years
</p><p>Marek Safar initially focused on improving the warnings, error messages and made the compiler more robust as part of his work to make the compiler CLS compliant (Common Language Specification errors and warnings).  He later implemented extension methods, delegate type inference and has been a mentor to new compiler authors for a long time. 
</p><p>Atsushi Enomoto wrote the support for inline documentation.
</p><p>Sebastien Pouliot wrote all the code required to sign assemblies, delay sign them and deal with keys.
</p><p>Ben Maurer did a lot of profiling work on the mcs compiler and helped fixed some of the problems in it.
</p><p>Scott Peterson contributed in 2007 many of the foundation blocks for C# 3 (var, support, anonymous types, automatic properties, variable type inference and object and collection initializers). 
</p><p>In 2007 Marek Safar took over the maintenance of the compiler and he completed the C# 3.0 implementation, lambdas, mutators, type inferencing and LINQ expressions.  
</p><p>In 2008 Miguel de Icaza turned the compiler into a reusable library (Mono.CSharp.dll) and introduced the <a href="{{site.baseurl}}/CsharpRepl" title="CsharpRepl">Interactive C# Shell</a>.
</p><p>In 2009 Marek Safar evolved the compiler to support C# 4.0, adding support for the dynamic data type, named parameters, default parameter values as well as co/contravariance support.
</p><p>Many other developers contributed fixes and other small components in the compiler.
</p>
<h2> <span class="mw-headline" id="Common_Questions"> Common Questions </span></h2>
<p><b> What is the difference between dmcs, gmcs and smcs </b>
</p><p>They are the same compiler with three different set of defaults.
</p>
<ul><li> <b>dmcs</b>: references the 4.0-profile libraries (the APIs as defined in .NET 4.0) and supports C# 4.0.
</li><li> <b>gmcs</b>: references the 2.0-profile libraries (the APIs as defined in .NET 2.0 and .NET 3.5) and exposes the full C# 3.0 language.
</li><li> <b>smcs</b>: references the 2.1-profile libraries (the APIs defined for Silverlight) and exposes the full C# 3.0 language.   This is the compiler used for creating Silverlight/<a href="{{site.baseurl}}/Moonlight" title="Moonlight">Moonlight</a> applications.
</li></ul>

