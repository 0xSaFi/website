---
layout: releasenotes
title: Mono 4.2.0 Release Notes
version: 4.2.0
releasedate: ''
---

Highlights
----------

* Adoption of Microsoft's open source code

Runtime
=======

### Portable PDB files ###

Mono's runtime can now consume debug information encoded in the new
[Portable PDB file format](https://github.com/dotnet/roslyn/blob/portable-pdb/docs/specs/PortablePdb-Metadata.md).   

The Portable PDB (Program Databasem, or PPDB) format describes an
encoding of debugging information produced by compilers of Common
Language Infrastructure (CLI) languages and consumed by debuggers and
other tools.  And most importantly, it is fully documented.

At the same time, newer versions of Microsoft's Roslyn compilers are
now able to produce PPDB files so it is now possible to use Roslyn
compilers and have the Mono runtime use their debug information.

The PPDB format is under active development, while Mono currently
implements support for the latest edition of the format, it is possible
that the format might still change.

### Layout Changes for Nested Structures ###

Nested structs used to be aligned to `sizeof (void *)` so
they looked blitable, but didn't match their native layout.

This caused all sort of issues when doing interop.

We now align them following ABI rules, which should fix a lot
of issues.

This is a breaking change to those already native interop and relying
on the wrong layout calculations done by the runtime.

### Delegate Internals Updated ###

Change how delegates work internally from using a reverse linked-list
to an array.

This will be faster and allow us to enable the fast vcall thunk for
delegate invoke.

### Static Compilation (FullAOT) ###

We nw collapse enum to primitives and ref types to object and share based
on that.

So for example a `KVP<EnumA, string>` will share the implementation
code with `KVP <int, Type>`

### Stacktraces on re-throws ###

We have changed the stack trace behavior on rethrows.

This is a merge of https://github.com/mono/mono/pull/1668

Most commonly, an exception is thrown immediately after it is
constructed and processed without being saved.  It is possible to
catch exceptions, save them to variables, and throw them again at a
later time.

When this type of exception is caught in .NET, the StackTrace on the
exception object refers to the location where the exception was last
thrown from. In Mono, we were giving it the location that the
exception was first thrown from. This fix makes Mono more closely
behave like .NET.

### ProcessInfo.Modules ###

`ProcessInfo.Module` returns the list of loaded modules, we now are
able to return the address of any of the assemblies loaded with
`mmap()`, previously this functionality was not available.

### Microsoft's ThreadPool ###

We have replaced Mono's implementation of the ThreadPool with
Microsoft's implementation.  It has many interesting properties in
terms of how threads are started up and terminated, which was too
aggressive previously.

The new code is also simpler to maintain.

### Added ARM HFA support ###

The runtime now supports the HFA calling convention on ARM
architectures.

### SafeFileHandle ###

We have extended the use of SafeFileHandle in the stack, in addition
to file handles, we now use it for socket handles.

### Dropped support for external Boehm libgc ###

The Mono runtime is no longer able to use an externally compiled Boehm `libgc` library.

Microsoft Source Code Adoption
==============================

This is the second release of Mono that replaces various components of
Mono with code that was released by Microsoft under the MIT license in
one of three places:

* Microsoft's ReferenceSource drop
* Microsoft's CoreFX
* Microsoft's CoreCLR

While Microsoft is working towards .NET Core: a redistributable and
re-imagined version of .NET, the project remains a work in progress.
Mono at this point continues to provide an API that tracks the .NET
desktop/server version.

This means that most of the code that we have integrated comes from
the ReferenceSource drop.  In the future, we will deliver a "Mono
Core" along the same lines of .NET Core to allow the use of the Mono
runtime with the new library distribution system that is being
developed with CoreFX.

In this release, we have either ported components that were either
incomplete or buggy in Mono and were relatively easy to port to Mono.
There is much more to be done in this area.  If you are interested in
tracking those efforts, check the [project status](https://trello.com/b/vRPTMfdz/net-framework-integration-into-mono).

Mono ships now with a subset of the referencesource that have been
adjusted to work with Mono's class libraries or have been updated to
be cross platform.

Changes made to Microsoft's reference source code are published under
Mono's github organization fork at http://github.com/mono/referencesource

### System assembly ###

The following components in the `System` assembly were replaced with
Microsoft's implementation, with some small changes to make the code
portable to Unix:

* `System.CodeDom` implementation 
* Parts of `System.Diagnostics` (excluding the components that are tied with the Mono runtime)
* Small parts of `System.Net.NetworkInformation`
* Parts of `System.Net` (HTTP Cookie handling)

### mscorlib assembly ###

Around 500 .NET types were replaced with the Microsoft implementation,
with small changes made to make Microsoft's code portable.

Some themes in this release include:
* Replacing some of the key types in the `System` namespace
* Continued our work to replace large chunks of the globalization stack in Mono with Microsoft's implementation
* Portable parts of `System.IO`
* Large parts of `System.Reflection`, those that do not depend on Mono runtime internals.
* Large parts of `System.Resources`
* The portable parts of `System.Runtime.InteropServices`
* The portable parts of `System.Security.Cryptography`
* Most of `System.Text`
* Most of `System.Runtime.Serialization`
* The threadpool
* Most of SafeHandles

### LINQ ###

The types from `System.Linq` in the `System.Core` assembly have now been
completely replaced with Microsoft's implementation.

### System.Data assembly ###

The cross-platform parts of `System.Data` have been replaced with
Microsoft's implementation of `System.Data`.

The `System.Data.SqlClient` API which implements the connectivity to
SQL server continues to be Mono's implementation, as Microsoft's
implementation is too tied up to Windows specific code.

While we had an implementation of `System.Data.OleDb` in the past,
which depended on Gnome's GDA library, it has not been operational in
many years, so we have removed the implementation, and added in its
place a Windows specific version from Microsoft (that means, we do not
have a cross platform OleDb, but we did not have a working one to
begin with).

### System.Runtime.Serialization assembly ###

Switched most of this assembly to the Reference Source code.  We have
made a few changes that allow this assembly to be used with systems
that do not allow dynamic code generation (iOS, PlayStation and Xbox)

### System.Xml and System.Xml.Linq assemblies ###

We have replaced Mono's System.XML implementation with Microsoft's
version.   

For systems that do not allow dynamic code generation (iOS,
PlayStation, Xbox), the `XmlSerializer` continues to be Mono's old XmlSerializer.

### Replaced Assemblies with Microsoft code ###

The following assemblies are now mostly based on Microsoft's
ReferenceSource code, with small changes to make them cross platform,
or otherwise be integrated into Mono's build system:

* `System.Data.DataSetExtension`
* `System.Runtime.DurableInstancing`
* `SMDiagnostics`
* `System.ServiceModel.Internals`
* `System.Web.Services`

Tools
=====

mono-symbolicate
----------------

New tool that is a tool that converts a stack trace with `<filename unknown>:0`
into one with file names and line numbers.   

MonoDoc
-------

The `mdoc` command has been updated to better match generic arguments
when updating your existing documentation.

We no longer ship all of Lucene.Net, instead we only ship the parts
that MonoDoc actually uses.

mkbundle
--------

Now takes a `--dos2unix[=false]` parameter which controls whether
`mkbundle` should use the `dos2unix` command on the resulting output.`

Mono Linker
-----------

The Mono linker adds support for PCL type forwarders, making the
linker PCL friendly.

The linker also now supports descriptor files embedded into assemblies
being linked.  This allows developers to embed linker description
files that can instruct the linker how to link an assembly without
requiring the end user to know about the internals of an assembly.

Adds support for linking security declarations.

It also fixes support for generics and linking and improves the linker
performance.

mdbrebase
---------

The tool now has a silent mode

mono-api-html
-------------

* Now uses CSS for coloring API diffs, instead of old school HTML.
* It now ignores non-important attribute differences
* Properly colorize removed types (as red).
* Print 'NotSerialized' field attribute change (as not breaking).
* Ignore 'HasSecurity' and 'PInvokeImpl' method attribute differences.
* Render property indexers (and detect name change in property indexer parameters).
* Improve debug spew to print proper method/field attributes.
* Renders generic parameter constraints

ilasm
-----

Implement support for many undocumented features in `ilasm` 
xbuild
------

Improves the Visual Basic compiler support (requires Roslyn based
compiler, available separately).


Contributors
============
