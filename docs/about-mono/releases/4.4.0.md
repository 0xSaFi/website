---
layout: releasenotes
title: Mono 4.4.0 Release Notes
version: 4.4.0
---

Coverage
========

The release notes cover the changes from:

End: 8a4b2f74d50d0e3c26cbaf72df32615338d824cd (Sep 4th)
Start: eade1efc7740af1e036e2238189ec1e2c54adc80

And:
End: 4791a674a1bf8cc74691974e363d9c5f5dd060a3
Start: 84d7f7e8886e5dbe638360dcd76c61895bbb8e8b

Highlights
==========

In Depth
========

## Class Libraries

Our build system has been reconfigured to become a 4.x setup, as
opposed to 4.5 only.

## Runtime

### Bitcode

It is now possible to configure the runtime to generate LLVM bitcode
when passing the `--with-bitcode` option to `configure`. This mode of
operation avoids certain low-level optimizations that require assembly
code to be used and instead limits the runtime to use constructs that
can be expressed entirely in bitcode mode.  This is designed to
support scenarios where you want to use LLVM to drive the entire
compilation process.

### Unmanaged Thin Locks

This avoids allocation of new MonoThreadsSync structures for the
typical cases of shallow nesting of uncontended locks. The necessary
information (owner, nest and status bits) is embedded in the
synchronisation field of a MonoObject. The lock is inflated when the
nest overflows or when there is contention on the lock.

This greatly improves performance (over 10 times) for the case of
locking a lock only a few times, due to the inflation avoidance. It
also improves performance up to 25% for the case of locking a thin
lock. A decrease in performance (up to 3 times slower) can happen for
the case of repetitive nesting of a lock, due to the need of a CAS at
each entry/exit.

### libmono now defaults to SGen

The `libmono` library now defaults to using Mono with SGen,
previously, it defaulted to Boehm.   This 

### Minor Changes

MonoHashTable no longer supports conservative scanning [FIXME: add details]

### FullAOT: Generic Value Type Sharing improvements.

More code is now shared with Value Type sharing and we no longer
generate shared wrappers for method signatures as those are not
needed.

## Garbage Collector

This release contains a new mode of operation for Mono's SGen garbage
collector as well as many performance optimizations,and memory usage
and throughput optimizations

### Cooperative Mode

Mono has historically used garbage collectors that can run at any
time, that is, when a garbage collection is triggered, the GC system
stops all threads preemptively and performs a garbage collection.

This is a behavior that we inherited from Boehm's GC which was great
in the early days of Mono, as it allowed us to get a working garbage
collector in no time, but also made the garbage collector harder to
debug.

We have introduced a new cooperative configuration to our garbage
collector that makes it easier to debug garbage collector related
problems and reduces the operating system specific requirements to
have a functioning garbage collector.

This mode can be enabled by setting the `MONO_ENABLE_COOP` environment
variable.


### Concurrent GC

We continue to improve the concurrent capabilities of the garbage
collector, among those we enabled
[cementing](https://schani.wordpress.com/2012/12/18/sgen-write-barrier/)
for it, and tuned various parameters of nursery collection and
improved the diagnostic capabilities of the concurrent GC.

### GC Handles

We have made the implementation of GC handles lock-free. The previous
implementation would take a lock every time a GC handle was accessed
(e.g., with `WeakReference.Target` or `WeakReference.IsAlive`).
Removing this locking improves the performance of these operations by
orders of magnitudeâ€”particularly on OS X, where locking is costly.

## Profiler

We are now annotating our GC roots, so the profiler can get better
visibility into the nature of objects that keep objects alive.

## Threadpool

We no longer use the sparse array for the threadpool, as for many
thread it would slow down some operations.

## Debugger

The soft debugger now allows nested invocations to take place.

## PowerPC

The PowerPC backend has been updated to support big endian systems.

## Process API

Refactored the Process API (FIXME: Marek, what was the source of this?)

C# Compiler
===========

experimental flag
-----------------

The language version `future` has been renamed to `experimental`.

IKVM Updated
------------

We have updated IKVM to support 4GB output files.

## Portable Class Libraries

Introduced support for the PCL v3 contracts

## Platforms

Adds support for WatchOS, armv7k and new Android M.

## io-layer

FIXME: find the description of the overall changes

## Reflection

Major upgrade to Reflection APIs, it implements many features that we
never used in the past, but that are required to run Roslyn (FIXME:
add more details).

# IL Assembler

Adds support for `{auto}` and `legacy library`.

# Microsoft Source Code Adoption

### System ###

Adopted `WebUtility` class
Adopted `AuthenticatedStream` class and family.

### System.Web ###

FIXME: pull the list

Tools
=====

### mkbundle

Now supports the `--quiet` flag to prevent diagnostics messages from being printed out.

### xbuild

Roslyn support: It now copies the Portable PDB files generated by the
Roslyn compiler to the output directory.

### babysitter

This new script replaces GNU timeout and is intended to be used by
automated builds of Mono on Jenkins or other continuous build systems.
In addition, it:

* Logs machine readable output about each test suite (as
  line-delimited json)
* If the test suite uses NUnit, can detect if a test case failed or
  crashed (terminated mono in mid-test), and retry unsuccessful tests
  (up to a limit).


Bug Fixes
=========

Contributors
============

